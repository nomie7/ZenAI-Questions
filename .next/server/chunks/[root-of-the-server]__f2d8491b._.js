module.exports=[792509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},270406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},224361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},478500,(e,t,r)=>{t.exports=e.x("node:async_hooks",()=>require("node:async_hooks"))},666680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},857764,(e,t,r)=>{t.exports=e.x("node:url",()=>require("node:url"))},750227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},207335,e=>{"use strict";var t=e.i(609212),r=e.i(60400);let n="AWS_ACCESS_KEY_ID",s="AWS_SECRET_ACCESS_KEY",i="AWS_SESSION_TOKEN",o="AWS_CREDENTIAL_EXPIRATION",a="AWS_CREDENTIAL_SCOPE",l="AWS_ACCOUNT_ID";e.s(["ENV_ACCOUNT_ID",0,l,"ENV_CREDENTIAL_SCOPE",0,a,"ENV_EXPIRATION",0,o,"ENV_KEY",0,n,"ENV_SECRET",0,s,"ENV_SESSION",0,i,"fromEnv",0,e=>async()=>{e?.logger?.debug("@aws-sdk/credential-provider-env - fromEnv");let c=process.env[n],d=process.env[s],u=process.env[i],p=process.env[o],f=process.env[a],h=process.env[l];if(c&&d){let e={accessKeyId:c,secretAccessKey:d,...u&&{sessionToken:u},...p&&{expiration:new Date(p)},...f&&{credentialScope:f},...h&&{accountId:h}};return(0,t.setCredentialFeature)(e,"CREDENTIALS_ENV_VARS","g"),e}throw new r.CredentialsProviderError("Unable to find environment variable credentials.",{logger:e?.logger})}])},876535,e=>{"use strict";var t=e.i(846277);let r=async e=>{let r=await (0,t.loadSharedConfigFiles)(e);return((...e)=>{let t={};for(let r of e)for(let[e,n]of Object.entries(r))void 0!==t[e]?Object.assign(t[e],n):t[e]=n;return t})(r.configFile,r.credentialsFile)};e.s(["parseKnownFiles",0,r],876535)},924868,(e,t,r)=>{t.exports=e.x("fs/promises",()=>require("fs/promises"))},823897,32961,e=>{"use strict";var t=e.i(924868),r=e.i(254799),n=e.i(814747),s=e.i(965790);let i=e=>{let t=(0,r.createHash)("sha1").update(e).digest("hex");return(0,n.join)((0,s.getHomeDir)(),".aws","sso","cache",`${t}.json`)};e.s(["getSSOTokenFilepath",0,i],32961);let o={},a=async e=>{if(o[e])return o[e];let r=i(e);return JSON.parse(await (0,t.readFile)(r,"utf8"))};e.s(["getSSOTokenFromFile",0,a,"tokenIntercept",0,o],823897)},233405,(e,t,r)=>{t.exports=e.x("child_process",()=>require("child_process"))},525465,e=>{"use strict";var t=e.i(134220),r=e.i(389073),n=e.i(714988),s=e.i(776022);class i extends s.HttpProtocol{async serializeRequest(e,n,s){let i,o=this.serializer,a={},l={},c=await s.endpoint(),d=t.NormalizedSchema.of(e?.input),u=d.getSchema(),p=new r.HttpRequest({protocol:"",hostname:"",port:void 0,path:"/",fragment:void 0,query:a,headers:l,body:void 0});c&&(this.updateServiceEndpoint(p,c),this.setHostPrefix(p,e,n));let f={...n};if(n){let e=d.getEventStreamMember();if(e){if(f[e]){let t={};for(let[r,n]of d.structIterator())r!==e&&f[r]&&(o.write(n,f[r]),t[r]=o.flush());i=await this.serializeEventStream({eventStream:f[e],requestSchema:d,initialRequest:t})}}else o.write(u,f),i=o.flush()}return p.headers=l,p.query=a,p.body=i,p.method="POST",p}async deserializeResponse(e,r,s){let i=this.deserializer,o=t.NormalizedSchema.of(e.output),a={};if(s.statusCode>=300){let t=await (0,n.collectBody)(s.body,r);throw t.byteLength>0&&Object.assign(a,await i.read(15,t)),await this.handleError(e,r,s,a,this.deserializeMetadata(s)),Error("@smithy/core/protocols - RPC Protocol error handler failed to throw.")}for(let e in s.headers){let t=s.headers[e];delete s.headers[e],s.headers[e.toLowerCase()]=t}let l=o.getEventStreamMember();if(l)a[l]=await this.deserializeEventStream({response:s,responseSchema:o,initialResponseContainer:a});else{let e=await (0,n.collectBody)(s.body,r);e.byteLength>0&&Object.assign(a,await i.read(o,e))}return a.$metadata=this.deserializeMetadata(s),a}}e.s(["RpcProtocol",()=>i])},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},843359,e=>{"use strict";var t=e.i(848979);class r extends t.ProviderError{name="TokenProviderError";constructor(e,t=!0){super(e,t),Object.setPrototypeOf(this,r.prototype)}}e.s(["TokenProviderError",()=>r])},861981,e=>{"use strict";var t=e.i(892395),r=e.i(396405),n=e.i(3289);let s=e=>Object.entries(e).filter(([e])=>e.startsWith(r.IniSectionType.SSO_SESSION+n.CONFIG_PREFIX_SEPARATOR)).reduce((e,[t,r])=>({...e,[t.substring(t.indexOf(n.CONFIG_PREFIX_SEPARATOR)+1)]:r}),{});var i=e.i(907104),o=e.i(449487);let a=()=>({}),l=async(e={})=>(0,o.readFile)(e.configFilepath??(0,t.getConfigFilepath)()).then(i.parseIni).then(s).catch(a);e.s(["loadSsoSessionData",0,l],861981)},713308,e=>{"use strict";var t=e.i(843359),r=e.i(881355),n=e.i(823897),s=e.i(861981),i=e.i(876535);let o="To refresh this SSO session run 'aws sso login' with the corresponding profile.",a=async(t,r={})=>{let{SSOOIDCClient:n}=await e.A(857227),s=e=>r.clientConfig?.[e]??r.parentClientConfig?.[e];return new n(Object.assign({},r.clientConfig??{},{region:t??r.clientConfig?.region,logger:s("logger"),userAgentAppId:s("userAgentAppId")}))},l=async(t,r,n={})=>{let{CreateTokenCommand:s}=await e.A(857227);return(await a(r,n)).send(new s({clientId:t.clientId,clientSecret:t.clientSecret,refreshToken:t.refreshToken,grantType:"refresh_token"}))},c=e=>{if(e.expiration&&e.expiration.getTime()<Date.now())throw new t.TokenProviderError(`Token is expired. ${o}`,!1)},d=(e,r,n=!1)=>{if(void 0===r)throw new t.TokenProviderError(`Value not present for '${e}' in SSO Token${n?". Cannot refresh":""}. ${o}`,!1)};var u=e.i(32961);let{writeFile:p}=e.i(522734).promises,f=new Date(0);e.s(["fromSso",0,(e={})=>async({callerClientConfig:a}={})=>{let h,g={...e,parentClientConfig:{...a,...e.parentClientConfig}};g.logger?.debug("@aws-sdk/token-providers - fromSso");let m=await (0,i.parseKnownFiles)(g),w=(0,r.getProfileName)({profile:g.profile??a?.profile}),v=m[w];if(v){if(!v.sso_session)throw new t.TokenProviderError(`Profile '${w}' is missing required property 'sso_session'.`)}else throw new t.TokenProviderError(`Profile '${w}' could not be found in shared credentials file.`,!1);let y=v.sso_session,S=(await (0,s.loadSsoSessionData)(g))[y];if(!S)throw new t.TokenProviderError(`Sso session '${y}' could not be found in shared credentials file.`,!1);for(let e of["sso_start_url","sso_region"])if(!S[e])throw new t.TokenProviderError(`Sso session '${y}' is missing required property '${e}'.`,!1);S.sso_start_url;let _=S.sso_region;try{h=await (0,n.getSSOTokenFromFile)(y)}catch(e){throw new t.TokenProviderError(`The SSO session token associated with profile=${w} was not found or is invalid. ${o}`,!1)}d("accessToken",h.accessToken),d("expiresAt",h.expiresAt);let{accessToken:x,expiresAt:k}=h,b={token:x,expiration:new Date(k)};if(b.expiration.getTime()-Date.now()>3e5)return b;if(Date.now()-f.getTime()<3e4)return c(b),b;d("clientId",h.clientId,!0),d("clientSecret",h.clientSecret,!0),d("refreshToken",h.refreshToken,!0);try{f.setTime(Date.now());let e=await l(h,_,g);d("accessToken",e.accessToken),d("expiresIn",e.expiresIn);let t=new Date(Date.now()+1e3*e.expiresIn);try{var E;let r;await (E={...h,accessToken:e.accessToken,expiresAt:t.toISOString(),refreshToken:e.refreshToken},r=(0,u.getSSOTokenFilepath)(y),p(r,JSON.stringify(E,null,2)))}catch(e){}return{token:e.accessToken,expiration:t}}catch(e){return c(b),b}}],713308)},920240,e=>e.a(async(t,r)=>{try{var n=e.i(517903),s=e.i(328624),i=e.i(983084),o=t([i]);async function a(e,t={}){let{topK:r=10,docId:i,status:o="ready",diversify:l=!0,diversityWeight:c=.7}=t,d=await (0,n.embedText)(e),u={must:[{key:"status",match:{value:o}}]};i&&u.must.push({key:"doc_id",match:{value:i}});let p=l?3*r:r,f=(await (0,s.searchVectors)(d,p,u)).map(e=>({chunkId:e.id,docId:e.payload.doc_id||"",docName:e.payload.doc_name||"",pageNumber:e.payload.page_number||0,chunkIndex:e.payload.chunk_index||0,text:e.payload.text||"",imageUrl:e.payload.image_url||"",score:e.score,parserUsed:e.payload.parser_used||""}));return l&&f.length>r&&(f=function(e,t,r){if(e.length<=t)return e;let n=[],s=new Set(e.map((e,t)=>t));for(n.push(e[0]),s.delete(0);n.length<t&&s.size>0;){let t=-1,i=-1/0;for(let o of s){let s=e[o],a=s.score,l=0;for(let e of n){let t=function(e,t){let r=new Set(e.toLowerCase().split(/\s+/)),n=new Set(t.toLowerCase().split(/\s+/)),s=new Set([...r].filter(e=>n.has(e))),i=new Set([...r,...n]);return s.size/i.size}(s.text,e.text);l=Math.max(l,t)}let c=r*a-(1-r)*l;c>i&&(i=c,t=o)}if(-1!==t)n.push(e[t]),s.delete(t);else break}return n}(f,r,c)),(f=function(e){let t=new Map;for(let r of e){let e=`${r.docId}:${r.pageNumber}`,n=t.get(e);(!n||r.score>n.score)&&t.set(e,r)}return Array.from(t.values()).sort((e,t)=>t.score-e.score)}(f)).slice(0,r)}async function l(e){let t=[];for(let r of e){let e;if(r.imageUrl)try{e=await (0,i.getSignedUrl)(r.imageUrl)}catch{}t.push({docName:r.docName,pageNumber:r.pageNumber,imageUrl:e,snippet:r.text.length>200?r.text.substring(0,200)+"...":r.text})}return t}[i]=o.then?(await o)():o,e.s(["extractCitations",()=>l,"retrieveContext",()=>a]),r()}catch(e){r(e)}},!1),107075,e=>e.a(async(t,r)=>{try{e.i(152914);var n=e.i(940849),s=e.i(920240),i=t([s]);[s]=i.then?(await i)():i;let p=new n.ChatOpenAI({modelName:"gpt-4o-mini",temperature:0});async function o(e){let t=`You are a query analyzer for a knowledge base search system.

Analyze this user query and provide:
1. The user's intent (what are they trying to find/understand?)
2. Key entities or concepts mentioned
3. If this is a multi-part question, break it into sub-questions
4. Generate 1-3 search queries that would help find relevant information

User Query: "${e}"

Respond in JSON format:
{
  "intent": "brief description of what user wants to know",
  "keyEntities": ["entity1", "entity2"],
  "subQuestions": ["sub-question 1", "sub-question 2"] or [],
  "isMultiPart": true/false,
  "searchQueries": ["search query 1", "search query 2"]
}

Only output valid JSON, no markdown or explanation.`;try{let r=await p.invoke(t),n=("string"==typeof r.content?r.content:JSON.stringify(r.content)).replace(/```json\n?|\n?```/g,"").trim(),s=JSON.parse(n);return{originalQuery:e,intent:s.intent||e,keyEntities:s.keyEntities||[],subQuestions:s.subQuestions||[],isMultiPart:s.isMultiPart||!1,searchQueries:s.searchQueries||[e]}}catch(t){return console.warn("Query analysis failed, using original query:",t),{originalQuery:e,intent:e,keyEntities:[],subQuestions:[],isMultiPart:!1,searchQueries:[e]}}}async function a(e,t,r,n=[]){let s=r.slice(0,10).map((e,t)=>`[${t+1}] ${e.docName} (Page ${e.pageNumber}): ${e.text.slice(0,500)}...`).join("\n\n"),i=n.length>0?`
Previous search attempts:
${n.map((e,t)=>`Attempt ${t+1}: Confidence ${e.confidence}, Missing: ${e.missingInformation.join(", ")}`).join("\n")}
`:"",o=`You are evaluating if retrieved documents answer a user's question.

User Query: "${e}"
Intent: ${t.intent}
${t.subQuestions.length>0?`Sub-questions: ${t.subQuestions.join(", ")}`:""}
${i}

Retrieved Documents:
${s}

Evaluate:
1. Does this information answer the user's question? (confidence 0-1)
2. What aspects of the question are answered?
3. What information is still missing?
4. If missing info, what search queries would help find it?

Respond in JSON:
{
  "confidence": 0.0-1.0,
  "isSufficient": true/false,
  "answeredAspects": ["aspect 1", "aspect 2"],
  "missingInformation": ["missing info 1"] or [],
  "suggestedQueries": ["refined query"] or [],
  "reasoning": "brief explanation"
}

Only output valid JSON.`;try{let e=await p.invoke(o),t=("string"==typeof e.content?e.content:JSON.stringify(e.content)).replace(/```json\n?|\n?```/g,"").trim(),r=JSON.parse(t);return{confidence:Math.min(1,Math.max(0,r.confidence||0)),isSufficient:r.isSufficient??r.confidence>=.7,answeredAspects:r.answeredAspects||[],missingInformation:r.missingInformation||[],suggestedQueries:r.suggestedQueries||[],reasoning:r.reasoning||""}}catch(e){return console.warn("Reflection failed:",e),{confidence:.6,isSufficient:!0,answeredAspects:[],missingInformation:[],suggestedQueries:[],reasoning:"Reflection failed, proceeding with available results"}}}function l(e,t){let r=new Set,n=[];for(let t of e){let e=`${t.docId}-${t.pageNumber}-${t.chunkIndex}`;r.has(e)||(r.add(e),n.push(t))}for(let e of t){let t=`${e.docId}-${e.pageNumber}-${e.chunkIndex}`;r.has(t)||(r.add(t),n.push(e))}return n.sort((e,t)=>t.score-e.score).slice(0,16)}async function c(e,t={}){let{docId:r,maxIterations:n=3,confidenceThreshold:i=.7,verbose:d=!0}=t,u=[],p=[],f=[],h=0,g=0;d&&console.log(`[Agent] Analyzing query: "${e}"`);let m=await o(e);for(let e of(d&&(console.log(`[Agent] Intent: ${m.intent}`),console.log(`[Agent] Search queries: ${m.searchQueries.join(", ")}`)),m.searchQueries)){p.push(e),d&&console.log(`[Agent] Searching: "${e}"`);let t=await (0,s.retrieveContext)(e,{topK:8,docId:r,diversify:!0});f=l(f,t)}for(d&&console.log(`[Agent] Retrieved ${f.length} chunks`);h<n;){h++,d&&console.log(`[Agent] Reflection iteration ${h}...`);let t=await a(e,m,f,u);if(u.push(t),g=t.confidence,d&&(console.log(`[Agent] Confidence: ${t.confidence.toFixed(2)}`),console.log(`[Agent] Sufficient: ${t.isSufficient}`),t.missingInformation.length>0&&console.log(`[Agent] Missing: ${t.missingInformation.join(", ")}`)),t.isSufficient||t.confidence>=i){d&&console.log("[Agent] Results sufficient, stopping.");break}if(0===t.suggestedQueries.length){d&&console.log("[Agent] No new queries suggested, stopping.");break}for(let e of t.suggestedQueries){if(p.includes(e))continue;p.push(e),d&&console.log(`[Agent] Re-searching: "${e}"`);let t=await (0,s.retrieveContext)(e,{topK:8,docId:r,diversify:!0});f=l(f,t)}d&&console.log(`[Agent] Total chunks: ${f.length}`)}return d&&(console.log(`[Agent] Completed in ${h} iteration(s)`),console.log(`[Agent] Final confidence: ${g.toFixed(2)}`),console.log(`[Agent] Total search queries: ${p.length}`)),{chunks:f,iterations:h,queryAnalysis:m,reflections:u,finalConfidence:g,searchQueries:p}}function d(e){if(0===e.chunks.length)return"No relevant documents found in the knowledge base.";let t=e.chunks.map((e,t)=>`[${t+1}] Document: "${e.docName}", Page ${e.pageNumber}
${e.text}`),r=`Search conducted with ${e.iterations} iteration(s), ${e.searchQueries.length} queries, confidence ${e.finalConfidence.toFixed(2)}`;return`${r}

---

${t.join("\n\n---\n\n")}`}function u(e){return{iterations:e.iterations,confidence:e.finalConfidence,searchQueries:e.searchQueries,intent:e.queryAnalysis.intent}}e.s(["agenticRetrieve",()=>c,"formatAgentContextForLLM",()=>d,"getAgentMetadata",()=>u]),r()}catch(e){r(e)}},!1),896343,e=>{e.v(e=>Promise.resolve().then(()=>e(456569)))},5389,e=>{e.v(e=>Promise.resolve().then(()=>e(478500)))},514277,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_@smithy_credential-provider-imds_dist-es_index_6334b510.js"].map(t=>e.l(t))).then(()=>t(174340)))},493306,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_@aws-sdk_credential-provider-http_dist-es_index_639d0ca6.js"].map(t=>e.l(t))).then(()=>t(838788)))},14115,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_@aws-sdk_credential-provider-sso_dist-es_31d9426a._.js"].map(t=>e.l(t))).then(()=>t(826709)))},309193,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__30720bb1._.js"].map(t=>e.l(t))).then(()=>t(901346)))},285365,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_67bd24db._.js"].map(t=>e.l(t))).then(()=>t(333073)))},652170,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_fa738638._.js"].map(t=>e.l(t))).then(()=>t(623492)))},857227,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_99f91693._.js","server/chunks/node_modules_@aws-sdk_nested-clients_dist-es_submodules_sso-oidc_index_df09d547.js"].map(t=>e.l(t))).then(()=>t(186799)))},536806,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_@smithy_core_dist-es_submodules_event-streams_index_73e35402.js"].map(t=>e.l(t))).then(()=>t(130360)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__f2d8491b._.js.map