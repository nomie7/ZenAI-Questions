module.exports=[660526,(e,r,t)=>{r.exports=e.x("node:os",()=>require("node:os"))},901346,e=>{"use strict";e.s([],358014),e.i(358014);var r=e.i(881355),t=e.i(876535),i=e.i(60400),s=e.i(609212),n=e.i(539866);let o=e=>(0,s.setCredentialFeature)(e,"CREDENTIALS_PROFILE_NAMED_PROVIDER","p"),a=async(t,a,d,c={},g)=>{d.logger?.debug("@aws-sdk/credential-provider-ini - resolveAssumeRoleCredentials (STS)");let u=a[t],{source_profile:f,region:_}=u;if(!d.roleAssumer){let{getDefaultRoleAssumer:r}=await e.A(643109);d.roleAssumer=r({...d.clientConfig,credentialProviderLogger:d.logger,parentClientConfig:{...d?.parentClientConfig,region:_??d?.parentClientConfig?.region}},d.clientPlugins)}if(f&&f in c)throw new i.CredentialsProviderError(`Detected a cycle attempting to resolve credentials for profile ${(0,r.getProfileName)(d)}. Profiles visited: `+Object.keys(c).join(", "),{logger:d.logger});d.logger?.debug(`@aws-sdk/credential-provider-ini - finding credential resolver using ${f?`source_profile=[${f}]`:`profile=[${t}]`}`);let p=f?g(f,a,d,{...c,[f]:!0},l(a[f]??{})):(await ((r,t,s)=>{let a={EcsContainer:async r=>{let{fromHttp:t}=await e.A(493306),{fromContainerMetadata:i}=await e.A(514277);return s?.debug("@aws-sdk/credential-provider-ini - credential_source is EcsContainer"),async()=>(0,n.chain)(t(r??{}),i(r))().then(o)},Ec2InstanceMetadata:async r=>{s?.debug("@aws-sdk/credential-provider-ini - credential_source is Ec2InstanceMetadata");let{fromInstanceMetadata:t}=await e.A(514277);return async()=>t(r)().then(o)},Environment:async r=>{s?.debug("@aws-sdk/credential-provider-ini - credential_source is Environment");let{fromEnv:t}=await e.A(931605);return async()=>t(r)().then(o)}};if(r in a)return a[r];throw new i.CredentialsProviderError(`Unsupported credential source in profile ${t}. Got ${r}, expected EcsContainer or Ec2InstanceMetadata or Environment.`,{logger:s})})(u.credential_source,t,d.logger)(d))();if(l(u))return p.then(e=>(0,s.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"));{let e={RoleArn:u.role_arn,RoleSessionName:u.role_session_name||`aws-sdk-js-${Date.now()}`,ExternalId:u.external_id,DurationSeconds:parseInt(u.duration_seconds||"3600",10)},{mfa_serial:r}=u;if(r){if(!d.mfaCodeProvider)throw new i.CredentialsProviderError(`Profile ${t} requires multi-factor authentication, but no MFA code callback was provided.`,{logger:d.logger,tryNextLink:!1});e.SerialNumber=r,e.TokenCode=await d.mfaCodeProvider(r)}let n=await p;return d.roleAssumer(n,e).then(e=>(0,s.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"))}},l=e=>!e.role_arn&&!!e.credential_source;var d=e.i(389073),c=e.i(449487),g=e.i(666680),u=e.i(902157),f=e.i(660526),_=e.i(750227);class p{profileData;init;callerClientConfig;static REFRESH_THRESHOLD=3e5;constructor(e,r,t){this.profileData=e,this.init=r,this.callerClientConfig=t}async loadCredentials(){let e=await this.loadToken();if(!e)throw new i.CredentialsProviderError(`Failed to load a token for session ${this.loginSession}, please re-authenticate using aws login`,{tryNextLink:!1,logger:this.logger});let r=e.accessToken,t=Date.now();return new Date(r.expiresAt).getTime()-t<=p.REFRESH_THRESHOLD?this.refresh(e):{accessKeyId:r.accessKeyId,secretAccessKey:r.secretAccessKey,sessionToken:r.sessionToken,accountId:r.accountId,expiration:new Date(r.expiresAt)}}get logger(){return this.init?.logger}get loginSession(){return this.profileData.login_session}async refresh(r){let t,{SigninClient:s,CreateOAuth2TokenCommand:n}=await e.A(754608),{logger:o,userAgentAppId:a}=this.callerClientConfig??{},l=(t=this.callerClientConfig?.requestHandler,t?.metadata?.handlerProtocol==="h2")?void 0:this.callerClientConfig?.requestHandler,d=new s({credentials:{accessKeyId:"",secretAccessKey:""},region:this.profileData.region??await this.callerClientConfig?.region?.()??process.env.AWS_REGION,requestHandler:l,logger:o,userAgentAppId:a,...this.init?.clientConfig});this.createDPoPInterceptor(d.middlewareStack);let c={tokenInput:{clientId:r.clientId,refreshToken:r.refreshToken,grantType:"refresh_token"}};try{let e=await d.send(new n(c)),{accessKeyId:t,secretAccessKey:s,sessionToken:o}=e.tokenOutput?.accessToken??{},{refreshToken:a,expiresIn:l}=e.tokenOutput??{};if(!t||!s||!o||!a)throw new i.CredentialsProviderError("Token refresh response missing required fields",{logger:this.logger,tryNextLink:!1});let g=new Date(Date.now()+(l??900)*1e3),u={...r,accessToken:{...r.accessToken,accessKeyId:t,secretAccessKey:s,sessionToken:o,expiresAt:g.toISOString()},refreshToken:a};await this.saveToken(u);let f=u.accessToken;return{accessKeyId:f.accessKeyId,secretAccessKey:f.secretAccessKey,sessionToken:f.sessionToken,accountId:f.accountId,expiration:g}}catch(e){if("AccessDeniedException"===e.name){let r;switch(e.error){case"TOKEN_EXPIRED":r="Your session has expired. Please reauthenticate.";break;case"USER_CREDENTIALS_CHANGED":r="Unable to refresh credentials because of a change in your password. Please reauthenticate with your new password.";break;case"INSUFFICIENT_PERMISSIONS":r="Unable to refresh credentials due to insufficient permissions. You may be missing permission for the 'CreateOAuth2Token' action.";break;default:r=`Failed to refresh token: ${String(e)}. Please re-authenticate using \`aws login\``}throw new i.CredentialsProviderError(r,{logger:this.logger,tryNextLink:!1})}throw new i.CredentialsProviderError(`Failed to refresh token: ${String(e)}. Please re-authenticate using aws login`,{logger:this.logger})}}async loadToken(){let e=this.getTokenFilePath();try{let r;try{r=await (0,c.readFile)(e,{ignoreCache:this.init?.ignoreCache})}catch{r=await u.promises.readFile(e,"utf8")}let t=JSON.parse(r),s=["accessToken","clientId","refreshToken","dpopKey"].filter(e=>!t[e]);if(t.accessToken?.accountId||s.push("accountId"),s.length>0)throw new i.CredentialsProviderError(`Token validation failed, missing fields: ${s.join(", ")}`,{logger:this.logger,tryNextLink:!1});return t}catch(r){throw new i.CredentialsProviderError(`Failed to load token from ${e}: ${String(r)}`,{logger:this.logger,tryNextLink:!1})}}async saveToken(e){let r=this.getTokenFilePath(),t=(0,_.dirname)(r);try{await u.promises.mkdir(t,{recursive:!0})}catch(e){}await u.promises.writeFile(r,JSON.stringify(e,null,2),"utf8")}getTokenFilePath(){let e=process.env.AWS_LOGIN_CACHE_DIRECTORY??(0,_.join)((0,f.homedir)(),".aws","login","cache"),r=Buffer.from(this.loginSession,"utf8"),t=(0,g.createHash)("sha256").update(r).digest("hex");return(0,_.join)(e,`${t}.json`)}derToRawSignature(e){let r=2;if(2!==e[2])throw Error("Invalid DER signature");r++;let t=e[r++],i=e.subarray(r,r+t);if(2!==e[r+=t])throw Error("Invalid DER signature");r++;let s=e[r++],n=e.subarray(r,r+s);i=0===i[0]?i.subarray(1):i,n=0===n[0]?n.subarray(1):n;let o=Buffer.concat([Buffer.alloc(32-i.length),i]),a=Buffer.concat([Buffer.alloc(32-n.length),n]);return Buffer.concat([o,a])}createDPoPInterceptor(e){e.add(e=>async r=>{if(d.HttpRequest.isInstance(r.request)){let e=r.request,t=`${e.protocol}//${e.hostname}${e.port?`:${e.port}`:""}${e.path}`,i=await this.generateDpop(e.method,t);e.headers={...e.headers,DPoP:i}}return e(r)},{step:"finalizeRequest",name:"dpopInterceptor",override:!0})}async generateDpop(e="POST",r){let t=await this.loadToken();try{let i=(0,g.createPrivateKey)({key:t.dpopKey,format:"pem",type:"sec1"}),s=(0,g.createPublicKey)(i).export({format:"der",type:"spki"}),n=-1;for(let e=0;e<s.length;e++)if(4===s[e]){n=e;break}let o=s.slice(n+1,n+33),a=s.slice(n+33,n+65),l={alg:"ES256",typ:"dpop+jwt",jwk:{kty:"EC",crv:"P-256",x:o.toString("base64url"),y:a.toString("base64url")}},d={jti:crypto.randomUUID(),htm:e,htu:r,iat:Math.floor(Date.now()/1e3)},c=Buffer.from(JSON.stringify(l)).toString("base64url"),u=Buffer.from(JSON.stringify(d)).toString("base64url"),f=`${c}.${u}`,_=(0,g.sign)("sha256",Buffer.from(f),i),p=this.derToRawSignature(_).toString("base64url");return`${f}.${p}`}catch(e){throw new i.CredentialsProviderError(`Failed to generate Dpop proof: ${e instanceof Error?e.message:String(e)}`,{logger:this.logger,tryNextLink:!1})}}}let h=async(e,n)=>{let o,a=await (o={...n,profile:e},async({callerClientConfig:e}={})=>{o?.logger?.debug?.("@aws-sdk/credential-providers - fromLoginCredentials");let n=await (0,t.parseKnownFiles)(o||{}),a=(0,r.getProfileName)({profile:o?.profile??e?.profile}),l=n[a];if(!l?.login_session)throw new i.CredentialsProviderError(`Profile ${a} does not contain login_session.`,{tryNextLink:!0,logger:o?.logger});let d=new p(l,o,e),c=await d.loadCredentials();return(0,s.setCredentialFeature)(c,"CREDENTIALS_LOGIN","AD")})();return(0,s.setCredentialFeature)(a,"CREDENTIALS_PROFILE_LOGIN","AC")},w=async(r,t)=>e.A(285365).then(({fromProcess:e})=>e({...r,profile:t})().then(e=>(0,s.setCredentialFeature)(e,"CREDENTIALS_PROFILE_PROCESS","v"))),y=async(r,t,i={})=>{let{fromSSO:n}=await e.A(14115);return n({profile:r,logger:i.logger,parentClientConfig:i.parentClientConfig,clientConfig:i.clientConfig})().then(e=>t.sso_session?(0,s.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SSO","r"):(0,s.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SSO_LEGACY","t"))},C=e=>!!e&&"object"==typeof e&&"string"==typeof e.aws_access_key_id&&"string"==typeof e.aws_secret_access_key&&["undefined","string"].indexOf(typeof e.aws_session_token)>-1&&["undefined","string"].indexOf(typeof e.aws_account_id)>-1,k=async(e,r)=>{r?.logger?.debug("@aws-sdk/credential-provider-ini - resolveStaticCredentials");let t={accessKeyId:e.aws_access_key_id,secretAccessKey:e.aws_secret_access_key,sessionToken:e.aws_session_token,...e.aws_credential_scope&&{credentialScope:e.aws_credential_scope},...e.aws_account_id&&{accountId:e.aws_account_id}};return(0,s.setCredentialFeature)(t,"CREDENTIALS_PROFILE","n")},m=async(r,t)=>e.A(652170).then(({fromTokenFile:e})=>e({webIdentityTokenFile:r.web_identity_token_file,roleArn:r.role_arn,roleSessionName:r.role_session_name,roleAssumerWithWebIdentity:t.roleAssumerWithWebIdentity,logger:t.logger,parentClientConfig:t.parentClientConfig})().then(e=>(0,s.setCredentialFeature)(e,"CREDENTIALS_PROFILE_STS_WEB_ID_TOKEN","q"))),E=async(e,r,t,s={},n=!1)=>{let o=r[e];if(Object.keys(s).length>0&&C(o))return k(o,t);if(n||((e,{profile:r="default",logger:t}={})=>!!e&&"object"==typeof e&&"string"==typeof e.role_arn&&["undefined","string"].indexOf(typeof e.role_session_name)>-1&&["undefined","string"].indexOf(typeof e.external_id)>-1&&["undefined","string"].indexOf(typeof e.mfa_serial)>-1&&(((e,{profile:r,logger:t})=>{let i="string"==typeof e.source_profile&&void 0===e.credential_source;return i&&t?.debug?.(`    ${r} isAssumeRoleWithSourceProfile source_profile=${e.source_profile}`),i})(e,{profile:r,logger:t})||((e,{profile:r,logger:t})=>{let i="string"==typeof e.credential_source&&void 0===e.source_profile;return i&&t?.debug?.(`    ${r} isCredentialSourceProfile credential_source=${e.credential_source}`),i})(e,{profile:r,logger:t})))(o,{profile:e,logger:t.logger}))return a(e,r,t,s,E);if(C(o))return k(o,t);if(o&&"object"==typeof o&&"string"==typeof o.web_identity_token_file&&"string"==typeof o.role_arn&&["undefined","string"].indexOf(typeof o.role_session_name)>-1)return m(o,t);if(o&&"object"==typeof o&&"string"==typeof o.credential_process)return w(t,e);if(o&&("string"==typeof o.sso_start_url||"string"==typeof o.sso_account_id||"string"==typeof o.sso_session||"string"==typeof o.sso_region||"string"==typeof o.sso_role_name))return await y(e,o,t);if(o&&o.login_session)return h(e,t);throw new i.CredentialsProviderError(`Could not resolve credentials using profile: [${e}] in configuration/credentials file(s).`,{logger:t.logger})},v=(e={})=>async({callerClientConfig:i}={})=>{let s={...e,parentClientConfig:{...i,...e.parentClientConfig}};s.logger?.debug("@aws-sdk/credential-provider-ini - fromIni");let n=await (0,t.parseKnownFiles)(s);return E((0,r.getProfileName)({profile:e.profile??i?.profile}),n,s)};e.s(["fromIni",0,v],324518),e.i(324518),e.s(["fromIni",0,v],901346)},493306,e=>{e.v(r=>Promise.all(["server/chunks/node_modules_@aws-sdk_credential-provider-http_dist-es_index_639d0ca6.js"].map(r=>e.l(r))).then(()=>r(838788)))},514277,e=>{e.v(r=>Promise.all(["server/chunks/node_modules_@smithy_credential-provider-imds_dist-es_index_6334b510.js"].map(r=>e.l(r))).then(()=>r(174340)))},931605,e=>{e.v(r=>Promise.all(["server/chunks/node_modules_@aws-sdk_credential-provider-env_dist-es_index_55d96139.js"].map(r=>e.l(r))).then(()=>r(697301)))},643109,e=>{e.v(r=>Promise.all(["server/chunks/node_modules_99f91693._.js","server/chunks/node_modules_@aws-sdk_nested-clients_dist-es_submodules_sts_index_c78619b3.js"].map(r=>e.l(r))).then(()=>r(90222)))},754608,e=>{e.v(r=>Promise.all(["server/chunks/node_modules_99f91693._.js","server/chunks/node_modules_@aws-sdk_nested-clients_dist-es_submodules_signin_index_6712dec9.js"].map(r=>e.l(r))).then(()=>r(820083)))},285365,e=>{e.v(r=>Promise.all(["server/chunks/node_modules_67bd24db._.js"].map(r=>e.l(r))).then(()=>r(333073)))},14115,e=>{e.v(r=>Promise.all(["server/chunks/node_modules_@aws-sdk_credential-provider-sso_dist-es_31d9426a._.js"].map(r=>e.l(r))).then(()=>r(826709)))},652170,e=>{e.v(r=>Promise.all(["server/chunks/node_modules_fa738638._.js"].map(r=>e.l(r))).then(()=>r(623492)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__30720bb1._.js.map