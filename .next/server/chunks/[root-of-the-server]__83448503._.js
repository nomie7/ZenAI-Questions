module.exports=[335452,e=>e.a(async(t,r)=>{try{let t=await e.y("pdf-to-img");e.n(t),r()}catch(e){r(e)}},!0),242852,e=>e.a(async(t,r)=>{try{var s=e.i(335452),o=t([s]);[s]=o.then?(await o)():o;let a=["pdf","ppt","pptx","doc","docx","xls","xlsx","txt","md","html","htm","png","jpg","jpeg","tiff","bmp","heic"];class n{baseUrl;apiKey;timeout;constructor(){this.baseUrl=process.env.UNSTRUCTURED_URL||"",this.apiKey=process.env.UNSTRUCTURED_API_KEY||"",this.timeout=Number(process.env.UNSTRUCTURED_TIMEOUT)||3e5}async parse(e,t){if(!this.baseUrl)throw Error("UNSTRUCTURED_URL not set. Please configure the Unstructured API endpoint.");if(!this.apiKey)throw Error("UNSTRUCTURED_API_KEY not set. Please configure the API key.");let r=t.toLowerCase().split(".").pop()||"";if(!a.includes(r))throw Error(`Unsupported file type: ${r}. Supported: ${a.join(", ")}`);let s="pdf"===r;return(console.log(`Processing ${r.toUpperCase()} with Unstructured API: ${t}`),s)?this.processPdfPageByPage(e,t):this.processWholeDocument(e,t)}async processPdfPageByPage(e,t){let r=[],s=[],o=await this.extractPdfPageImages(e);if(console.log(`Extracted ${o.size} page images`),0===o.size)throw Error("Failed to extract any pages from PDF");for(let[e,t]of o)try{console.log(`Processing page ${e}/${o.size}...`);let s=(await this.callUnstructuredApi(t,`page_${e}.png`)).filter(e=>e.text&&e.text.trim()).map(e=>e.text.trim());r.push({pageNumber:e,text:s.join("\n\n")||`[No text extracted from page ${e}]`,imageBuffer:t})}catch(a){let o=`Page ${e}: ${a.message}`;console.error(o),s.push(o),r.push({pageNumber:e,text:`[Error processing page ${e}]`,imageBuffer:t})}return s.length>0?console.warn(`Completed with ${s.length}/${o.size} errors`):console.log(`Successfully processed all ${o.size} pages`),{pages:r,metadata:{pageCount:r.length,parserUsed:"unstructured"}}}async processWholeDocument(e,t){let r=await this.callUnstructuredApi(e,t);console.log(`Received ${r.length} elements from Unstructured API`);let s=new Map;for(let e of r){let t=e.metadata?.page_number??1;s.has(t)||s.set(t,[]),e.text&&e.text.trim()&&s.get(t).push(e.text.trim())}let o=[];for(let e of Array.from(s.keys()).sort((e,t)=>e-t)){let t=s.get(e)||[];o.push({pageNumber:e,text:t.join("\n\n"),imageBuffer:void 0})}return 0===o.length&&(console.warn("No pages extracted from document"),o.push({pageNumber:1,text:"[No text extracted from document]",imageBuffer:void 0})),console.log(`Successfully processed ${o.length} pages/slides`),{pages:o,metadata:{pageCount:o.length,parserUsed:"unstructured"}}}async extractPdfPageImages(e){let t=new Map;try{let r=await (0,s.pdf)(e,{scale:1.5}),o=0;for await(let e of r)o++,t.set(o,Buffer.from(e))}catch(e){console.warn("Failed to extract PDF page images:",e.message)}return t}async callUnstructuredApi(e,t){let r=new FormData;r.append("files",new Blob([new Uint8Array(e)]),t),r.append("strategy","hi_res");let s=new AbortController,o=setTimeout(()=>s.abort(),this.timeout);try{let e=await fetch(`${this.baseUrl}/general/v0/general`,{method:"POST",headers:{accept:"application/json","unstructured-api-key":this.apiKey},body:r,signal:s.signal});if(clearTimeout(o),!e.ok){let t=await e.text();if(524===e.status)throw Error("Document processing timed out (Cloudflare 524). The document may be too large. Try a smaller document or increase server timeout.");throw Error(`Unstructured API error: HTTP ${e.status}: ${t.slice(0,300)}`)}return await e.json()}catch(e){if(clearTimeout(o),"AbortError"===e.name)throw Error(`Document processing timed out after ${this.timeout/1e3}s. Try a smaller document or increase UNSTRUCTURED_TIMEOUT.`);throw e}}}e.s(["UnstructuredParser",()=>n]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__83448503._.js.map