{"version":3,"sources":["../../../node_modules/%40smithy/shared-ini-file-loader/dist-es/externalDataInterceptor.js","../../../node_modules/%40aws-sdk/credential-provider-process/dist-es/fromProcess.js","../../../node_modules/%40aws-sdk/credential-provider-process/dist-es/resolveProcessCredentials.js","../../../node_modules/%40aws-sdk/credential-provider-process/dist-es/getValidatedProcessCredentials.js"],"sourcesContent":["import { tokenIntercept } from \"./getSSOTokenFromFile\";\nimport { fileIntercept } from \"./readFile\";\nexport const externalDataInterceptor = {\n    getFileRecord() {\n        return fileIntercept;\n    },\n    interceptFile(path, contents) {\n        fileIntercept[path] = Promise.resolve(contents);\n    },\n    getTokenRecord() {\n        return tokenIntercept;\n    },\n    interceptToken(id, contents) {\n        tokenIntercept[id] = contents;\n    },\n};\n","import { getProfileName, parseKnownFiles } from \"@smithy/shared-ini-file-loader\";\nimport { resolveProcessCredentials } from \"./resolveProcessCredentials\";\nexport const fromProcess = (init = {}) => async ({ callerClientConfig } = {}) => {\n    init.logger?.debug(\"@aws-sdk/credential-provider-process - fromProcess\");\n    const profiles = await parseKnownFiles(init);\n    return resolveProcessCredentials(getProfileName({\n        profile: init.profile ?? callerClientConfig?.profile,\n    }), profiles, init.logger);\n};\n","import { CredentialsProviderError } from \"@smithy/property-provider\";\nimport { externalDataInterceptor } from \"@smithy/shared-ini-file-loader\";\nimport { exec } from \"child_process\";\nimport { promisify } from \"util\";\nimport { getValidatedProcessCredentials } from \"./getValidatedProcessCredentials\";\nexport const resolveProcessCredentials = async (profileName, profiles, logger) => {\n    const profile = profiles[profileName];\n    if (profiles[profileName]) {\n        const credentialProcess = profile[\"credential_process\"];\n        if (credentialProcess !== undefined) {\n            const execPromise = promisify(externalDataInterceptor?.getTokenRecord?.().exec ?? exec);\n            try {\n                const { stdout } = await execPromise(credentialProcess);\n                let data;\n                try {\n                    data = JSON.parse(stdout.trim());\n                }\n                catch {\n                    throw Error(`Profile ${profileName} credential_process returned invalid JSON.`);\n                }\n                return getValidatedProcessCredentials(profileName, data, profiles);\n            }\n            catch (error) {\n                throw new CredentialsProviderError(error.message, { logger });\n            }\n        }\n        else {\n            throw new CredentialsProviderError(`Profile ${profileName} did not contain credential_process.`, { logger });\n        }\n    }\n    else {\n        throw new CredentialsProviderError(`Profile ${profileName} could not be found in shared credentials file.`, {\n            logger,\n        });\n    }\n};\n","import { setCredentialFeature } from \"@aws-sdk/core/client\";\nexport const getValidatedProcessCredentials = (profileName, data, profiles) => {\n    if (data.Version !== 1) {\n        throw Error(`Profile ${profileName} credential_process did not return Version 1.`);\n    }\n    if (data.AccessKeyId === undefined || data.SecretAccessKey === undefined) {\n        throw Error(`Profile ${profileName} credential_process returned invalid credentials.`);\n    }\n    if (data.Expiration) {\n        const currentTime = new Date();\n        const expireTime = new Date(data.Expiration);\n        if (expireTime < currentTime) {\n            throw Error(`Profile ${profileName} credential_process returned expired credentials.`);\n        }\n    }\n    let accountId = data.AccountId;\n    if (!accountId && profiles?.[profileName]?.aws_account_id) {\n        accountId = profiles[profileName].aws_account_id;\n    }\n    const credentials = {\n        accessKeyId: data.AccessKeyId,\n        secretAccessKey: data.SecretAccessKey,\n        ...(data.SessionToken && { sessionToken: data.SessionToken }),\n        ...(data.Expiration && { expiration: new Date(data.Expiration) }),\n        ...(data.CredentialScope && { credentialScope: data.CredentialScope }),\n        ...(accountId && { accountId }),\n    };\n    setCredentialFeature(credentials, \"CREDENTIALS_PROCESS\", \"w\");\n    return credentials;\n};\n"],"names":[],"mappings":"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","ignoreList":[0,1,2,3]}