{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/utils/safety.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.GoogleAISafetyError = void 0;\nclass GoogleAISafetyError extends Error {\n    constructor(response, message) {\n        super(message);\n        Object.defineProperty(this, \"response\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        Object.defineProperty(this, \"reply\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"\"\n        });\n        this.response = response;\n    }\n}\nexports.GoogleAISafetyError = GoogleAISafetyError;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,mBAAmB,GAAG,KAAK;AACnC,MAAM,4BAA4B;IAC9B,YAAY,QAAQ,EAAE,OAAO,CAAE;QAC3B,KAAK,CAAC;QACN,OAAO,cAAc,CAAC,IAAI,EAAE,YAAY;YACpC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;QACA,8DAA8D;QAC9D,OAAO,cAAc,CAAC,IAAI,EAAE,SAAS;YACjC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO;QACX;QACA,IAAI,CAAC,QAAQ,GAAG;IACpB;AACJ;AACA,QAAQ,mBAAmB,GAAG","ignoreList":[0]}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/types-anthropic.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK","ignoreList":[0]}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/types.cjs"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.GeminiToolAttributes = exports.GeminiSearchToolAttributes = exports.GoogleAISafetyMethod = exports.GoogleAISafetyThreshold = exports.GoogleAISafetyCategory = void 0;\n__exportStar(require(\"./types-anthropic.cjs\"), exports);\nexports.GoogleAISafetyCategory = {\n    Harassment: \"HARM_CATEGORY_HARASSMENT\",\n    HARASSMENT: \"HARM_CATEGORY_HARASSMENT\",\n    HARM_CATEGORY_HARASSMENT: \"HARM_CATEGORY_HARASSMENT\",\n    HateSpeech: \"HARM_CATEGORY_HATE_SPEECH\",\n    HATE_SPEECH: \"HARM_CATEGORY_HATE_SPEECH\",\n    HARM_CATEGORY_HATE_SPEECH: \"HARM_CATEGORY_HATE_SPEECH\",\n    SexuallyExplicit: \"HARM_CATEGORY_SEXUALLY_EXPLICIT\",\n    SEXUALLY_EXPLICIT: \"HARM_CATEGORY_SEXUALLY_EXPLICIT\",\n    HARM_CATEGORY_SEXUALLY_EXPLICIT: \"HARM_CATEGORY_SEXUALLY_EXPLICIT\",\n    Dangerous: \"HARM_CATEGORY_DANGEROUS\",\n    DANGEROUS: \"HARM_CATEGORY_DANGEROUS\",\n    HARM_CATEGORY_DANGEROUS: \"HARM_CATEGORY_DANGEROUS\",\n    CivicIntegrity: \"HARM_CATEGORY_CIVIC_INTEGRITY\",\n    CIVIC_INTEGRITY: \"HARM_CATEGORY_CIVIC_INTEGRITY\",\n    HARM_CATEGORY_CIVIC_INTEGRITY: \"HARM_CATEGORY_CIVIC_INTEGRITY\",\n};\nexports.GoogleAISafetyThreshold = {\n    None: \"BLOCK_NONE\",\n    NONE: \"BLOCK_NONE\",\n    BLOCK_NONE: \"BLOCK_NONE\",\n    Few: \"BLOCK_ONLY_HIGH\",\n    FEW: \"BLOCK_ONLY_HIGH\",\n    BLOCK_ONLY_HIGH: \"BLOCK_ONLY_HIGH\",\n    Some: \"BLOCK_MEDIUM_AND_ABOVE\",\n    SOME: \"BLOCK_MEDIUM_AND_ABOVE\",\n    BLOCK_MEDIUM_AND_ABOVE: \"BLOCK_MEDIUM_AND_ABOVE\",\n    Most: \"BLOCK_LOW_AND_ABOVE\",\n    MOST: \"BLOCK_LOW_AND_ABOVE\",\n    BLOCK_LOW_AND_ABOVE: \"BLOCK_LOW_AND_ABOVE\",\n    Off: \"OFF\",\n    OFF: \"OFF\",\n    BLOCK_OFF: \"OFF\",\n};\nexports.GoogleAISafetyMethod = {\n    Severity: \"SEVERITY\",\n    Probability: \"PROBABILITY\",\n};\nexports.GeminiSearchToolAttributes = [\n    \"googleSearchRetrieval\",\n    \"googleSearch\",\n];\nexports.GeminiToolAttributes = [\n    \"functionDeclaration\",\n    \"retrieval\",\n    ...exports.GeminiSearchToolAttributes,\n];\n"],"names":[],"mappings":"AACA,IAAI,kBAAkB,4DAAS,yDAAK,eAAe,IAAK,CAAC,OAAO,MAAM,GAAI,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;IAC1F,IAAI,OAAO,WAAW,KAAK;IAC3B,IAAI,OAAO,OAAO,wBAAwB,CAAC,GAAG;IAC9C,IAAI,CAAC,QAAQ,CAAC,SAAS,OAAO,CAAC,EAAE,UAAU,GAAG,KAAK,QAAQ,IAAI,KAAK,YAAY,GAAG;QACjF,OAAO;YAAE,YAAY;YAAM,KAAK;gBAAa,OAAO,CAAC,CAAC,EAAE;YAAE;QAAE;IAC9D;IACA,OAAO,cAAc,CAAC,GAAG,IAAI;AACjC,IAAM,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;IACtB,IAAI,OAAO,WAAW,KAAK;IAC3B,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,EAAE;AAChB,CAAE;AACF,IAAI,eAAe,4DAAS,yDAAK,YAAY,IAAK,SAAS,CAAC,EAAE,QAAO;IACjE,IAAK,IAAI,KAAK,EAAG,IAAI,MAAM,aAAa,CAAC,OAAO,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,UAAS,IAAI,gBAAgB,UAAS,GAAG;AAC3H;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,oBAAoB,GAAG,QAAQ,0BAA0B,GAAG,QAAQ,oBAAoB,GAAG,QAAQ,uBAAuB,GAAG,QAAQ,sBAAsB,GAAG,KAAK;AAC3K,2IAA+C;AAC/C,QAAQ,sBAAsB,GAAG;IAC7B,YAAY;IACZ,YAAY;IACZ,0BAA0B;IAC1B,YAAY;IACZ,aAAa;IACb,2BAA2B;IAC3B,kBAAkB;IAClB,mBAAmB;IACnB,iCAAiC;IACjC,WAAW;IACX,WAAW;IACX,yBAAyB;IACzB,gBAAgB;IAChB,iBAAiB;IACjB,+BAA+B;AACnC;AACA,QAAQ,uBAAuB,GAAG;IAC9B,MAAM;IACN,MAAM;IACN,YAAY;IACZ,KAAK;IACL,KAAK;IACL,iBAAiB;IACjB,MAAM;IACN,MAAM;IACN,wBAAwB;IACxB,MAAM;IACN,MAAM;IACN,qBAAqB;IACrB,KAAK;IACL,KAAK;IACL,WAAW;AACf;AACA,QAAQ,oBAAoB,GAAG;IAC3B,UAAU;IACV,aAAa;AACjB;AACA,QAAQ,0BAA0B,GAAG;IACjC;IACA;CACH;AACD,QAAQ,oBAAoB,GAAG;IAC3B;IACA;OACG,QAAQ,0BAA0B;CACxC","ignoreList":[0]}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/utils/zod_to_gemini_parameters.cjs"],"sourcesContent":["\"use strict\";\n/* eslint-disable @typescript-eslint/no-unused-vars */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.jsonSchemaToGeminiParameters = exports.zodToGeminiParameters = exports.removeAdditionalProperties = void 0;\nconst zod_to_json_schema_1 = require(\"zod-to-json-schema\");\nfunction removeAdditionalProperties(\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nobj) {\n    if (typeof obj === \"object\" && obj !== null) {\n        const newObj = { ...obj };\n        if (\"additionalProperties\" in newObj) {\n            delete newObj.additionalProperties;\n        }\n        for (const key in newObj) {\n            if (key in newObj) {\n                if (Array.isArray(newObj[key])) {\n                    newObj[key] = newObj[key].map(removeAdditionalProperties);\n                }\n                else if (typeof newObj[key] === \"object\" && newObj[key] !== null) {\n                    newObj[key] = removeAdditionalProperties(newObj[key]);\n                }\n            }\n        }\n        return newObj;\n    }\n    return obj;\n}\nexports.removeAdditionalProperties = removeAdditionalProperties;\nfunction zodToGeminiParameters(\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nzodObj) {\n    // Gemini doesn't accept either the $schema or additionalProperties\n    // attributes, so we need to explicitly remove them.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const jsonSchema = removeAdditionalProperties((0, zod_to_json_schema_1.zodToJsonSchema)(zodObj));\n    const { $schema, ...rest } = jsonSchema;\n    return rest;\n}\nexports.zodToGeminiParameters = zodToGeminiParameters;\nfunction jsonSchemaToGeminiParameters(\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nschema) {\n    // Gemini doesn't accept either the $schema or additionalProperties\n    // attributes, so we need to explicitly remove them.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const jsonSchema = removeAdditionalProperties(schema);\n    const { $schema, ...rest } = jsonSchema;\n    return rest;\n}\nexports.jsonSchemaToGeminiParameters = jsonSchemaToGeminiParameters;\n"],"names":[],"mappings":"AACA,oDAAoD,GACpD,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,4BAA4B,GAAG,QAAQ,qBAAqB,GAAG,QAAQ,0BAA0B,GAAG,KAAK;AACjH,MAAM;AACN,SAAS,2BACT,8DAA8D;AAC9D,GAAG;IACC,IAAI,OAAO,QAAQ,YAAY,QAAQ,MAAM;QACzC,MAAM,SAAS;YAAE,GAAG,GAAG;QAAC;QACxB,IAAI,0BAA0B,QAAQ;YAClC,OAAO,OAAO,oBAAoB;QACtC;QACA,IAAK,MAAM,OAAO,OAAQ;YACtB,IAAI,OAAO,QAAQ;gBACf,IAAI,MAAM,OAAO,CAAC,MAAM,CAAC,IAAI,GAAG;oBAC5B,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC;gBAClC,OACK,IAAI,OAAO,MAAM,CAAC,IAAI,KAAK,YAAY,MAAM,CAAC,IAAI,KAAK,MAAM;oBAC9D,MAAM,CAAC,IAAI,GAAG,2BAA2B,MAAM,CAAC,IAAI;gBACxD;YACJ;QACJ;QACA,OAAO;IACX;IACA,OAAO;AACX;AACA,QAAQ,0BAA0B,GAAG;AACrC,SAAS,sBACT,8DAA8D;AAC9D,MAAM;IACF,mEAAmE;IACnE,oDAAoD;IACpD,8DAA8D;IAC9D,MAAM,aAAa,2BAA2B,CAAC,GAAG,qBAAqB,eAAe,EAAE;IACxF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,GAAG;IAC7B,OAAO;AACX;AACA,QAAQ,qBAAqB,GAAG;AAChC,SAAS,6BACT,8DAA8D;AAC9D,MAAM;IACF,mEAAmE;IACnE,oDAAoD;IACpD,8DAA8D;IAC9D,MAAM,aAAa,2BAA2B;IAC9C,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,GAAG;IAC7B,OAAO;AACX;AACA,QAAQ,4BAA4B,GAAG","ignoreList":[0]}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/utils/gemini.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isModelGemini = exports.validateGeminiParams = exports.getGeminiAPI = exports.MessageGeminiSafetyHandler = exports.DefaultGeminiSafetyHandler = void 0;\nconst uuid_1 = require(\"uuid\");\nconst messages_1 = require(\"@langchain/core/messages\");\nconst outputs_1 = require(\"@langchain/core/outputs\");\nconst function_calling_1 = require(\"@langchain/core/utils/function_calling\");\nconst safety_js_1 = require(\"./safety.cjs\");\nconst types_js_1 = require(\"../types.cjs\");\nconst zod_to_gemini_parameters_js_1 = require(\"./zod_to_gemini_parameters.cjs\");\nclass DefaultGeminiSafetyHandler {\n    constructor(settings) {\n        Object.defineProperty(this, \"errorFinish\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: [\"SAFETY\", \"RECITATION\", \"OTHER\"]\n        });\n        this.errorFinish = settings?.errorFinish ?? this.errorFinish;\n    }\n    handleDataPromptFeedback(response, data) {\n        // Check to see if our prompt was blocked in the first place\n        const promptFeedback = data?.promptFeedback;\n        const blockReason = promptFeedback?.blockReason;\n        if (blockReason) {\n            throw new safety_js_1.GoogleAISafetyError(response, `Prompt blocked: ${blockReason}`);\n        }\n        return data;\n    }\n    handleDataFinishReason(response, data) {\n        const firstCandidate = data?.candidates?.[0];\n        const finishReason = firstCandidate?.finishReason;\n        if (this.errorFinish.includes(finishReason)) {\n            throw new safety_js_1.GoogleAISafetyError(response, `Finish reason: ${finishReason}`);\n        }\n        return data;\n    }\n    handleData(response, data) {\n        let ret = data;\n        ret = this.handleDataPromptFeedback(response, ret);\n        ret = this.handleDataFinishReason(response, ret);\n        return ret;\n    }\n    handle(response) {\n        let newdata;\n        if (\"nextChunk\" in response.data) {\n            // TODO: This is a stream. How to handle?\n            newdata = response.data;\n        }\n        else if (Array.isArray(response.data)) {\n            // If it is an array, try to handle every item in the array\n            try {\n                newdata = response.data.map((item) => this.handleData(response, item));\n            }\n            catch (xx) {\n                // eslint-disable-next-line no-instanceof/no-instanceof\n                if (xx instanceof safety_js_1.GoogleAISafetyError) {\n                    throw new safety_js_1.GoogleAISafetyError(response, xx.message);\n                }\n                else {\n                    throw xx;\n                }\n            }\n        }\n        else {\n            const data = response.data;\n            newdata = this.handleData(response, data);\n        }\n        return {\n            ...response,\n            data: newdata,\n        };\n    }\n}\nexports.DefaultGeminiSafetyHandler = DefaultGeminiSafetyHandler;\nclass MessageGeminiSafetyHandler extends DefaultGeminiSafetyHandler {\n    constructor(settings) {\n        super(settings);\n        Object.defineProperty(this, \"msg\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"\"\n        });\n        Object.defineProperty(this, \"forceNewMessage\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        this.msg = settings?.msg ?? this.msg;\n        this.forceNewMessage = settings?.forceNewMessage ?? this.forceNewMessage;\n    }\n    setMessage(data) {\n        const ret = data;\n        if (this.forceNewMessage ||\n            !data?.candidates?.[0]?.content?.parts?.length) {\n            ret.candidates = data.candidates ?? [];\n            ret.candidates[0] = data.candidates[0] ?? {};\n            ret.candidates[0].content = data.candidates[0].content ?? {};\n            ret.candidates[0].content = {\n                role: \"model\",\n                parts: [{ text: this.msg }],\n            };\n        }\n        return ret;\n    }\n    handleData(response, data) {\n        try {\n            return super.handleData(response, data);\n        }\n        catch (xx) {\n            return this.setMessage(data);\n        }\n    }\n}\nexports.MessageGeminiSafetyHandler = MessageGeminiSafetyHandler;\nconst extractMimeType = (str) => {\n    if (str.startsWith(\"data:\")) {\n        return {\n            mimeType: str.split(\":\")[1].split(\";\")[0],\n            data: str.split(\",\")[1],\n        };\n    }\n    return null;\n};\nfunction getGeminiAPI(config) {\n    function messageContentText(content) {\n        if (content?.text && content?.text.length > 0) {\n            return {\n                text: content.text,\n            };\n        }\n        else {\n            return null;\n        }\n    }\n    function messageContentImageUrl(content) {\n        const url = typeof content.image_url === \"string\"\n            ? content.image_url\n            : content.image_url.url;\n        if (!url) {\n            throw new Error(\"Missing Image URL\");\n        }\n        const mimeTypeAndData = extractMimeType(url);\n        if (mimeTypeAndData) {\n            return {\n                inlineData: mimeTypeAndData,\n            };\n        }\n        else {\n            // FIXME - need some way to get mime type\n            return {\n                fileData: {\n                    mimeType: \"image/png\",\n                    fileUri: url,\n                },\n            };\n        }\n    }\n    async function blobToFileData(blob) {\n        return {\n            fileData: {\n                fileUri: blob.path,\n                mimeType: blob.mimetype,\n            },\n        };\n    }\n    async function fileUriContentToBlob(uri) {\n        return config?.mediaManager?.getMediaBlob(uri);\n    }\n    async function messageContentMedia(\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    content) {\n        if (\"mimeType\" in content && \"data\" in content) {\n            return {\n                inlineData: {\n                    mimeType: content.mimeType,\n                    data: content.data,\n                },\n            };\n        }\n        else if (\"mimeType\" in content && \"fileUri\" in content) {\n            return {\n                fileData: {\n                    mimeType: content.mimeType,\n                    fileUri: content.fileUri,\n                },\n            };\n        }\n        else {\n            const uri = content.fileUri;\n            const blob = await fileUriContentToBlob(uri);\n            if (blob) {\n                return await blobToFileData(blob);\n            }\n        }\n        throw new Error(`Invalid media content: ${JSON.stringify(content, null, 1)}`);\n    }\n    async function messageContentComplexToPart(content) {\n        switch (content.type) {\n            case \"text\":\n                if (\"text\" in content) {\n                    return messageContentText(content);\n                }\n                break;\n            case \"image_url\":\n                if (\"image_url\" in content) {\n                    // Type guard for MessageContentImageUrl\n                    return messageContentImageUrl(content);\n                }\n                break;\n            case \"media\":\n                return await messageContentMedia(content);\n            default:\n                throw new Error(`Unsupported type \"${content.type}\" received while converting message to message parts: ${content}`);\n        }\n        throw new Error(`Cannot coerce \"${content.type}\" message part into a string.`);\n    }\n    async function messageContentComplexToParts(content) {\n        const contents = content.map(messageContentComplexToPart);\n        return Promise.all(contents);\n    }\n    async function messageContentToParts(content) {\n        // Convert a string to a text type MessageContent if needed\n        const messageContent = typeof content === \"string\"\n            ? [\n                {\n                    type: \"text\",\n                    text: content,\n                },\n            ]\n            : content;\n        // Get all of the parts, even those that don't correctly resolve\n        const allParts = await messageContentComplexToParts(messageContent);\n        // Remove any invalid parts\n        const parts = allParts.reduce((acc, val) => {\n            if (val) {\n                return [...acc, val];\n            }\n            else {\n                return acc;\n            }\n        }, []);\n        return parts;\n    }\n    function messageToolCallsToParts(toolCalls) {\n        if (!toolCalls || toolCalls.length === 0) {\n            return [];\n        }\n        return toolCalls.map((tool) => {\n            let args = {};\n            if (tool?.function?.arguments) {\n                const argStr = tool.function.arguments;\n                args = JSON.parse(argStr);\n            }\n            return {\n                functionCall: {\n                    name: tool.function.name,\n                    args,\n                },\n            };\n        });\n    }\n    function messageKwargsToParts(kwargs) {\n        const ret = [];\n        if (kwargs?.tool_calls) {\n            ret.push(...messageToolCallsToParts(kwargs.tool_calls));\n        }\n        return ret;\n    }\n    async function roleMessageToContent(role, message) {\n        const contentParts = await messageContentToParts(message.content);\n        let toolParts;\n        if ((0, messages_1.isAIMessage)(message) && !!message.tool_calls?.length) {\n            toolParts = message.tool_calls.map((toolCall) => ({\n                functionCall: {\n                    name: toolCall.name,\n                    args: toolCall.args,\n                },\n            }));\n        }\n        else {\n            toolParts = messageKwargsToParts(message.additional_kwargs);\n        }\n        const parts = [...contentParts, ...toolParts];\n        return [\n            {\n                role,\n                parts,\n            },\n        ];\n    }\n    async function systemMessageToContent(message) {\n        return config?.useSystemInstruction\n            ? roleMessageToContent(\"system\", message)\n            : [\n                ...(await roleMessageToContent(\"user\", message)),\n                ...(await roleMessageToContent(\"model\", new messages_1.AIMessage(\"Ok\"))),\n            ];\n    }\n    function toolMessageToContent(message, prevMessage) {\n        const contentStr = typeof message.content === \"string\"\n            ? message.content\n            : message.content.reduce((acc, content) => {\n                if (content.type === \"text\") {\n                    return acc + content.text;\n                }\n                else {\n                    return acc;\n                }\n            }, \"\");\n        // Hacky :(\n        const responseName = ((0, messages_1.isAIMessage)(prevMessage) && !!prevMessage.tool_calls?.length\n            ? prevMessage.tool_calls[0].name\n            : prevMessage.name) ?? message.tool_call_id;\n        try {\n            const content = JSON.parse(contentStr);\n            return [\n                {\n                    role: \"function\",\n                    parts: [\n                        {\n                            functionResponse: {\n                                name: responseName,\n                                response: { content },\n                            },\n                        },\n                    ],\n                },\n            ];\n        }\n        catch (_) {\n            return [\n                {\n                    role: \"function\",\n                    parts: [\n                        {\n                            functionResponse: {\n                                name: responseName,\n                                response: { content: contentStr },\n                            },\n                        },\n                    ],\n                },\n            ];\n        }\n    }\n    async function baseMessageToContent(message, prevMessage) {\n        const type = message._getType();\n        switch (type) {\n            case \"system\":\n                return systemMessageToContent(message);\n            case \"human\":\n                return roleMessageToContent(\"user\", message);\n            case \"ai\":\n                return roleMessageToContent(\"model\", message);\n            case \"tool\":\n                if (!prevMessage) {\n                    throw new Error(\"Tool messages cannot be the first message passed to the model.\");\n                }\n                return toolMessageToContent(message, prevMessage);\n            default:\n                console.log(`Unsupported message type: ${type}`);\n                return [];\n        }\n    }\n    function textPartToMessageContent(part) {\n        return {\n            type: \"text\",\n            text: part.text,\n        };\n    }\n    function inlineDataPartToMessageContent(part) {\n        return {\n            type: \"image_url\",\n            image_url: `data:${part.inlineData.mimeType};base64,${part.inlineData.data}`,\n        };\n    }\n    function fileDataPartToMessageContent(part) {\n        return {\n            type: \"image_url\",\n            image_url: part.fileData.fileUri,\n        };\n    }\n    function partsToMessageContent(parts) {\n        return parts\n            .map((part) => {\n            if (part === undefined || part === null) {\n                return null;\n            }\n            else if (\"text\" in part) {\n                return textPartToMessageContent(part);\n            }\n            else if (\"inlineData\" in part) {\n                return inlineDataPartToMessageContent(part);\n            }\n            else if (\"fileData\" in part) {\n                return fileDataPartToMessageContent(part);\n            }\n            else {\n                return null;\n            }\n        })\n            .reduce((acc, content) => {\n            if (content) {\n                acc.push(content);\n            }\n            return acc;\n        }, []);\n    }\n    function toolRawToTool(raw) {\n        return {\n            id: raw.id,\n            type: raw.type,\n            function: {\n                name: raw.function.name,\n                arguments: JSON.stringify(raw.function.arguments),\n            },\n        };\n    }\n    function functionCallPartToToolRaw(part) {\n        return {\n            id: (0, uuid_1.v4)().replace(/-/g, \"\"),\n            type: \"function\",\n            function: {\n                name: part.functionCall.name,\n                arguments: part.functionCall.args ?? {},\n            },\n        };\n    }\n    function partsToToolsRaw(parts) {\n        return parts\n            .map((part) => {\n            if (part === undefined || part === null) {\n                return null;\n            }\n            else if (\"functionCall\" in part) {\n                return functionCallPartToToolRaw(part);\n            }\n            else {\n                return null;\n            }\n        })\n            .reduce((acc, content) => {\n            if (content) {\n                acc.push(content);\n            }\n            return acc;\n        }, []);\n    }\n    function toolsRawToTools(raws) {\n        return raws.map((raw) => toolRawToTool(raw));\n    }\n    function responseToGenerateContentResponseData(response) {\n        if (\"nextChunk\" in response.data) {\n            throw new Error(\"Cannot convert Stream to GenerateContentResponseData\");\n        }\n        else if (Array.isArray(response.data)) {\n            // Collapse the array of response data as if it was a single one\n            return response.data.reduce((acc, val) => {\n                // Add all the parts\n                // FIXME: Handle other candidates?\n                const valParts = val?.candidates?.[0]?.content?.parts ?? [];\n                acc.candidates[0].content.parts.push(...valParts);\n                // FIXME: Merge promptFeedback and safety settings\n                acc.promptFeedback = val.promptFeedback;\n                return acc;\n            });\n        }\n        else {\n            return response.data;\n        }\n    }\n    function responseToParts(response) {\n        const responseData = responseToGenerateContentResponseData(response);\n        const parts = responseData?.candidates?.[0]?.content?.parts ?? [];\n        return parts;\n    }\n    function partToText(part) {\n        return \"text\" in part ? part.text : \"\";\n    }\n    function responseToString(response) {\n        const parts = responseToParts(response);\n        const ret = parts.reduce((acc, part) => {\n            const val = partToText(part);\n            return acc + val;\n        }, \"\");\n        return ret;\n    }\n    function safeResponseTo(response, responseTo) {\n        const safetyHandler = config?.safetyHandler ?? new DefaultGeminiSafetyHandler();\n        try {\n            const safeResponse = safetyHandler.handle(response);\n            return responseTo(safeResponse);\n        }\n        catch (xx) {\n            // eslint-disable-next-line no-instanceof/no-instanceof\n            if (xx instanceof safety_js_1.GoogleAISafetyError) {\n                const ret = responseTo(xx.response);\n                xx.reply = ret;\n            }\n            throw xx;\n        }\n    }\n    function safeResponseToString(response) {\n        return safeResponseTo(response, responseToString);\n    }\n    function logprobResultToLogprob(result) {\n        const token = result?.token;\n        const logprob = result?.logProbability;\n        const encoder = new TextEncoder();\n        const bytes = Array.from(encoder.encode(token));\n        return {\n            token,\n            logprob,\n            bytes,\n        };\n    }\n    function candidateToLogprobs(candidate) {\n        const logprobs = candidate?.logprobsResult;\n        const chosenTokens = logprobs?.chosenCandidates ?? [];\n        const topTokens = logprobs?.topCandidates ?? [];\n        const content = [];\n        for (let co = 0; co < chosenTokens.length; co += 1) {\n            const chosen = chosenTokens[co];\n            const top = topTokens[co]?.candidates ?? [];\n            const logprob = logprobResultToLogprob(chosen);\n            logprob.top_logprobs = top.map((l) => logprobResultToLogprob(l));\n            content.push(logprob);\n        }\n        return {\n            content,\n        };\n    }\n    function responseToGenerationInfo(response) {\n        if (!Array.isArray(response.data)) {\n            return {};\n        }\n        const data = response.data[0];\n        return {\n            usage_metadata: {\n                prompt_token_count: data.usageMetadata?.promptTokenCount,\n                candidates_token_count: data.usageMetadata?.candidatesTokenCount,\n                total_token_count: data.usageMetadata?.totalTokenCount,\n            },\n            safety_ratings: data.candidates[0]?.safetyRatings?.map((rating) => ({\n                category: rating.category,\n                probability: rating.probability,\n                probability_score: rating.probabilityScore,\n                severity: rating.severity,\n                severity_score: rating.severityScore,\n            })),\n            citation_metadata: data.candidates[0]?.citationMetadata,\n            grounding_metadata: data.candidates[0]?.groundingMetadata,\n            finish_reason: data.candidates[0]?.finishReason,\n            avgLogprobs: data.candidates[0]?.avgLogprobs,\n            logprobs: candidateToLogprobs(data.candidates[0]),\n        };\n    }\n    function responseToChatGeneration(response) {\n        return new outputs_1.ChatGenerationChunk({\n            text: responseToString(response),\n            message: partToMessageChunk(responseToParts(response)[0]),\n            generationInfo: responseToGenerationInfo(response),\n        });\n    }\n    function safeResponseToChatGeneration(response) {\n        return safeResponseTo(response, responseToChatGeneration);\n    }\n    function chunkToString(chunk) {\n        if (chunk === null) {\n            return \"\";\n        }\n        else if (typeof chunk.content === \"string\") {\n            return chunk.content;\n        }\n        else if (chunk.content.length === 0) {\n            return \"\";\n        }\n        else if (chunk.content[0].type === \"text\") {\n            return chunk.content[0].text;\n        }\n        else {\n            throw new Error(`Unexpected chunk: ${chunk}`);\n        }\n    }\n    function partToMessageChunk(part) {\n        const fields = partsToBaseMessageChunkFields([part]);\n        if (typeof fields.content === \"string\") {\n            return new messages_1.AIMessageChunk(fields);\n        }\n        else if (fields.content.every((item) => item.type === \"text\")) {\n            const newContent = fields.content\n                .map((item) => (\"text\" in item ? item.text : \"\"))\n                .join(\"\");\n            return new messages_1.AIMessageChunk({\n                ...fields,\n                content: newContent,\n            });\n        }\n        return new messages_1.AIMessageChunk(fields);\n    }\n    function partToChatGeneration(part) {\n        const message = partToMessageChunk(part);\n        const text = partToText(part);\n        return new outputs_1.ChatGenerationChunk({\n            text,\n            message,\n        });\n    }\n    function groundingSupportByPart(groundingSupports) {\n        const ret = [];\n        if (!groundingSupports || groundingSupports.length === 0) {\n            return [];\n        }\n        groundingSupports?.forEach((groundingSupport) => {\n            const segment = groundingSupport?.segment;\n            const partIndex = segment?.partIndex ?? 0;\n            if (ret[partIndex]) {\n                ret[partIndex].push(groundingSupport);\n            }\n            else {\n                ret[partIndex] = [groundingSupport];\n            }\n        });\n        return ret;\n    }\n    function responseToGroundedChatGenerations(response) {\n        const parts = responseToParts(response);\n        if (parts.length === 0) {\n            return [];\n        }\n        // Citation and grounding information connected to each part / ChatGeneration\n        // to make sure they are available in downstream filters.\n        const candidate = response?.data\n            ?.candidates?.[0];\n        const groundingMetadata = candidate?.groundingMetadata;\n        const citationMetadata = candidate?.citationMetadata;\n        const groundingParts = groundingSupportByPart(groundingMetadata?.groundingSupports);\n        const ret = parts.map((part, index) => {\n            const gen = partToChatGeneration(part);\n            if (!gen.generationInfo) {\n                gen.generationInfo = {};\n            }\n            if (groundingMetadata) {\n                gen.generationInfo.groundingMetadata = groundingMetadata;\n                const groundingPart = groundingParts[index];\n                if (groundingPart) {\n                    gen.generationInfo.groundingSupport = groundingPart;\n                }\n            }\n            if (citationMetadata) {\n                gen.generationInfo.citationMetadata = citationMetadata;\n            }\n            return gen;\n        });\n        return ret;\n    }\n    function responseToChatGenerations(response) {\n        let ret = responseToGroundedChatGenerations(response);\n        if (ret.length === 0) {\n            return [];\n        }\n        if (ret.every((item) => typeof item.message.content === \"string\")) {\n            const combinedContent = ret.map((item) => item.message.content).join(\"\");\n            const combinedText = ret.map((item) => item.text).join(\"\");\n            const toolCallChunks = ret[ret.length - 1]?.message.additional_kwargs?.tool_calls?.map((toolCall, i) => ({\n                name: toolCall.function.name,\n                args: toolCall.function.arguments,\n                id: toolCall.id,\n                index: i,\n                type: \"tool_call_chunk\",\n            }));\n            let usageMetadata;\n            if (\"usageMetadata\" in response.data) {\n                usageMetadata = {\n                    input_tokens: response.data.usageMetadata.promptTokenCount,\n                    output_tokens: response.data.usageMetadata\n                        .candidatesTokenCount,\n                    total_tokens: response.data.usageMetadata.totalTokenCount,\n                };\n            }\n            ret = [\n                new outputs_1.ChatGenerationChunk({\n                    message: new messages_1.AIMessageChunk({\n                        content: combinedContent,\n                        additional_kwargs: ret[ret.length - 1]?.message.additional_kwargs,\n                        tool_call_chunks: toolCallChunks,\n                        usage_metadata: usageMetadata,\n                    }),\n                    text: combinedText,\n                    generationInfo: ret[ret.length - 1].generationInfo,\n                }),\n            ];\n        }\n        // Add logprobs information to the message\n        const candidate = response?.data\n            ?.candidates?.[0];\n        const avgLogprobs = candidate?.avgLogprobs;\n        const logprobs = candidateToLogprobs(candidate);\n        if (logprobs) {\n            ret[0].message.response_metadata = {\n                ...ret[0].message.response_metadata,\n                logprobs,\n                avgLogprobs,\n            };\n        }\n        return ret;\n    }\n    function responseToBaseMessageFields(response) {\n        const parts = responseToParts(response);\n        return partsToBaseMessageChunkFields(parts);\n    }\n    function partsToBaseMessageChunkFields(parts) {\n        const fields = {\n            content: partsToMessageContent(parts),\n            tool_call_chunks: [],\n            tool_calls: [],\n            invalid_tool_calls: [],\n        };\n        const rawTools = partsToToolsRaw(parts);\n        if (rawTools.length > 0) {\n            const tools = toolsRawToTools(rawTools);\n            for (const tool of tools) {\n                fields.tool_call_chunks?.push({\n                    name: tool.function.name,\n                    args: tool.function.arguments,\n                    id: tool.id,\n                    type: \"tool_call_chunk\",\n                });\n                try {\n                    fields.tool_calls?.push({\n                        name: tool.function.name,\n                        args: JSON.parse(tool.function.arguments),\n                        id: tool.id,\n                    });\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                }\n                catch (e) {\n                    fields.invalid_tool_calls?.push({\n                        name: tool.function.name,\n                        args: tool.function.arguments,\n                        id: tool.id,\n                        error: e.message,\n                        type: \"invalid_tool_call\",\n                    });\n                }\n            }\n            fields.additional_kwargs = {\n                tool_calls: tools,\n            };\n        }\n        return fields;\n    }\n    function responseToBaseMessage(response) {\n        const fields = responseToBaseMessageFields(response);\n        return new messages_1.AIMessage(fields);\n    }\n    function safeResponseToBaseMessage(response) {\n        return safeResponseTo(response, responseToBaseMessage);\n    }\n    function responseToChatResult(response) {\n        const generations = responseToChatGenerations(response);\n        return {\n            generations,\n            llmOutput: responseToGenerationInfo(response),\n        };\n    }\n    function safeResponseToChatResult(response) {\n        return safeResponseTo(response, responseToChatResult);\n    }\n    function inputType(input) {\n        if (typeof input === \"string\") {\n            return \"MessageContent\";\n        }\n        else {\n            const firstItem = input[0];\n            if (Object.hasOwn(firstItem, \"content\")) {\n                return \"BaseMessageArray\";\n            }\n            else {\n                return \"MessageContent\";\n            }\n        }\n    }\n    async function formatMessageContents(input, _parameters) {\n        const parts = await messageContentToParts(input);\n        const contents = [\n            {\n                role: \"user\",\n                parts,\n            },\n        ];\n        return contents;\n    }\n    async function formatBaseMessageContents(input, _parameters) {\n        const inputPromises = input.map((msg, i) => baseMessageToContent(msg, input[i - 1]));\n        const inputs = await Promise.all(inputPromises);\n        return inputs.reduce((acc, cur) => {\n            // Filter out the system content\n            if (cur.every((content) => content.role === \"system\")) {\n                return acc;\n            }\n            // Combine adjacent function messages\n            if (cur[0]?.role === \"function\" &&\n                acc.length > 0 &&\n                acc[acc.length - 1].role === \"function\") {\n                acc[acc.length - 1].parts = [\n                    ...acc[acc.length - 1].parts,\n                    ...cur[0].parts,\n                ];\n            }\n            else {\n                acc.push(...cur);\n            }\n            return acc;\n        }, []);\n    }\n    async function formatContents(input, parameters) {\n        const it = inputType(input);\n        switch (it) {\n            case \"MessageContent\":\n                return formatMessageContents(input, parameters);\n            case \"BaseMessageArray\":\n                return formatBaseMessageContents(input, parameters);\n            default:\n                throw new Error(`Unknown input type \"${it}\": ${input}`);\n        }\n    }\n    function formatGenerationConfig(parameters) {\n        const ret = {\n            temperature: parameters.temperature,\n            topK: parameters.topK,\n            topP: parameters.topP,\n            presencePenalty: parameters.presencePenalty,\n            frequencyPenalty: parameters.frequencyPenalty,\n            maxOutputTokens: parameters.maxOutputTokens,\n            stopSequences: parameters.stopSequences,\n            responseMimeType: parameters.responseMimeType,\n        };\n        // Add the logprobs if explicitly set\n        if (typeof parameters.logprobs !== \"undefined\") {\n            ret.responseLogprobs = parameters.logprobs;\n            if (parameters.logprobs &&\n                typeof parameters.topLogprobs !== \"undefined\") {\n                ret.logprobs = parameters.topLogprobs;\n            }\n        }\n        return ret;\n    }\n    function formatSafetySettings(parameters) {\n        return parameters.safetySettings ?? [];\n    }\n    async function formatBaseMessageSystemInstruction(input) {\n        let ret = {};\n        for (let index = 0; index < input.length; index += 1) {\n            const message = input[index];\n            if (message._getType() === \"system\") {\n                // For system types, we only want it if it is the first message,\n                // if it appears anywhere else, it should be an error.\n                if (index === 0) {\n                    // eslint-disable-next-line prefer-destructuring\n                    ret = (await baseMessageToContent(message, undefined))[0];\n                }\n                else {\n                    throw new Error(\"System messages are only permitted as the first passed message.\");\n                }\n            }\n        }\n        return ret;\n    }\n    async function formatSystemInstruction(input) {\n        if (!config?.useSystemInstruction) {\n            return {};\n        }\n        const it = inputType(input);\n        switch (it) {\n            case \"BaseMessageArray\":\n                return formatBaseMessageSystemInstruction(input);\n            default:\n                return {};\n        }\n    }\n    function structuredToolToFunctionDeclaration(tool) {\n        const jsonSchema = (0, zod_to_gemini_parameters_js_1.zodToGeminiParameters)(tool.schema);\n        return {\n            name: tool.name,\n            description: tool.description ?? `A function available to call.`,\n            parameters: jsonSchema,\n        };\n    }\n    function searchToolName(tool) {\n        for (const name of types_js_1.GeminiSearchToolAttributes) {\n            if (name in tool) {\n                return name;\n            }\n        }\n        return undefined;\n    }\n    function cleanGeminiTool(tool) {\n        const orig = searchToolName(tool);\n        const adj = config?.googleSearchToolAdjustment;\n        if (orig && adj && adj !== orig) {\n            return {\n                [adj]: {},\n            };\n        }\n        else {\n            return tool;\n        }\n    }\n    function formatTools(parameters) {\n        const tools = parameters?.tools;\n        if (!tools || tools.length === 0) {\n            return [];\n        }\n        // Group all LangChain tools into a single functionDeclarations array.\n        // Gemini Tools may be normalized to different tool names\n        const langChainTools = [];\n        const otherTools = [];\n        tools.forEach((tool) => {\n            if ((0, function_calling_1.isLangChainTool)(tool)) {\n                langChainTools.push(tool);\n            }\n            else {\n                otherTools.push(cleanGeminiTool(tool));\n            }\n        });\n        const result = [...otherTools];\n        if (langChainTools.length > 0) {\n            result.push({\n                functionDeclarations: langChainTools.map(structuredToolToFunctionDeclaration),\n            });\n        }\n        return result;\n    }\n    function formatToolConfig(parameters) {\n        if (!parameters.tool_choice || typeof parameters.tool_choice !== \"string\") {\n            return undefined;\n        }\n        if ([\"auto\", \"any\", \"none\"].includes(parameters.tool_choice)) {\n            return {\n                functionCallingConfig: {\n                    mode: parameters.tool_choice,\n                    allowedFunctionNames: parameters.allowed_function_names,\n                },\n            };\n        }\n        // force tool choice to be a single function name in case of structured output\n        return {\n            functionCallingConfig: {\n                mode: \"any\",\n                allowedFunctionNames: [parameters.tool_choice],\n            },\n        };\n    }\n    async function formatData(input, parameters) {\n        const typedInput = input;\n        const contents = await formatContents(typedInput, parameters);\n        const generationConfig = formatGenerationConfig(parameters);\n        const tools = formatTools(parameters);\n        const toolConfig = formatToolConfig(parameters);\n        const safetySettings = formatSafetySettings(parameters);\n        const systemInstruction = await formatSystemInstruction(typedInput);\n        const ret = {\n            contents,\n            generationConfig,\n        };\n        if (tools && tools.length) {\n            ret.tools = tools;\n        }\n        if (toolConfig) {\n            ret.toolConfig = toolConfig;\n        }\n        if (safetySettings && safetySettings.length) {\n            ret.safetySettings = safetySettings;\n        }\n        if (systemInstruction?.role &&\n            systemInstruction?.parts &&\n            systemInstruction?.parts?.length) {\n            ret.systemInstruction = systemInstruction;\n        }\n        return ret;\n    }\n    return {\n        messageContentToParts,\n        baseMessageToContent,\n        responseToString: safeResponseToString,\n        responseToChatGeneration: safeResponseToChatGeneration,\n        chunkToString,\n        responseToBaseMessage: safeResponseToBaseMessage,\n        responseToChatResult: safeResponseToChatResult,\n        formatData,\n    };\n}\nexports.getGeminiAPI = getGeminiAPI;\nfunction validateGeminiParams(params) {\n    if (params.maxOutputTokens && params.maxOutputTokens < 0) {\n        throw new Error(\"`maxOutputTokens` must be a positive integer\");\n    }\n    if (params.temperature &&\n        (params.temperature < 0 || params.temperature > 2)) {\n        throw new Error(\"`temperature` must be in the range of [0.0,2.0]\");\n    }\n    if (params.topP && (params.topP < 0 || params.topP > 1)) {\n        throw new Error(\"`topP` must be in the range of [0.0,1.0]\");\n    }\n    if (params.topK && params.topK < 0) {\n        throw new Error(\"`topK` must be a positive integer\");\n    }\n}\nexports.validateGeminiParams = validateGeminiParams;\nfunction isModelGemini(modelName) {\n    return modelName.toLowerCase().startsWith(\"gemini\");\n}\nexports.isModelGemini = isModelGemini;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,aAAa,GAAG,QAAQ,oBAAoB,GAAG,QAAQ,YAAY,GAAG,QAAQ,0BAA0B,GAAG,QAAQ,0BAA0B,GAAG,KAAK;AAC7J,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;IACF,YAAY,QAAQ,CAAE;QAClB,OAAO,cAAc,CAAC,IAAI,EAAE,eAAe;YACvC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO;gBAAC;gBAAU;gBAAc;aAAQ;QAC5C;QACA,IAAI,CAAC,WAAW,GAAG,UAAU,eAAe,IAAI,CAAC,WAAW;IAChE;IACA,yBAAyB,QAAQ,EAAE,IAAI,EAAE;QACrC,4DAA4D;QAC5D,MAAM,iBAAiB,MAAM;QAC7B,MAAM,cAAc,gBAAgB;QACpC,IAAI,aAAa;YACb,MAAM,IAAI,YAAY,mBAAmB,CAAC,UAAU,CAAC,gBAAgB,EAAE,aAAa;QACxF;QACA,OAAO;IACX;IACA,uBAAuB,QAAQ,EAAE,IAAI,EAAE;QACnC,MAAM,iBAAiB,MAAM,YAAY,CAAC,EAAE;QAC5C,MAAM,eAAe,gBAAgB;QACrC,IAAI,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,eAAe;YACzC,MAAM,IAAI,YAAY,mBAAmB,CAAC,UAAU,CAAC,eAAe,EAAE,cAAc;QACxF;QACA,OAAO;IACX;IACA,WAAW,QAAQ,EAAE,IAAI,EAAE;QACvB,IAAI,MAAM;QACV,MAAM,IAAI,CAAC,wBAAwB,CAAC,UAAU;QAC9C,MAAM,IAAI,CAAC,sBAAsB,CAAC,UAAU;QAC5C,OAAO;IACX;IACA,OAAO,QAAQ,EAAE;QACb,IAAI;QACJ,IAAI,eAAe,SAAS,IAAI,EAAE;YAC9B,yCAAyC;YACzC,UAAU,SAAS,IAAI;QAC3B,OACK,IAAI,MAAM,OAAO,CAAC,SAAS,IAAI,GAAG;YACnC,2DAA2D;YAC3D,IAAI;gBACA,UAAU,SAAS,IAAI,CAAC,GAAG,CAAC,CAAC,OAAS,IAAI,CAAC,UAAU,CAAC,UAAU;YACpE,EACA,OAAO,IAAI;gBACP,uDAAuD;gBACvD,IAAI,cAAc,YAAY,mBAAmB,EAAE;oBAC/C,MAAM,IAAI,YAAY,mBAAmB,CAAC,UAAU,GAAG,OAAO;gBAClE,OACK;oBACD,MAAM;gBACV;YACJ;QACJ,OACK;YACD,MAAM,OAAO,SAAS,IAAI;YAC1B,UAAU,IAAI,CAAC,UAAU,CAAC,UAAU;QACxC;QACA,OAAO;YACH,GAAG,QAAQ;YACX,MAAM;QACV;IACJ;AACJ;AACA,QAAQ,0BAA0B,GAAG;AACrC,MAAM,mCAAmC;IACrC,YAAY,QAAQ,CAAE;QAClB,KAAK,CAAC;QACN,OAAO,cAAc,CAAC,IAAI,EAAE,OAAO;YAC/B,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO;QACX;QACA,OAAO,cAAc,CAAC,IAAI,EAAE,mBAAmB;YAC3C,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO;QACX;QACA,IAAI,CAAC,GAAG,GAAG,UAAU,OAAO,IAAI,CAAC,GAAG;QACpC,IAAI,CAAC,eAAe,GAAG,UAAU,mBAAmB,IAAI,CAAC,eAAe;IAC5E;IACA,WAAW,IAAI,EAAE;QACb,MAAM,MAAM;QACZ,IAAI,IAAI,CAAC,eAAe,IACpB,CAAC,MAAM,YAAY,CAAC,EAAE,EAAE,SAAS,OAAO,QAAQ;YAChD,IAAI,UAAU,GAAG,KAAK,UAAU,IAAI,EAAE;YACtC,IAAI,UAAU,CAAC,EAAE,GAAG,KAAK,UAAU,CAAC,EAAE,IAAI,CAAC;YAC3C,IAAI,UAAU,CAAC,EAAE,CAAC,OAAO,GAAG,KAAK,UAAU,CAAC,EAAE,CAAC,OAAO,IAAI,CAAC;YAC3D,IAAI,UAAU,CAAC,EAAE,CAAC,OAAO,GAAG;gBACxB,MAAM;gBACN,OAAO;oBAAC;wBAAE,MAAM,IAAI,CAAC,GAAG;oBAAC;iBAAE;YAC/B;QACJ;QACA,OAAO;IACX;IACA,WAAW,QAAQ,EAAE,IAAI,EAAE;QACvB,IAAI;YACA,OAAO,KAAK,CAAC,WAAW,UAAU;QACtC,EACA,OAAO,IAAI;YACP,OAAO,IAAI,CAAC,UAAU,CAAC;QAC3B;IACJ;AACJ;AACA,QAAQ,0BAA0B,GAAG;AACrC,MAAM,kBAAkB,CAAC;IACrB,IAAI,IAAI,UAAU,CAAC,UAAU;QACzB,OAAO;YACH,UAAU,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE;YACzC,MAAM,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE;QAC3B;IACJ;IACA,OAAO;AACX;AACA,SAAS,aAAa,MAAM;IACxB,SAAS,mBAAmB,OAAO;QAC/B,IAAI,SAAS,QAAQ,SAAS,KAAK,SAAS,GAAG;YAC3C,OAAO;gBACH,MAAM,QAAQ,IAAI;YACtB;QACJ,OACK;YACD,OAAO;QACX;IACJ;IACA,SAAS,uBAAuB,OAAO;QACnC,MAAM,MAAM,OAAO,QAAQ,SAAS,KAAK,WACnC,QAAQ,SAAS,GACjB,QAAQ,SAAS,CAAC,GAAG;QAC3B,IAAI,CAAC,KAAK;YACN,MAAM,IAAI,MAAM;QACpB;QACA,MAAM,kBAAkB,gBAAgB;QACxC,IAAI,iBAAiB;YACjB,OAAO;gBACH,YAAY;YAChB;QACJ,OACK;YACD,yCAAyC;YACzC,OAAO;gBACH,UAAU;oBACN,UAAU;oBACV,SAAS;gBACb;YACJ;QACJ;IACJ;IACA,eAAe,eAAe,IAAI;QAC9B,OAAO;YACH,UAAU;gBACN,SAAS,KAAK,IAAI;gBAClB,UAAU,KAAK,QAAQ;YAC3B;QACJ;IACJ;IACA,eAAe,qBAAqB,GAAG;QACnC,OAAO,QAAQ,cAAc,aAAa;IAC9C;IACA,eAAe,oBACf,8DAA8D;IAC9D,OAAO;QACH,IAAI,cAAc,WAAW,UAAU,SAAS;YAC5C,OAAO;gBACH,YAAY;oBACR,UAAU,QAAQ,QAAQ;oBAC1B,MAAM,QAAQ,IAAI;gBACtB;YACJ;QACJ,OACK,IAAI,cAAc,WAAW,aAAa,SAAS;YACpD,OAAO;gBACH,UAAU;oBACN,UAAU,QAAQ,QAAQ;oBAC1B,SAAS,QAAQ,OAAO;gBAC5B;YACJ;QACJ,OACK;YACD,MAAM,MAAM,QAAQ,OAAO;YAC3B,MAAM,OAAO,MAAM,qBAAqB;YACxC,IAAI,MAAM;gBACN,OAAO,MAAM,eAAe;YAChC;QACJ;QACA,MAAM,IAAI,MAAM,CAAC,uBAAuB,EAAE,KAAK,SAAS,CAAC,SAAS,MAAM,IAAI;IAChF;IACA,eAAe,4BAA4B,OAAO;QAC9C,OAAQ,QAAQ,IAAI;YAChB,KAAK;gBACD,IAAI,UAAU,SAAS;oBACnB,OAAO,mBAAmB;gBAC9B;gBACA;YACJ,KAAK;gBACD,IAAI,eAAe,SAAS;oBACxB,wCAAwC;oBACxC,OAAO,uBAAuB;gBAClC;gBACA;YACJ,KAAK;gBACD,OAAO,MAAM,oBAAoB;YACrC;gBACI,MAAM,IAAI,MAAM,CAAC,kBAAkB,EAAE,QAAQ,IAAI,CAAC,sDAAsD,EAAE,SAAS;QAC3H;QACA,MAAM,IAAI,MAAM,CAAC,eAAe,EAAE,QAAQ,IAAI,CAAC,6BAA6B,CAAC;IACjF;IACA,eAAe,6BAA6B,OAAO;QAC/C,MAAM,WAAW,QAAQ,GAAG,CAAC;QAC7B,OAAO,QAAQ,GAAG,CAAC;IACvB;IACA,eAAe,sBAAsB,OAAO;QACxC,2DAA2D;QAC3D,MAAM,iBAAiB,OAAO,YAAY,WACpC;YACE;gBACI,MAAM;gBACN,MAAM;YACV;SACH,GACC;QACN,gEAAgE;QAChE,MAAM,WAAW,MAAM,6BAA6B;QACpD,2BAA2B;QAC3B,MAAM,QAAQ,SAAS,MAAM,CAAC,CAAC,KAAK;YAChC,IAAI,KAAK;gBACL,OAAO;uBAAI;oBAAK;iBAAI;YACxB,OACK;gBACD,OAAO;YACX;QACJ,GAAG,EAAE;QACL,OAAO;IACX;IACA,SAAS,wBAAwB,SAAS;QACtC,IAAI,CAAC,aAAa,UAAU,MAAM,KAAK,GAAG;YACtC,OAAO,EAAE;QACb;QACA,OAAO,UAAU,GAAG,CAAC,CAAC;YAClB,IAAI,OAAO,CAAC;YACZ,IAAI,MAAM,UAAU,WAAW;gBAC3B,MAAM,SAAS,KAAK,QAAQ,CAAC,SAAS;gBACtC,OAAO,KAAK,KAAK,CAAC;YACtB;YACA,OAAO;gBACH,cAAc;oBACV,MAAM,KAAK,QAAQ,CAAC,IAAI;oBACxB;gBACJ;YACJ;QACJ;IACJ;IACA,SAAS,qBAAqB,MAAM;QAChC,MAAM,MAAM,EAAE;QACd,IAAI,QAAQ,YAAY;YACpB,IAAI,IAAI,IAAI,wBAAwB,OAAO,UAAU;QACzD;QACA,OAAO;IACX;IACA,eAAe,qBAAqB,IAAI,EAAE,OAAO;QAC7C,MAAM,eAAe,MAAM,sBAAsB,QAAQ,OAAO;QAChE,IAAI;QACJ,IAAI,CAAC,GAAG,WAAW,WAAW,EAAE,YAAY,CAAC,CAAC,QAAQ,UAAU,EAAE,QAAQ;YACtE,YAAY,QAAQ,UAAU,CAAC,GAAG,CAAC,CAAC,WAAa,CAAC;oBAC9C,cAAc;wBACV,MAAM,SAAS,IAAI;wBACnB,MAAM,SAAS,IAAI;oBACvB;gBACJ,CAAC;QACL,OACK;YACD,YAAY,qBAAqB,QAAQ,iBAAiB;QAC9D;QACA,MAAM,QAAQ;eAAI;eAAiB;SAAU;QAC7C,OAAO;YACH;gBACI;gBACA;YACJ;SACH;IACL;IACA,eAAe,uBAAuB,OAAO;QACzC,OAAO,QAAQ,uBACT,qBAAqB,UAAU,WAC/B;eACM,MAAM,qBAAqB,QAAQ;eACnC,MAAM,qBAAqB,SAAS,IAAI,WAAW,SAAS,CAAC;SACpE;IACT;IACA,SAAS,qBAAqB,OAAO,EAAE,WAAW;QAC9C,MAAM,aAAa,OAAO,QAAQ,OAAO,KAAK,WACxC,QAAQ,OAAO,GACf,QAAQ,OAAO,CAAC,MAAM,CAAC,CAAC,KAAK;YAC3B,IAAI,QAAQ,IAAI,KAAK,QAAQ;gBACzB,OAAO,MAAM,QAAQ,IAAI;YAC7B,OACK;gBACD,OAAO;YACX;QACJ,GAAG;QACP,WAAW;QACX,MAAM,eAAe,CAAC,CAAC,GAAG,WAAW,WAAW,EAAE,gBAAgB,CAAC,CAAC,YAAY,UAAU,EAAE,SACtF,YAAY,UAAU,CAAC,EAAE,CAAC,IAAI,GAC9B,YAAY,IAAI,KAAK,QAAQ,YAAY;QAC/C,IAAI;YACA,MAAM,UAAU,KAAK,KAAK,CAAC;YAC3B,OAAO;gBACH;oBACI,MAAM;oBACN,OAAO;wBACH;4BACI,kBAAkB;gCACd,MAAM;gCACN,UAAU;oCAAE;gCAAQ;4BACxB;wBACJ;qBACH;gBACL;aACH;QACL,EACA,OAAO,GAAG;YACN,OAAO;gBACH;oBACI,MAAM;oBACN,OAAO;wBACH;4BACI,kBAAkB;gCACd,MAAM;gCACN,UAAU;oCAAE,SAAS;gCAAW;4BACpC;wBACJ;qBACH;gBACL;aACH;QACL;IACJ;IACA,eAAe,qBAAqB,OAAO,EAAE,WAAW;QACpD,MAAM,OAAO,QAAQ,QAAQ;QAC7B,OAAQ;YACJ,KAAK;gBACD,OAAO,uBAAuB;YAClC,KAAK;gBACD,OAAO,qBAAqB,QAAQ;YACxC,KAAK;gBACD,OAAO,qBAAqB,SAAS;YACzC,KAAK;gBACD,IAAI,CAAC,aAAa;oBACd,MAAM,IAAI,MAAM;gBACpB;gBACA,OAAO,qBAAqB,SAAS;YACzC;gBACI,QAAQ,GAAG,CAAC,CAAC,0BAA0B,EAAE,MAAM;gBAC/C,OAAO,EAAE;QACjB;IACJ;IACA,SAAS,yBAAyB,IAAI;QAClC,OAAO;YACH,MAAM;YACN,MAAM,KAAK,IAAI;QACnB;IACJ;IACA,SAAS,+BAA+B,IAAI;QACxC,OAAO;YACH,MAAM;YACN,WAAW,CAAC,KAAK,EAAE,KAAK,UAAU,CAAC,QAAQ,CAAC,QAAQ,EAAE,KAAK,UAAU,CAAC,IAAI,EAAE;QAChF;IACJ;IACA,SAAS,6BAA6B,IAAI;QACtC,OAAO;YACH,MAAM;YACN,WAAW,KAAK,QAAQ,CAAC,OAAO;QACpC;IACJ;IACA,SAAS,sBAAsB,KAAK;QAChC,OAAO,MACF,GAAG,CAAC,CAAC;YACN,IAAI,SAAS,aAAa,SAAS,MAAM;gBACrC,OAAO;YACX,OACK,IAAI,UAAU,MAAM;gBACrB,OAAO,yBAAyB;YACpC,OACK,IAAI,gBAAgB,MAAM;gBAC3B,OAAO,+BAA+B;YAC1C,OACK,IAAI,cAAc,MAAM;gBACzB,OAAO,6BAA6B;YACxC,OACK;gBACD,OAAO;YACX;QACJ,GACK,MAAM,CAAC,CAAC,KAAK;YACd,IAAI,SAAS;gBACT,IAAI,IAAI,CAAC;YACb;YACA,OAAO;QACX,GAAG,EAAE;IACT;IACA,SAAS,cAAc,GAAG;QACtB,OAAO;YACH,IAAI,IAAI,EAAE;YACV,MAAM,IAAI,IAAI;YACd,UAAU;gBACN,MAAM,IAAI,QAAQ,CAAC,IAAI;gBACvB,WAAW,KAAK,SAAS,CAAC,IAAI,QAAQ,CAAC,SAAS;YACpD;QACJ;IACJ;IACA,SAAS,0BAA0B,IAAI;QACnC,OAAO;YACH,IAAI,CAAC,GAAG,OAAO,EAAE,IAAI,OAAO,CAAC,MAAM;YACnC,MAAM;YACN,UAAU;gBACN,MAAM,KAAK,YAAY,CAAC,IAAI;gBAC5B,WAAW,KAAK,YAAY,CAAC,IAAI,IAAI,CAAC;YAC1C;QACJ;IACJ;IACA,SAAS,gBAAgB,KAAK;QAC1B,OAAO,MACF,GAAG,CAAC,CAAC;YACN,IAAI,SAAS,aAAa,SAAS,MAAM;gBACrC,OAAO;YACX,OACK,IAAI,kBAAkB,MAAM;gBAC7B,OAAO,0BAA0B;YACrC,OACK;gBACD,OAAO;YACX;QACJ,GACK,MAAM,CAAC,CAAC,KAAK;YACd,IAAI,SAAS;gBACT,IAAI,IAAI,CAAC;YACb;YACA,OAAO;QACX,GAAG,EAAE;IACT;IACA,SAAS,gBAAgB,IAAI;QACzB,OAAO,KAAK,GAAG,CAAC,CAAC,MAAQ,cAAc;IAC3C;IACA,SAAS,sCAAsC,QAAQ;QACnD,IAAI,eAAe,SAAS,IAAI,EAAE;YAC9B,MAAM,IAAI,MAAM;QACpB,OACK,IAAI,MAAM,OAAO,CAAC,SAAS,IAAI,GAAG;YACnC,gEAAgE;YAChE,OAAO,SAAS,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK;gBAC9B,oBAAoB;gBACpB,kCAAkC;gBAClC,MAAM,WAAW,KAAK,YAAY,CAAC,EAAE,EAAE,SAAS,SAAS,EAAE;gBAC3D,IAAI,UAAU,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,IAAI;gBACxC,kDAAkD;gBAClD,IAAI,cAAc,GAAG,IAAI,cAAc;gBACvC,OAAO;YACX;QACJ,OACK;YACD,OAAO,SAAS,IAAI;QACxB;IACJ;IACA,SAAS,gBAAgB,QAAQ;QAC7B,MAAM,eAAe,sCAAsC;QAC3D,MAAM,QAAQ,cAAc,YAAY,CAAC,EAAE,EAAE,SAAS,SAAS,EAAE;QACjE,OAAO;IACX;IACA,SAAS,WAAW,IAAI;QACpB,OAAO,UAAU,OAAO,KAAK,IAAI,GAAG;IACxC;IACA,SAAS,iBAAiB,QAAQ;QAC9B,MAAM,QAAQ,gBAAgB;QAC9B,MAAM,MAAM,MAAM,MAAM,CAAC,CAAC,KAAK;YAC3B,MAAM,MAAM,WAAW;YACvB,OAAO,MAAM;QACjB,GAAG;QACH,OAAO;IACX;IACA,SAAS,eAAe,QAAQ,EAAE,UAAU;QACxC,MAAM,gBAAgB,QAAQ,iBAAiB,IAAI;QACnD,IAAI;YACA,MAAM,eAAe,cAAc,MAAM,CAAC;YAC1C,OAAO,WAAW;QACtB,EACA,OAAO,IAAI;YACP,uDAAuD;YACvD,IAAI,cAAc,YAAY,mBAAmB,EAAE;gBAC/C,MAAM,MAAM,WAAW,GAAG,QAAQ;gBAClC,GAAG,KAAK,GAAG;YACf;YACA,MAAM;QACV;IACJ;IACA,SAAS,qBAAqB,QAAQ;QAClC,OAAO,eAAe,UAAU;IACpC;IACA,SAAS,uBAAuB,MAAM;QAClC,MAAM,QAAQ,QAAQ;QACtB,MAAM,UAAU,QAAQ;QACxB,MAAM,UAAU,IAAI;QACpB,MAAM,QAAQ,MAAM,IAAI,CAAC,QAAQ,MAAM,CAAC;QACxC,OAAO;YACH;YACA;YACA;QACJ;IACJ;IACA,SAAS,oBAAoB,SAAS;QAClC,MAAM,WAAW,WAAW;QAC5B,MAAM,eAAe,UAAU,oBAAoB,EAAE;QACrD,MAAM,YAAY,UAAU,iBAAiB,EAAE;QAC/C,MAAM,UAAU,EAAE;QAClB,IAAK,IAAI,KAAK,GAAG,KAAK,aAAa,MAAM,EAAE,MAAM,EAAG;YAChD,MAAM,SAAS,YAAY,CAAC,GAAG;YAC/B,MAAM,MAAM,SAAS,CAAC,GAAG,EAAE,cAAc,EAAE;YAC3C,MAAM,UAAU,uBAAuB;YACvC,QAAQ,YAAY,GAAG,IAAI,GAAG,CAAC,CAAC,IAAM,uBAAuB;YAC7D,QAAQ,IAAI,CAAC;QACjB;QACA,OAAO;YACH;QACJ;IACJ;IACA,SAAS,yBAAyB,QAAQ;QACtC,IAAI,CAAC,MAAM,OAAO,CAAC,SAAS,IAAI,GAAG;YAC/B,OAAO,CAAC;QACZ;QACA,MAAM,OAAO,SAAS,IAAI,CAAC,EAAE;QAC7B,OAAO;YACH,gBAAgB;gBACZ,oBAAoB,KAAK,aAAa,EAAE;gBACxC,wBAAwB,KAAK,aAAa,EAAE;gBAC5C,mBAAmB,KAAK,aAAa,EAAE;YAC3C;YACA,gBAAgB,KAAK,UAAU,CAAC,EAAE,EAAE,eAAe,IAAI,CAAC,SAAW,CAAC;oBAChE,UAAU,OAAO,QAAQ;oBACzB,aAAa,OAAO,WAAW;oBAC/B,mBAAmB,OAAO,gBAAgB;oBAC1C,UAAU,OAAO,QAAQ;oBACzB,gBAAgB,OAAO,aAAa;gBACxC,CAAC;YACD,mBAAmB,KAAK,UAAU,CAAC,EAAE,EAAE;YACvC,oBAAoB,KAAK,UAAU,CAAC,EAAE,EAAE;YACxC,eAAe,KAAK,UAAU,CAAC,EAAE,EAAE;YACnC,aAAa,KAAK,UAAU,CAAC,EAAE,EAAE;YACjC,UAAU,oBAAoB,KAAK,UAAU,CAAC,EAAE;QACpD;IACJ;IACA,SAAS,yBAAyB,QAAQ;QACtC,OAAO,IAAI,UAAU,mBAAmB,CAAC;YACrC,MAAM,iBAAiB;YACvB,SAAS,mBAAmB,gBAAgB,SAAS,CAAC,EAAE;YACxD,gBAAgB,yBAAyB;QAC7C;IACJ;IACA,SAAS,6BAA6B,QAAQ;QAC1C,OAAO,eAAe,UAAU;IACpC;IACA,SAAS,cAAc,KAAK;QACxB,IAAI,UAAU,MAAM;YAChB,OAAO;QACX,OACK,IAAI,OAAO,MAAM,OAAO,KAAK,UAAU;YACxC,OAAO,MAAM,OAAO;QACxB,OACK,IAAI,MAAM,OAAO,CAAC,MAAM,KAAK,GAAG;YACjC,OAAO;QACX,OACK,IAAI,MAAM,OAAO,CAAC,EAAE,CAAC,IAAI,KAAK,QAAQ;YACvC,OAAO,MAAM,OAAO,CAAC,EAAE,CAAC,IAAI;QAChC,OACK;YACD,MAAM,IAAI,MAAM,CAAC,kBAAkB,EAAE,OAAO;QAChD;IACJ;IACA,SAAS,mBAAmB,IAAI;QAC5B,MAAM,SAAS,8BAA8B;YAAC;SAAK;QACnD,IAAI,OAAO,OAAO,OAAO,KAAK,UAAU;YACpC,OAAO,IAAI,WAAW,cAAc,CAAC;QACzC,OACK,IAAI,OAAO,OAAO,CAAC,KAAK,CAAC,CAAC,OAAS,KAAK,IAAI,KAAK,SAAS;YAC3D,MAAM,aAAa,OAAO,OAAO,CAC5B,GAAG,CAAC,CAAC,OAAU,UAAU,OAAO,KAAK,IAAI,GAAG,IAC5C,IAAI,CAAC;YACV,OAAO,IAAI,WAAW,cAAc,CAAC;gBACjC,GAAG,MAAM;gBACT,SAAS;YACb;QACJ;QACA,OAAO,IAAI,WAAW,cAAc,CAAC;IACzC;IACA,SAAS,qBAAqB,IAAI;QAC9B,MAAM,UAAU,mBAAmB;QACnC,MAAM,OAAO,WAAW;QACxB,OAAO,IAAI,UAAU,mBAAmB,CAAC;YACrC;YACA;QACJ;IACJ;IACA,SAAS,uBAAuB,iBAAiB;QAC7C,MAAM,MAAM,EAAE;QACd,IAAI,CAAC,qBAAqB,kBAAkB,MAAM,KAAK,GAAG;YACtD,OAAO,EAAE;QACb;QACA,mBAAmB,QAAQ,CAAC;YACxB,MAAM,UAAU,kBAAkB;YAClC,MAAM,YAAY,SAAS,aAAa;YACxC,IAAI,GAAG,CAAC,UAAU,EAAE;gBAChB,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC;YACxB,OACK;gBACD,GAAG,CAAC,UAAU,GAAG;oBAAC;iBAAiB;YACvC;QACJ;QACA,OAAO;IACX;IACA,SAAS,kCAAkC,QAAQ;QAC/C,MAAM,QAAQ,gBAAgB;QAC9B,IAAI,MAAM,MAAM,KAAK,GAAG;YACpB,OAAO,EAAE;QACb;QACA,6EAA6E;QAC7E,yDAAyD;QACzD,MAAM,YAAY,UAAU,MACtB,YAAY,CAAC,EAAE;QACrB,MAAM,oBAAoB,WAAW;QACrC,MAAM,mBAAmB,WAAW;QACpC,MAAM,iBAAiB,uBAAuB,mBAAmB;QACjE,MAAM,MAAM,MAAM,GAAG,CAAC,CAAC,MAAM;YACzB,MAAM,MAAM,qBAAqB;YACjC,IAAI,CAAC,IAAI,cAAc,EAAE;gBACrB,IAAI,cAAc,GAAG,CAAC;YAC1B;YACA,IAAI,mBAAmB;gBACnB,IAAI,cAAc,CAAC,iBAAiB,GAAG;gBACvC,MAAM,gBAAgB,cAAc,CAAC,MAAM;gBAC3C,IAAI,eAAe;oBACf,IAAI,cAAc,CAAC,gBAAgB,GAAG;gBAC1C;YACJ;YACA,IAAI,kBAAkB;gBAClB,IAAI,cAAc,CAAC,gBAAgB,GAAG;YAC1C;YACA,OAAO;QACX;QACA,OAAO;IACX;IACA,SAAS,0BAA0B,QAAQ;QACvC,IAAI,MAAM,kCAAkC;QAC5C,IAAI,IAAI,MAAM,KAAK,GAAG;YAClB,OAAO,EAAE;QACb;QACA,IAAI,IAAI,KAAK,CAAC,CAAC,OAAS,OAAO,KAAK,OAAO,CAAC,OAAO,KAAK,WAAW;YAC/D,MAAM,kBAAkB,IAAI,GAAG,CAAC,CAAC,OAAS,KAAK,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC;YACrE,MAAM,eAAe,IAAI,GAAG,CAAC,CAAC,OAAS,KAAK,IAAI,EAAE,IAAI,CAAC;YACvD,MAAM,iBAAiB,GAAG,CAAC,IAAI,MAAM,GAAG,EAAE,EAAE,QAAQ,mBAAmB,YAAY,IAAI,CAAC,UAAU,IAAM,CAAC;oBACrG,MAAM,SAAS,QAAQ,CAAC,IAAI;oBAC5B,MAAM,SAAS,QAAQ,CAAC,SAAS;oBACjC,IAAI,SAAS,EAAE;oBACf,OAAO;oBACP,MAAM;gBACV,CAAC;YACD,IAAI;YACJ,IAAI,mBAAmB,SAAS,IAAI,EAAE;gBAClC,gBAAgB;oBACZ,cAAc,SAAS,IAAI,CAAC,aAAa,CAAC,gBAAgB;oBAC1D,eAAe,SAAS,IAAI,CAAC,aAAa,CACrC,oBAAoB;oBACzB,cAAc,SAAS,IAAI,CAAC,aAAa,CAAC,eAAe;gBAC7D;YACJ;YACA,MAAM;gBACF,IAAI,UAAU,mBAAmB,CAAC;oBAC9B,SAAS,IAAI,WAAW,cAAc,CAAC;wBACnC,SAAS;wBACT,mBAAmB,GAAG,CAAC,IAAI,MAAM,GAAG,EAAE,EAAE,QAAQ;wBAChD,kBAAkB;wBAClB,gBAAgB;oBACpB;oBACA,MAAM;oBACN,gBAAgB,GAAG,CAAC,IAAI,MAAM,GAAG,EAAE,CAAC,cAAc;gBACtD;aACH;QACL;QACA,0CAA0C;QAC1C,MAAM,YAAY,UAAU,MACtB,YAAY,CAAC,EAAE;QACrB,MAAM,cAAc,WAAW;QAC/B,MAAM,WAAW,oBAAoB;QACrC,wCAAc;YACV,GAAG,CAAC,EAAE,CAAC,OAAO,CAAC,iBAAiB,GAAG;gBAC/B,GAAG,GAAG,CAAC,EAAE,CAAC,OAAO,CAAC,iBAAiB;gBACnC;gBACA;YACJ;QACJ;QACA,OAAO;IACX;IACA,SAAS,4BAA4B,QAAQ;QACzC,MAAM,QAAQ,gBAAgB;QAC9B,OAAO,8BAA8B;IACzC;IACA,SAAS,8BAA8B,KAAK;QACxC,MAAM,SAAS;YACX,SAAS,sBAAsB;YAC/B,kBAAkB,EAAE;YACpB,YAAY,EAAE;YACd,oBAAoB,EAAE;QAC1B;QACA,MAAM,WAAW,gBAAgB;QACjC,IAAI,SAAS,MAAM,GAAG,GAAG;YACrB,MAAM,QAAQ,gBAAgB;YAC9B,KAAK,MAAM,QAAQ,MAAO;gBACtB,OAAO,gBAAgB,EAAE,KAAK;oBAC1B,MAAM,KAAK,QAAQ,CAAC,IAAI;oBACxB,MAAM,KAAK,QAAQ,CAAC,SAAS;oBAC7B,IAAI,KAAK,EAAE;oBACX,MAAM;gBACV;gBACA,IAAI;oBACA,OAAO,UAAU,EAAE,KAAK;wBACpB,MAAM,KAAK,QAAQ,CAAC,IAAI;wBACxB,MAAM,KAAK,KAAK,CAAC,KAAK,QAAQ,CAAC,SAAS;wBACxC,IAAI,KAAK,EAAE;oBACf;gBACA,8DAA8D;gBAClE,EACA,OAAO,GAAG;oBACN,OAAO,kBAAkB,EAAE,KAAK;wBAC5B,MAAM,KAAK,QAAQ,CAAC,IAAI;wBACxB,MAAM,KAAK,QAAQ,CAAC,SAAS;wBAC7B,IAAI,KAAK,EAAE;wBACX,OAAO,EAAE,OAAO;wBAChB,MAAM;oBACV;gBACJ;YACJ;YACA,OAAO,iBAAiB,GAAG;gBACvB,YAAY;YAChB;QACJ;QACA,OAAO;IACX;IACA,SAAS,sBAAsB,QAAQ;QACnC,MAAM,SAAS,4BAA4B;QAC3C,OAAO,IAAI,WAAW,SAAS,CAAC;IACpC;IACA,SAAS,0BAA0B,QAAQ;QACvC,OAAO,eAAe,UAAU;IACpC;IACA,SAAS,qBAAqB,QAAQ;QAClC,MAAM,cAAc,0BAA0B;QAC9C,OAAO;YACH;YACA,WAAW,yBAAyB;QACxC;IACJ;IACA,SAAS,yBAAyB,QAAQ;QACtC,OAAO,eAAe,UAAU;IACpC;IACA,SAAS,UAAU,KAAK;QACpB,IAAI,OAAO,UAAU,UAAU;YAC3B,OAAO;QACX,OACK;YACD,MAAM,YAAY,KAAK,CAAC,EAAE;YAC1B,IAAI,OAAO,MAAM,CAAC,WAAW,YAAY;gBACrC,OAAO;YACX,OACK;gBACD,OAAO;YACX;QACJ;IACJ;IACA,eAAe,sBAAsB,KAAK,EAAE,WAAW;QACnD,MAAM,QAAQ,MAAM,sBAAsB;QAC1C,MAAM,WAAW;YACb;gBACI,MAAM;gBACN;YACJ;SACH;QACD,OAAO;IACX;IACA,eAAe,0BAA0B,KAAK,EAAE,WAAW;QACvD,MAAM,gBAAgB,MAAM,GAAG,CAAC,CAAC,KAAK,IAAM,qBAAqB,KAAK,KAAK,CAAC,IAAI,EAAE;QAClF,MAAM,SAAS,MAAM,QAAQ,GAAG,CAAC;QACjC,OAAO,OAAO,MAAM,CAAC,CAAC,KAAK;YACvB,gCAAgC;YAChC,IAAI,IAAI,KAAK,CAAC,CAAC,UAAY,QAAQ,IAAI,KAAK,WAAW;gBACnD,OAAO;YACX;YACA,qCAAqC;YACrC,IAAI,GAAG,CAAC,EAAE,EAAE,SAAS,cACjB,IAAI,MAAM,GAAG,KACb,GAAG,CAAC,IAAI,MAAM,GAAG,EAAE,CAAC,IAAI,KAAK,YAAY;gBACzC,GAAG,CAAC,IAAI,MAAM,GAAG,EAAE,CAAC,KAAK,GAAG;uBACrB,GAAG,CAAC,IAAI,MAAM,GAAG,EAAE,CAAC,KAAK;uBACzB,GAAG,CAAC,EAAE,CAAC,KAAK;iBAClB;YACL,OACK;gBACD,IAAI,IAAI,IAAI;YAChB;YACA,OAAO;QACX,GAAG,EAAE;IACT;IACA,eAAe,eAAe,KAAK,EAAE,UAAU;QAC3C,MAAM,KAAK,UAAU;QACrB,OAAQ;YACJ,KAAK;gBACD,OAAO,sBAAsB,OAAO;YACxC,KAAK;gBACD,OAAO,0BAA0B,OAAO;YAC5C;gBACI,MAAM,IAAI,MAAM,CAAC,oBAAoB,EAAE,GAAG,GAAG,EAAE,OAAO;QAC9D;IACJ;IACA,SAAS,uBAAuB,UAAU;QACtC,MAAM,MAAM;YACR,aAAa,WAAW,WAAW;YACnC,MAAM,WAAW,IAAI;YACrB,MAAM,WAAW,IAAI;YACrB,iBAAiB,WAAW,eAAe;YAC3C,kBAAkB,WAAW,gBAAgB;YAC7C,iBAAiB,WAAW,eAAe;YAC3C,eAAe,WAAW,aAAa;YACvC,kBAAkB,WAAW,gBAAgB;QACjD;QACA,qCAAqC;QACrC,IAAI,OAAO,WAAW,QAAQ,KAAK,aAAa;YAC5C,IAAI,gBAAgB,GAAG,WAAW,QAAQ;YAC1C,IAAI,WAAW,QAAQ,IACnB,OAAO,WAAW,WAAW,KAAK,aAAa;gBAC/C,IAAI,QAAQ,GAAG,WAAW,WAAW;YACzC;QACJ;QACA,OAAO;IACX;IACA,SAAS,qBAAqB,UAAU;QACpC,OAAO,WAAW,cAAc,IAAI,EAAE;IAC1C;IACA,eAAe,mCAAmC,KAAK;QACnD,IAAI,MAAM,CAAC;QACX,IAAK,IAAI,QAAQ,GAAG,QAAQ,MAAM,MAAM,EAAE,SAAS,EAAG;YAClD,MAAM,UAAU,KAAK,CAAC,MAAM;YAC5B,IAAI,QAAQ,QAAQ,OAAO,UAAU;gBACjC,gEAAgE;gBAChE,sDAAsD;gBACtD,IAAI,UAAU,GAAG;oBACb,gDAAgD;oBAChD,MAAM,CAAC,MAAM,qBAAqB,SAAS,UAAU,CAAC,CAAC,EAAE;gBAC7D,OACK;oBACD,MAAM,IAAI,MAAM;gBACpB;YACJ;QACJ;QACA,OAAO;IACX;IACA,eAAe,wBAAwB,KAAK;QACxC,IAAI,CAAC,QAAQ,sBAAsB;YAC/B,OAAO,CAAC;QACZ;QACA,MAAM,KAAK,UAAU;QACrB,OAAQ;YACJ,KAAK;gBACD,OAAO,mCAAmC;YAC9C;gBACI,OAAO,CAAC;QAChB;IACJ;IACA,SAAS,oCAAoC,IAAI;QAC7C,MAAM,aAAa,CAAC,GAAG,8BAA8B,qBAAqB,EAAE,KAAK,MAAM;QACvF,OAAO;YACH,MAAM,KAAK,IAAI;YACf,aAAa,KAAK,WAAW,IAAI,CAAC,6BAA6B,CAAC;YAChE,YAAY;QAChB;IACJ;IACA,SAAS,eAAe,IAAI;QACxB,KAAK,MAAM,QAAQ,WAAW,0BAA0B,CAAE;YACtD,IAAI,QAAQ,MAAM;gBACd,OAAO;YACX;QACJ;QACA,OAAO;IACX;IACA,SAAS,gBAAgB,IAAI;QACzB,MAAM,OAAO,eAAe;QAC5B,MAAM,MAAM,QAAQ;QACpB,IAAI,QAAQ,OAAO,QAAQ,MAAM;YAC7B,OAAO;gBACH,CAAC,IAAI,EAAE,CAAC;YACZ;QACJ,OACK;YACD,OAAO;QACX;IACJ;IACA,SAAS,YAAY,UAAU;QAC3B,MAAM,QAAQ,YAAY;QAC1B,IAAI,CAAC,SAAS,MAAM,MAAM,KAAK,GAAG;YAC9B,OAAO,EAAE;QACb;QACA,sEAAsE;QACtE,yDAAyD;QACzD,MAAM,iBAAiB,EAAE;QACzB,MAAM,aAAa,EAAE;QACrB,MAAM,OAAO,CAAC,CAAC;YACX,IAAI,CAAC,GAAG,mBAAmB,eAAe,EAAE,OAAO;gBAC/C,eAAe,IAAI,CAAC;YACxB,OACK;gBACD,WAAW,IAAI,CAAC,gBAAgB;YACpC;QACJ;QACA,MAAM,SAAS;eAAI;SAAW;QAC9B,IAAI,eAAe,MAAM,GAAG,GAAG;YAC3B,OAAO,IAAI,CAAC;gBACR,sBAAsB,eAAe,GAAG,CAAC;YAC7C;QACJ;QACA,OAAO;IACX;IACA,SAAS,iBAAiB,UAAU;QAChC,IAAI,CAAC,WAAW,WAAW,IAAI,OAAO,WAAW,WAAW,KAAK,UAAU;YACvE,OAAO;QACX;QACA,IAAI;YAAC;YAAQ;YAAO;SAAO,CAAC,QAAQ,CAAC,WAAW,WAAW,GAAG;YAC1D,OAAO;gBACH,uBAAuB;oBACnB,MAAM,WAAW,WAAW;oBAC5B,sBAAsB,WAAW,sBAAsB;gBAC3D;YACJ;QACJ;QACA,8EAA8E;QAC9E,OAAO;YACH,uBAAuB;gBACnB,MAAM;gBACN,sBAAsB;oBAAC,WAAW,WAAW;iBAAC;YAClD;QACJ;IACJ;IACA,eAAe,WAAW,KAAK,EAAE,UAAU;QACvC,MAAM,aAAa;QACnB,MAAM,WAAW,MAAM,eAAe,YAAY;QAClD,MAAM,mBAAmB,uBAAuB;QAChD,MAAM,QAAQ,YAAY;QAC1B,MAAM,aAAa,iBAAiB;QACpC,MAAM,iBAAiB,qBAAqB;QAC5C,MAAM,oBAAoB,MAAM,wBAAwB;QACxD,MAAM,MAAM;YACR;YACA;QACJ;QACA,IAAI,SAAS,MAAM,MAAM,EAAE;YACvB,IAAI,KAAK,GAAG;QAChB;QACA,IAAI,YAAY;YACZ,IAAI,UAAU,GAAG;QACrB;QACA,IAAI,kBAAkB,eAAe,MAAM,EAAE;YACzC,IAAI,cAAc,GAAG;QACzB;QACA,IAAI,mBAAmB,QACnB,mBAAmB,SACnB,mBAAmB,OAAO,QAAQ;YAClC,IAAI,iBAAiB,GAAG;QAC5B;QACA,OAAO;IACX;IACA,OAAO;QACH;QACA;QACA,kBAAkB;QAClB,0BAA0B;QAC1B;QACA,uBAAuB;QACvB,sBAAsB;QACtB;IACJ;AACJ;AACA,QAAQ,YAAY,GAAG;AACvB,SAAS,qBAAqB,MAAM;IAChC,IAAI,OAAO,eAAe,IAAI,OAAO,eAAe,GAAG,GAAG;QACtD,MAAM,IAAI,MAAM;IACpB;IACA,IAAI,OAAO,WAAW,IAClB,CAAC,OAAO,WAAW,GAAG,KAAK,OAAO,WAAW,GAAG,CAAC,GAAG;QACpD,MAAM,IAAI,MAAM;IACpB;IACA,IAAI,OAAO,IAAI,IAAI,CAAC,OAAO,IAAI,GAAG,KAAK,OAAO,IAAI,GAAG,CAAC,GAAG;QACrD,MAAM,IAAI,MAAM;IACpB;IACA,IAAI,OAAO,IAAI,IAAI,OAAO,IAAI,GAAG,GAAG;QAChC,MAAM,IAAI,MAAM;IACpB;AACJ;AACA,QAAQ,oBAAoB,GAAG;AAC/B,SAAS,cAAc,SAAS;IAC5B,OAAO,UAAU,WAAW,GAAG,UAAU,CAAC;AAC9C;AACA,QAAQ,aAAa,GAAG","ignoreList":[0]}},
    {"offset": {"line": 1156, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/utils/anthropic.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isModelClaude = exports.validateClaudeParams = exports.getAnthropicAPI = void 0;\nconst outputs_1 = require(\"@langchain/core/outputs\");\nconst messages_1 = require(\"@langchain/core/messages\");\nfunction getAnthropicAPI(config) {\n    function partToString(part) {\n        return \"text\" in part ? part.text : \"\";\n    }\n    function messageToString(message) {\n        const content = message?.content ?? [];\n        const ret = content.reduce((acc, part) => {\n            const str = partToString(part);\n            return acc + str;\n        }, \"\");\n        return ret;\n    }\n    function responseToString(response) {\n        const data = response.data;\n        switch (data?.type) {\n            case \"message\":\n                return messageToString(data);\n            default:\n                throw Error(`Unknown type: ${data?.type}`);\n        }\n    }\n    /**\n     * Normalize the AIMessageChunk.\n     * If the fields are just a string - use that as content.\n     * If the content is an array of just text fields, turn them into a string.\n     * @param fields\n     */\n    function newAIMessageChunk(fields) {\n        if (typeof fields === \"string\") {\n            return new messages_1.AIMessageChunk(fields);\n        }\n        const ret = {\n            ...fields,\n        };\n        if (Array.isArray(fields?.content)) {\n            let str = \"\";\n            fields.content.forEach((val) => {\n                if (str !== undefined && val.type === \"text\") {\n                    str = `${str}${val.text}`;\n                }\n                else {\n                    str = undefined;\n                }\n            });\n            if (str) {\n                ret.content = str;\n            }\n        }\n        return new messages_1.AIMessageChunk(ret);\n    }\n    function textContentToMessageFields(textContent) {\n        return {\n            content: [textContent],\n        };\n    }\n    function toolUseContentToMessageFields(toolUseContent) {\n        const tool = {\n            id: toolUseContent.id,\n            name: toolUseContent.name,\n            type: \"tool_call\",\n            args: toolUseContent.input,\n        };\n        return {\n            content: [],\n            tool_calls: [tool],\n        };\n    }\n    function anthropicContentToMessageFields(anthropicContent) {\n        const type = anthropicContent?.type;\n        switch (type) {\n            case \"text\":\n                return textContentToMessageFields(anthropicContent);\n            case \"tool_use\":\n                return toolUseContentToMessageFields(anthropicContent);\n            default:\n                return undefined;\n        }\n    }\n    function contentToMessage(anthropicContent) {\n        const complexContent = [];\n        const toolCalls = [];\n        anthropicContent.forEach((ac) => {\n            const messageFields = anthropicContentToMessageFields(ac);\n            if (messageFields?.content) {\n                complexContent.push(...messageFields.content);\n            }\n            if (messageFields?.tool_calls) {\n                toolCalls.push(...messageFields.tool_calls);\n            }\n        });\n        const ret = {\n            content: complexContent,\n            tool_calls: toolCalls,\n        };\n        return newAIMessageChunk(ret);\n    }\n    function messageToGenerationInfo(message) {\n        const usage = message?.usage;\n        const usageMetadata = {\n            input_tokens: usage?.input_tokens ?? 0,\n            output_tokens: usage?.output_tokens ?? 0,\n            total_tokens: (usage?.input_tokens ?? 0) + (usage?.output_tokens ?? 0),\n        };\n        return {\n            usage_metadata: usageMetadata,\n            finish_reason: message.stop_reason,\n        };\n    }\n    function messageToChatGeneration(responseMessage) {\n        const content = responseMessage?.content ?? [];\n        const text = messageToString(responseMessage);\n        const message = contentToMessage(content);\n        const generationInfo = messageToGenerationInfo(responseMessage);\n        return new outputs_1.ChatGenerationChunk({\n            text,\n            message,\n            generationInfo,\n        });\n    }\n    function messageStartToChatGeneration(event) {\n        const responseMessage = event.message;\n        return messageToChatGeneration(responseMessage);\n    }\n    function messageDeltaToChatGeneration(event) {\n        const responseMessage = event.delta;\n        return messageToChatGeneration(responseMessage);\n    }\n    function contentBlockStartTextToChatGeneration(event) {\n        const content = event.content_block;\n        const message = contentToMessage([content]);\n        if (!message) {\n            return null;\n        }\n        const text = \"text\" in content ? content.text : \"\";\n        return new outputs_1.ChatGenerationChunk({\n            message,\n            text,\n        });\n    }\n    function contentBlockStartToolUseToChatGeneration(event) {\n        const contentBlock = event.content_block;\n        const text = \"\";\n        const toolChunk = {\n            type: \"tool_call_chunk\",\n            index: event.index,\n            name: contentBlock.name,\n            id: contentBlock.id,\n        };\n        if (typeof contentBlock.input === \"object\" &&\n            Object.keys(contentBlock.input).length > 0) {\n            toolChunk.args = JSON.stringify(contentBlock.input);\n        }\n        const toolChunks = [toolChunk];\n        const content = [\n            {\n                index: event.index,\n                ...contentBlock,\n            },\n        ];\n        const messageFields = {\n            content,\n            tool_call_chunks: toolChunks,\n        };\n        const message = newAIMessageChunk(messageFields);\n        return new outputs_1.ChatGenerationChunk({\n            message,\n            text,\n        });\n    }\n    function contentBlockStartToChatGeneration(event) {\n        switch (event.content_block.type) {\n            case \"text\":\n                return contentBlockStartTextToChatGeneration(event);\n            case \"tool_use\":\n                return contentBlockStartToolUseToChatGeneration(event);\n            default:\n                console.warn(`Unexpected start content_block type: ${JSON.stringify(event)}`);\n                return null;\n        }\n    }\n    function contentBlockDeltaTextToChatGeneration(event) {\n        const delta = event.delta;\n        const text = delta?.text;\n        const message = newAIMessageChunk(text);\n        return new outputs_1.ChatGenerationChunk({\n            message,\n            text,\n        });\n    }\n    function contentBlockDeltaInputJsonDeltaToChatGeneration(event) {\n        const delta = event.delta;\n        const text = \"\";\n        const toolChunks = [\n            {\n                index: event.index,\n                args: delta.partial_json,\n            },\n        ];\n        const content = [\n            {\n                index: event.index,\n                ...delta,\n            },\n        ];\n        const messageFields = {\n            content,\n            tool_call_chunks: toolChunks,\n        };\n        const message = newAIMessageChunk(messageFields);\n        return new outputs_1.ChatGenerationChunk({\n            message,\n            text,\n        });\n    }\n    function contentBlockDeltaToChatGeneration(event) {\n        switch (event.delta.type) {\n            case \"text_delta\":\n                return contentBlockDeltaTextToChatGeneration(event);\n            case \"input_json_delta\":\n                return contentBlockDeltaInputJsonDeltaToChatGeneration(event);\n            default:\n                console.warn(`Unexpected delta content_block type: ${JSON.stringify(event)}`);\n                return null;\n        }\n    }\n    function responseToChatGeneration(response) {\n        const data = response.data;\n        switch (data.type) {\n            case \"message\":\n                return messageToChatGeneration(data);\n            case \"message_start\":\n                return messageStartToChatGeneration(data);\n            case \"message_delta\":\n                return messageDeltaToChatGeneration(data);\n            case \"content_block_start\":\n                return contentBlockStartToChatGeneration(data);\n            case \"content_block_delta\":\n                return contentBlockDeltaToChatGeneration(data);\n            case \"ping\":\n            case \"message_stop\":\n            case \"content_block_stop\":\n                // These are ignorable\n                return null;\n            case \"error\":\n                throw new Error(`Error while streaming results: ${JSON.stringify(data)}`);\n            default:\n                // We don't know what type this is, but Anthropic may have added\n                // new ones without telling us. Don't error, but don't use them.\n                console.warn(\"Unknown data for responseToChatGeneration\", data);\n                // throw new Error(`Unknown response type: ${data.type}`);\n                return null;\n        }\n    }\n    function chunkToString(chunk) {\n        if (chunk === null) {\n            return \"\";\n        }\n        else if (typeof chunk.content === \"string\") {\n            return chunk.content;\n        }\n        else if (chunk.content.length === 0) {\n            return \"\";\n        }\n        else if (chunk.content[0].type === \"text\") {\n            return chunk.content[0].text;\n        }\n        else {\n            throw new Error(`Unexpected chunk: ${chunk}`);\n        }\n    }\n    function responseToBaseMessage(response) {\n        const data = response.data;\n        const content = data?.content ?? [];\n        return contentToMessage(content);\n    }\n    function responseToChatResult(response) {\n        const message = response.data;\n        const generations = [];\n        const gen = responseToChatGeneration(response);\n        if (gen) {\n            generations.push(gen);\n        }\n        const llmOutput = messageToGenerationInfo(message);\n        return {\n            generations,\n            llmOutput,\n        };\n    }\n    function formatAnthropicVersion() {\n        return config?.version ?? \"vertex-2023-10-16\";\n    }\n    function textContentToAnthropicContent(content) {\n        return content;\n    }\n    function extractMimeType(str) {\n        if (str.startsWith(\"data:\")) {\n            return {\n                media_type: str.split(\":\")[1].split(\";\")[0],\n                data: str.split(\",\")[1],\n            };\n        }\n        return null;\n    }\n    function imageContentToAnthropicContent(content) {\n        const dataUrl = content.image_url;\n        const url = typeof dataUrl === \"string\" ? dataUrl : dataUrl?.url;\n        const urlInfo = extractMimeType(url);\n        if (!urlInfo) {\n            return undefined;\n        }\n        return {\n            type: \"image\",\n            source: {\n                type: \"base64\",\n                ...urlInfo,\n            },\n        };\n    }\n    function contentComplexToAnthropicContent(content) {\n        const type = content?.type;\n        switch (type) {\n            case \"text\":\n                return textContentToAnthropicContent(content);\n            case \"image_url\":\n                return imageContentToAnthropicContent(content);\n            default:\n                console.warn(`Unexpected content type: ${type}`);\n                return undefined;\n        }\n    }\n    function contentToAnthropicContent(content) {\n        const ret = [];\n        const ca = typeof content === \"string\" ? [{ type: \"text\", text: content }] : content;\n        ca.forEach((complex) => {\n            const ac = contentComplexToAnthropicContent(complex);\n            if (ac) {\n                ret.push(ac);\n            }\n        });\n        return ret;\n    }\n    function baseRoleToAnthropicMessage(base, role) {\n        const content = contentToAnthropicContent(base.content);\n        return {\n            role,\n            content,\n        };\n    }\n    function toolMessageToAnthropicMessage(base) {\n        const role = \"user\";\n        const toolUseId = base.tool_call_id;\n        const toolContent = contentToAnthropicContent(base.content);\n        const content = [\n            {\n                type: \"tool_result\",\n                tool_use_id: toolUseId,\n                content: toolContent,\n            },\n        ];\n        return {\n            role,\n            content,\n        };\n    }\n    function baseToAnthropicMessage(base) {\n        const type = base._getType();\n        switch (type) {\n            case \"human\":\n                return baseRoleToAnthropicMessage(base, \"user\");\n            case \"ai\":\n                return baseRoleToAnthropicMessage(base, \"assistant\");\n            case \"tool\":\n                return toolMessageToAnthropicMessage(base);\n            default:\n                return undefined;\n        }\n    }\n    function formatMessages(input) {\n        const ret = [];\n        input.forEach((baseMessage) => {\n            const anthropicMessage = baseToAnthropicMessage(baseMessage);\n            if (anthropicMessage) {\n                ret.push(anthropicMessage);\n            }\n        });\n        return ret;\n    }\n    function formatSettings(parameters) {\n        const ret = {\n            stream: parameters?.streaming ?? false,\n            max_tokens: parameters?.maxOutputTokens ?? 8192,\n        };\n        if (parameters.topP) {\n            ret.top_p = parameters.topP;\n        }\n        if (parameters.topK) {\n            ret.top_k = parameters.topK;\n        }\n        if (parameters.temperature) {\n            ret.temperature = parameters.temperature;\n        }\n        if (parameters.stopSequences) {\n            ret.stop_sequences = parameters.stopSequences;\n        }\n        return ret;\n    }\n    function contentComplexArrayToText(contentArray) {\n        let ret = \"\";\n        contentArray.forEach((content) => {\n            const contentType = content?.type;\n            if (contentType === \"text\") {\n                const textContent = content;\n                ret = `${ret}\\n${textContent.text}`;\n            }\n        });\n        return ret;\n    }\n    function formatSystem(input) {\n        let ret = \"\";\n        input.forEach((message) => {\n            if (message._getType() === \"system\") {\n                const content = message?.content;\n                const contentString = typeof content === \"string\"\n                    ? content\n                    : contentComplexArrayToText(content);\n                ret = `${ret}\\n${contentString}`;\n            }\n        });\n        return ret;\n    }\n    function formatGeminiTool(tool) {\n        if (Object.hasOwn(tool, \"functionDeclarations\")) {\n            const funcs = tool?.functionDeclarations ?? [];\n            return funcs.map((func) => {\n                const inputSchema = func.parameters;\n                return {\n                    // type: \"tool\",  // This may only be valid for models 20241022+\n                    name: func.name,\n                    description: func.description,\n                    input_schema: inputSchema,\n                };\n            });\n        }\n        else {\n            console.warn(`Unable to format GeminiTool: ${JSON.stringify(tool, null, 1)}`);\n            return [];\n        }\n    }\n    function formatTool(tool) {\n        if (Object.hasOwn(tool, \"name\")) {\n            return [tool];\n        }\n        else {\n            return formatGeminiTool(tool);\n        }\n    }\n    function formatTools(parameters) {\n        const tools = parameters?.tools ?? [];\n        const ret = [];\n        tools.forEach((tool) => {\n            const anthropicTools = formatTool(tool);\n            anthropicTools.forEach((anthropicTool) => {\n                if (anthropicTool) {\n                    ret.push(anthropicTool);\n                }\n            });\n        });\n        return ret;\n    }\n    function formatToolChoice(parameters) {\n        const choice = parameters?.tool_choice;\n        if (!choice) {\n            return undefined;\n        }\n        else if (typeof choice === \"object\") {\n            return choice;\n        }\n        else {\n            switch (choice) {\n                case \"any\":\n                case \"auto\":\n                    return {\n                        type: choice,\n                    };\n                case \"none\":\n                    return undefined;\n                default:\n                    return {\n                        type: \"tool\",\n                        name: choice,\n                    };\n            }\n        }\n    }\n    async function formatData(input, parameters) {\n        const typedInput = input;\n        const anthropicVersion = formatAnthropicVersion();\n        const messages = formatMessages(typedInput);\n        const settings = formatSettings(parameters);\n        const system = formatSystem(typedInput);\n        const tools = formatTools(parameters);\n        const toolChoice = formatToolChoice(parameters);\n        const ret = {\n            anthropic_version: anthropicVersion,\n            messages,\n            ...settings,\n        };\n        if (tools && tools.length && parameters?.tool_choice !== \"none\") {\n            ret.tools = tools;\n        }\n        if (toolChoice) {\n            ret.tool_choice = toolChoice;\n        }\n        if (system?.length) {\n            ret.system = system;\n        }\n        return ret;\n    }\n    return {\n        responseToString,\n        responseToChatGeneration,\n        chunkToString,\n        responseToBaseMessage,\n        responseToChatResult,\n        formatData,\n    };\n}\nexports.getAnthropicAPI = getAnthropicAPI;\nfunction validateClaudeParams(_params) {\n    // FIXME - validate the parameters\n}\nexports.validateClaudeParams = validateClaudeParams;\nfunction isModelClaude(modelName) {\n    return modelName.toLowerCase().startsWith(\"claude\");\n}\nexports.isModelClaude = isModelClaude;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1704, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/utils/common.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.copyAndValidateModelParamsInto = exports.validateModelParams = exports.modelToPublisher = exports.modelToFamily = exports.copyAIModelParamsInto = exports.convertToGeminiTools = exports.copyAIModelParams = void 0;\nconst base_1 = require(\"@langchain/core/language_models/base\");\nconst function_calling_1 = require(\"@langchain/core/utils/function_calling\");\nconst gemini_js_1 = require(\"./gemini.cjs\");\nconst types_js_1 = require(\"../types.cjs\");\nconst zod_to_gemini_parameters_js_1 = require(\"./zod_to_gemini_parameters.cjs\");\nconst anthropic_js_1 = require(\"./anthropic.cjs\");\nfunction copyAIModelParams(params, options) {\n    return copyAIModelParamsInto(params, options, {});\n}\nexports.copyAIModelParams = copyAIModelParams;\nfunction processToolChoice(toolChoice, allowedFunctionNames) {\n    if (!toolChoice) {\n        if (allowedFunctionNames) {\n            // Allowed func names is passed, return 'any' so it forces the model to use a tool.\n            return {\n                tool_choice: \"any\",\n                allowed_function_names: allowedFunctionNames,\n            };\n        }\n        return undefined;\n    }\n    if (toolChoice === \"any\" || toolChoice === \"auto\" || toolChoice === \"none\") {\n        return {\n            tool_choice: toolChoice,\n            allowed_function_names: allowedFunctionNames,\n        };\n    }\n    if (typeof toolChoice === \"string\") {\n        // String representing the function name.\n        // Return any to force the model to predict the specified function call.\n        return {\n            tool_choice: \"any\",\n            allowed_function_names: [...(allowedFunctionNames ?? []), toolChoice],\n        };\n    }\n    throw new Error(\"Object inputs for tool_choice not supported.\");\n}\nfunction isGeminiTool(tool) {\n    for (const toolAttribute of types_js_1.GeminiToolAttributes) {\n        if (toolAttribute in tool) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction isGeminiNonFunctionTool(tool) {\n    return isGeminiTool(tool) && !(\"functionDeclaration\" in tool);\n}\nfunction convertToGeminiTools(tools) {\n    const geminiTools = [];\n    let functionDeclarationsIndex = -1;\n    tools.forEach((tool) => {\n        if (isGeminiNonFunctionTool(tool)) {\n            geminiTools.push(tool);\n        }\n        else {\n            if (functionDeclarationsIndex === -1) {\n                geminiTools.push({\n                    functionDeclarations: [],\n                });\n                functionDeclarationsIndex = geminiTools.length - 1;\n            }\n            if (\"functionDeclarations\" in tool &&\n                Array.isArray(tool.functionDeclarations)) {\n                const funcs = tool.functionDeclarations;\n                geminiTools[functionDeclarationsIndex].functionDeclarations.push(...funcs);\n            }\n            else if ((0, function_calling_1.isLangChainTool)(tool)) {\n                const jsonSchema = (0, zod_to_gemini_parameters_js_1.zodToGeminiParameters)(tool.schema);\n                geminiTools[functionDeclarationsIndex].functionDeclarations.push({\n                    name: tool.name,\n                    description: tool.description ?? `A function available to call.`,\n                    parameters: jsonSchema,\n                });\n            }\n            else if ((0, base_1.isOpenAITool)(tool)) {\n                geminiTools[functionDeclarationsIndex].functionDeclarations.push({\n                    name: tool.function.name,\n                    description: tool.function.description ?? `A function available to call.`,\n                    parameters: (0, zod_to_gemini_parameters_js_1.jsonSchemaToGeminiParameters)(tool.function.parameters),\n                });\n            }\n            else {\n                throw new Error(`Received invalid tool: ${JSON.stringify(tool)}`);\n            }\n        }\n    });\n    return geminiTools;\n}\nexports.convertToGeminiTools = convertToGeminiTools;\nfunction copyAIModelParamsInto(params, options, target) {\n    const ret = target || {};\n    const model = options?.model ?? params?.model ?? target.model;\n    ret.modelName =\n        model ?? options?.modelName ?? params?.modelName ?? target.modelName;\n    ret.model = model;\n    ret.temperature =\n        options?.temperature ?? params?.temperature ?? target.temperature;\n    ret.maxOutputTokens =\n        options?.maxOutputTokens ??\n            params?.maxOutputTokens ??\n            target.maxOutputTokens;\n    ret.topP = options?.topP ?? params?.topP ?? target.topP;\n    ret.topK = options?.topK ?? params?.topK ?? target.topK;\n    ret.presencePenalty =\n        options?.presencePenalty ??\n            params?.presencePenalty ??\n            target.presencePenalty;\n    ret.frequencyPenalty =\n        options?.frequencyPenalty ??\n            params?.frequencyPenalty ??\n            target.frequencyPenalty;\n    ret.stopSequences =\n        options?.stopSequences ?? params?.stopSequences ?? target.stopSequences;\n    ret.safetySettings =\n        options?.safetySettings ?? params?.safetySettings ?? target.safetySettings;\n    ret.logprobs = options?.logprobs ?? params?.logprobs ?? target.logprobs;\n    ret.topLogprobs =\n        options?.topLogprobs ?? params?.topLogprobs ?? target.topLogprobs;\n    ret.convertSystemMessageToHumanContent =\n        options?.convertSystemMessageToHumanContent ??\n            params?.convertSystemMessageToHumanContent ??\n            target?.convertSystemMessageToHumanContent;\n    ret.responseMimeType =\n        options?.responseMimeType ??\n            params?.responseMimeType ??\n            target?.responseMimeType;\n    ret.streaming = options?.streaming ?? params?.streaming ?? target?.streaming;\n    const toolChoice = processToolChoice(options?.tool_choice, options?.allowed_function_names);\n    if (toolChoice) {\n        ret.tool_choice = toolChoice.tool_choice;\n        ret.allowed_function_names = toolChoice.allowed_function_names;\n    }\n    const tools = options?.tools;\n    if (tools) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        ret.tools = convertToGeminiTools(tools);\n    }\n    return ret;\n}\nexports.copyAIModelParamsInto = copyAIModelParamsInto;\nfunction modelToFamily(modelName) {\n    if (!modelName) {\n        return null;\n    }\n    else if ((0, gemini_js_1.isModelGemini)(modelName)) {\n        return \"gemini\";\n    }\n    else if ((0, anthropic_js_1.isModelClaude)(modelName)) {\n        return \"claude\";\n    }\n    else {\n        return null;\n    }\n}\nexports.modelToFamily = modelToFamily;\nfunction modelToPublisher(modelName) {\n    const family = modelToFamily(modelName);\n    switch (family) {\n        case \"gemini\":\n        case \"palm\":\n            return \"google\";\n        case \"claude\":\n            return \"anthropic\";\n        default:\n            return \"unknown\";\n    }\n}\nexports.modelToPublisher = modelToPublisher;\nfunction validateModelParams(params) {\n    const testParams = params ?? {};\n    const model = testParams.model ?? testParams.modelName;\n    switch (modelToFamily(model)) {\n        case \"gemini\":\n            return (0, gemini_js_1.validateGeminiParams)(testParams);\n        case \"claude\":\n            return (0, anthropic_js_1.validateClaudeParams)(testParams);\n        default:\n            throw new Error(`Unable to verify model params: ${JSON.stringify(params)}`);\n    }\n}\nexports.validateModelParams = validateModelParams;\nfunction copyAndValidateModelParamsInto(params, target) {\n    copyAIModelParamsInto(params, undefined, target);\n    validateModelParams(target);\n    return target;\n}\nexports.copyAndValidateModelParamsInto = copyAndValidateModelParamsInto;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1875, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/utils/failed_handler.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ensureParams = exports.failedAttemptHandler = void 0;\nconst STATUS_NO_RETRY = [\n    400,\n    401,\n    402,\n    403,\n    404,\n    405,\n    406,\n    407,\n    408,\n    409, // Conflict\n];\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction failedAttemptHandler(error) {\n    const status = error?.response?.status ?? 0;\n    if (status === 0) {\n        // What is this?\n        console.error(\"failedAttemptHandler\", error);\n        throw error;\n    }\n    // What errors shouldn't be retried?\n    if (STATUS_NO_RETRY.includes(+status)) {\n        throw error;\n    }\n}\nexports.failedAttemptHandler = failedAttemptHandler;\nfunction ensureParams(params) {\n    const base = params ?? {};\n    return {\n        onFailedAttempt: failedAttemptHandler,\n        ...base,\n    };\n}\nexports.ensureParams = ensureParams;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,YAAY,GAAG,QAAQ,oBAAoB,GAAG,KAAK;AAC3D,MAAM,kBAAkB;IACpB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACH;AACD,8DAA8D;AAC9D,SAAS,qBAAqB,KAAK;IAC/B,MAAM,SAAS,OAAO,UAAU,UAAU;IAC1C,IAAI,WAAW,GAAG;QACd,gBAAgB;QAChB,QAAQ,KAAK,CAAC,wBAAwB;QACtC,MAAM;IACV;IACA,oCAAoC;IACpC,IAAI,gBAAgB,QAAQ,CAAC,CAAC,SAAS;QACnC,MAAM;IACV;AACJ;AACA,QAAQ,oBAAoB,GAAG;AAC/B,SAAS,aAAa,MAAM;IACxB,MAAM,OAAO,UAAU,CAAC;IACxB,OAAO;QACH,iBAAiB;QACjB,GAAG,IAAI;IACX;AACJ;AACA,QAAQ,YAAY,GAAG","ignoreList":[0]}},
    {"offset": {"line": 1917, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/utils/palm.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK","ignoreList":[0]}},
    {"offset": {"line": 1924, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/utils/stream.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ReadableSseJsonStream = exports.SseJsonStream = exports.ReadableSseStream = exports.SseStream = exports.ReadableJsonStream = exports.ReadableAbstractStream = exports.ComplexJsonStream = exports.JsonStream = exports.simpleValue = exports.complexValue = void 0;\nfunction complexValue(value) {\n    if (value === null || typeof value === \"undefined\") {\n        // I dunno what to put here. An error, probably\n        return undefined;\n    }\n    else if (typeof value === \"object\") {\n        if (Array.isArray(value)) {\n            return {\n                list_val: value.map((avalue) => complexValue(avalue)),\n            };\n        }\n        else {\n            const ret = {};\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const v = value;\n            Object.keys(v).forEach((key) => {\n                ret[key] = complexValue(v[key]);\n            });\n            return { struct_val: ret };\n        }\n    }\n    else if (typeof value === \"number\") {\n        if (Number.isInteger(value)) {\n            return { int_val: value };\n        }\n        else {\n            return { float_val: value };\n        }\n    }\n    else {\n        return {\n            string_val: [value],\n        };\n    }\n}\nexports.complexValue = complexValue;\nfunction simpleValue(val) {\n    if (val && typeof val === \"object\" && !Array.isArray(val)) {\n        // eslint-disable-next-line no-prototype-builtins\n        if (val.hasOwnProperty(\"stringVal\")) {\n            return val.stringVal[0];\n            // eslint-disable-next-line no-prototype-builtins\n        }\n        else if (val.hasOwnProperty(\"boolVal\")) {\n            return val.boolVal[0];\n            // eslint-disable-next-line no-prototype-builtins\n        }\n        else if (val.hasOwnProperty(\"listVal\")) {\n            const { listVal } = val;\n            return listVal.map((aval) => simpleValue(aval));\n            // eslint-disable-next-line no-prototype-builtins\n        }\n        else if (val.hasOwnProperty(\"structVal\")) {\n            const ret = {};\n            const struct = val.structVal;\n            Object.keys(struct).forEach((key) => {\n                ret[key] = simpleValue(struct[key]);\n            });\n            return ret;\n        }\n        else {\n            const ret = {};\n            const struct = val;\n            Object.keys(struct).forEach((key) => {\n                ret[key] = simpleValue(struct[key]);\n            });\n            return ret;\n        }\n    }\n    else if (Array.isArray(val)) {\n        return val.map((aval) => simpleValue(aval));\n    }\n    else {\n        return val;\n    }\n}\nexports.simpleValue = simpleValue;\nclass JsonStream {\n    constructor() {\n        Object.defineProperty(this, \"_buffer\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"\"\n        });\n        Object.defineProperty(this, \"_bufferOpen\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: true\n        });\n        Object.defineProperty(this, \"_firstRun\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: true\n        });\n        // Set up a potential Promise that the handler can resolve.\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        Object.defineProperty(this, \"_chunkResolution\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        // If there is no Promise (it is null), the handler must add it to the queue\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        Object.defineProperty(this, \"_chunkPending\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: null\n        });\n        // A queue that will collect chunks while there is no Promise\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        Object.defineProperty(this, \"_chunkQueue\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: []\n        });\n    }\n    /**\n     * Add data to the buffer. This may cause chunks to be generated, if available.\n     * @param data\n     */\n    appendBuffer(data) {\n        this._buffer += data;\n        // Our first time, skip to the opening of the array\n        if (this._firstRun) {\n            this._skipTo(\"[\");\n            this._firstRun = false;\n        }\n        this._parseBuffer();\n    }\n    /**\n     * Indicate there is no more data that will be added to the text buffer.\n     * This should be called when all the data has been read and added to indicate\n     * that we should process everything remaining in the buffer.\n     */\n    closeBuffer() {\n        this._bufferOpen = false;\n        this._parseBuffer();\n    }\n    /**\n     * Skip characters in the buffer till we get to the start of an object.\n     * Then attempt to read a full object.\n     * If we do read a full object, turn it into a chunk and send it to the chunk handler.\n     * Repeat this for as much as we can.\n     */\n    _parseBuffer() {\n        let obj = null;\n        do {\n            this._skipTo(\"{\");\n            obj = this._getFullObject();\n            if (obj !== null) {\n                const chunk = this._simplifyObject(obj);\n                this._handleChunk(chunk);\n            }\n        } while (obj !== null);\n        if (!this._bufferOpen) {\n            // No more data will be added, and we have parsed everything we could,\n            // so everything else is garbage.\n            this._handleChunk(null);\n            this._buffer = \"\";\n        }\n    }\n    /**\n     * If the string is present, move the start of the buffer to the first occurrence\n     * of that string. This is useful for skipping over elements or parts that we're not\n     * really interested in parsing. (ie - the opening characters, comma separators, etc.)\n     * @param start The string to start the buffer with\n     */\n    _skipTo(start) {\n        const index = this._buffer.indexOf(start);\n        if (index > 0) {\n            this._buffer = this._buffer.slice(index);\n        }\n    }\n    /**\n     * Given what is in the buffer, parse a single object out of it.\n     * If a complete object isn't available, return null.\n     * Assumes that we are at the start of an object to parse.\n     */\n    _getFullObject() {\n        let ret = null;\n        // Loop while we don't have something to return AND we have something in the buffer\n        let index = 0;\n        while (ret === null && this._buffer.length > index) {\n            // Advance to the next close bracket after our current index\n            index = this._buffer.indexOf(\"}\", index + 1);\n            // If we don't find one, exit with null\n            if (index === -1) {\n                return null;\n            }\n            // If we have one, try to turn it into an object to return\n            try {\n                const objStr = this._buffer.substring(0, index + 1);\n                ret = JSON.parse(objStr);\n                // We only get here if it parsed it ok\n                // If we did turn it into an object, remove it from the buffer\n                this._buffer = this._buffer.slice(index + 1);\n            }\n            catch (xx) {\n                // It didn't parse it correctly, so we swallow the exception and continue\n            }\n        }\n        return ret;\n    }\n    _simplifyObject(obj) {\n        return obj;\n    }\n    /**\n     * Register that we have another chunk available for consumption.\n     * If we are waiting for a chunk, resolve the promise waiting for it immediately.\n     * If not, then add it to the queue.\n     * @param chunk\n     */\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    _handleChunk(chunk) {\n        if (this._chunkPending) {\n            this._chunkResolution(chunk);\n            this._chunkPending = null;\n        }\n        else {\n            this._chunkQueue.push(chunk);\n        }\n    }\n    /**\n     * Get the next chunk that is coming from the stream.\n     * This chunk may be null, usually indicating the last chunk in the stream.\n     */\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    async nextChunk() {\n        if (this._chunkQueue.length > 0) {\n            // If there is data in the queue, return the next queue chunk\n            return this._chunkQueue.shift();\n        }\n        else {\n            // Otherwise, set up a promise that handleChunk will cause to be resolved\n            this._chunkPending = new Promise((resolve) => {\n                this._chunkResolution = resolve;\n            });\n            return this._chunkPending;\n        }\n    }\n    /**\n     * Is the stream done?\n     * A stream is only done if all of the following are true:\n     * - There is no more data to be added to the text buffer\n     * - There is no more data in the text buffer\n     * - There are no chunks that are waiting to be consumed\n     */\n    get streamDone() {\n        return (!this._bufferOpen &&\n            this._buffer.length === 0 &&\n            this._chunkQueue.length === 0 &&\n            this._chunkPending === null);\n    }\n}\nexports.JsonStream = JsonStream;\nclass ComplexJsonStream extends JsonStream {\n    _simplifyObject(obj) {\n        return simpleValue(obj);\n    }\n}\nexports.ComplexJsonStream = ComplexJsonStream;\nclass ReadableAbstractStream {\n    constructor(baseStream, body) {\n        Object.defineProperty(this, \"baseStream\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"decoder\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.baseStream = baseStream;\n        this.decoder = new TextDecoder(\"utf-8\");\n        if (body) {\n            void this.run(body);\n        }\n        else {\n            console.error(\"Unexpected empty body while streaming\");\n        }\n    }\n    appendBuffer(data) {\n        return this.baseStream.appendBuffer(data);\n    }\n    closeBuffer() {\n        return this.baseStream.closeBuffer();\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    nextChunk() {\n        return this.baseStream.nextChunk();\n    }\n    get streamDone() {\n        return this.baseStream.streamDone;\n    }\n    async run(body) {\n        const reader = body.getReader();\n        let isDone = false;\n        while (!isDone) {\n            const { value, done } = await reader.read();\n            if (!done) {\n                const svalue = this.decoder.decode(value, { stream: true });\n                this.appendBuffer(svalue);\n            }\n            else {\n                isDone = done;\n                this.closeBuffer();\n            }\n        }\n    }\n}\nexports.ReadableAbstractStream = ReadableAbstractStream;\nclass ReadableJsonStream extends ReadableAbstractStream {\n    constructor(body) {\n        super(new JsonStream(), body);\n    }\n}\nexports.ReadableJsonStream = ReadableJsonStream;\nclass SseStream {\n    constructor() {\n        Object.defineProperty(this, \"_buffer\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"\"\n        });\n        Object.defineProperty(this, \"_bufferOpen\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: true\n        });\n        // Set up a potential Promise that the handler can resolve.\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        Object.defineProperty(this, \"_chunkResolution\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        // If there is no Promise (it is null), the handler must add it to the queue\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        Object.defineProperty(this, \"_chunkPending\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: null\n        });\n        // A queue that will collect chunks while there is no Promise\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        Object.defineProperty(this, \"_chunkQueue\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: []\n        });\n    }\n    appendBuffer(data) {\n        this._buffer += data;\n        this._parseBuffer();\n    }\n    closeBuffer() {\n        this._bufferOpen = false;\n        this._parseBuffer();\n    }\n    /**\n     * Attempt to load an entire event.\n     * For each entire event we load,\n     * send them to be handled.\n     */\n    _parseBuffer() {\n        const events = this._buffer.split(/\\n\\n/);\n        this._buffer = events.pop() ?? \"\";\n        events.forEach((event) => this._handleEvent(event.trim()));\n        if (!this._bufferOpen) {\n            // No more data will be added, and we have parsed\n            // everything. So dump the rest.\n            this._handleEvent(null);\n            this._buffer = \"\";\n        }\n    }\n    /**\n     * Given an event string, get all the fields\n     * in the event. It is assumed there is one field\n     * per line, but that field names can be duplicated,\n     * indicating to append the new value to the previous value\n     * @param event\n     */\n    _parseEvent(event) {\n        if (!event || event.trim() === \"\") {\n            return null;\n        }\n        const ret = {};\n        const lines = event.split(/\\n/);\n        lines.forEach((line) => {\n            const match = line.match(/^([^:]+): \\s*(.+)\\n*$/);\n            if (match && match.length === 3) {\n                const key = match[1];\n                const val = match[2];\n                const cur = ret[key] ?? \"\";\n                ret[key] = `${cur}${val}`;\n            }\n        });\n        return ret;\n    }\n    _handleEvent(event) {\n        const chunk = this._parseEvent(event);\n        if (this._chunkPending) {\n            this._chunkResolution(chunk);\n            this._chunkPending = null;\n        }\n        else {\n            this._chunkQueue.push(chunk);\n        }\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    async nextChunk() {\n        if (this._chunkQueue.length > 0) {\n            // If there is data in the queue, return the next queue chunk\n            return this._chunkQueue.shift();\n        }\n        else {\n            // Otherwise, set up a promise that handleChunk will cause to be resolved\n            this._chunkPending = new Promise((resolve) => {\n                this._chunkResolution = resolve;\n            });\n            return this._chunkPending;\n        }\n    }\n    get streamDone() {\n        return (!this._bufferOpen &&\n            this._buffer.length === 0 &&\n            this._chunkQueue.length === 0 &&\n            this._chunkPending === null);\n    }\n}\nexports.SseStream = SseStream;\nclass ReadableSseStream extends ReadableAbstractStream {\n    constructor(body) {\n        super(new SseStream(), body);\n    }\n}\nexports.ReadableSseStream = ReadableSseStream;\nclass SseJsonStream extends SseStream {\n    constructor(jsonAttribute) {\n        super();\n        Object.defineProperty(this, \"_jsonAttribute\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"data\"\n        });\n        this._jsonAttribute = jsonAttribute ?? this._jsonAttribute;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    async nextChunk() {\n        const eventRecord = (await super.nextChunk());\n        const json = eventRecord?.[this._jsonAttribute];\n        if (!json) {\n            return null;\n        }\n        else {\n            return JSON.parse(json);\n        }\n    }\n}\nexports.SseJsonStream = SseJsonStream;\nclass ReadableSseJsonStream extends ReadableAbstractStream {\n    constructor(body) {\n        super(new SseJsonStream(), body);\n    }\n}\nexports.ReadableSseJsonStream = ReadableSseJsonStream;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 2388, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/utils/index.cjs"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./common.cjs\"), exports);\n__exportStar(require(\"./failed_handler.cjs\"), exports);\n__exportStar(require(\"./gemini.cjs\"), exports);\n__exportStar(require(\"./zod_to_gemini_parameters.cjs\"), exports);\n__exportStar(require(\"./palm.cjs\"), exports);\n__exportStar(require(\"./safety.cjs\"), exports);\n__exportStar(require(\"./stream.cjs\"), exports);\n"],"names":[],"mappings":"AACA,IAAI,kBAAkB,4DAAS,yDAAK,eAAe,IAAK,CAAC,OAAO,MAAM,GAAI,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;IAC1F,IAAI,OAAO,WAAW,KAAK;IAC3B,IAAI,OAAO,OAAO,wBAAwB,CAAC,GAAG;IAC9C,IAAI,CAAC,QAAQ,CAAC,SAAS,OAAO,CAAC,EAAE,UAAU,GAAG,KAAK,QAAQ,IAAI,KAAK,YAAY,GAAG;QACjF,OAAO;YAAE,YAAY;YAAM,KAAK;gBAAa,OAAO,CAAC,CAAC,EAAE;YAAE;QAAE;IAC9D;IACA,OAAO,cAAc,CAAC,GAAG,IAAI;AACjC,IAAM,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;IACtB,IAAI,OAAO,WAAW,KAAK;IAC3B,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,EAAE;AAChB,CAAE;AACF,IAAI,eAAe,4DAAS,yDAAK,YAAY,IAAK,SAAS,CAAC,EAAE,QAAO;IACjE,IAAK,IAAI,KAAK,EAAG,IAAI,MAAM,aAAa,CAAC,OAAO,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,UAAS,IAAI,gBAAgB,UAAS,GAAG;AAC3H;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,wIAAsC;AACtC,gJAA8C;AAC9C,wIAAsC;AACtC,0JAAwD;AACxD,sIAAoC;AACpC,wIAAsC;AACtC,wIAAsC","ignoreList":[0]}},
    {"offset": {"line": 2421, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/connection.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.GoogleRequestRecorder = exports.GoogleRequestLogger = exports.GoogleRequestCallbackHandler = exports.AbstractGoogleLLMConnection = exports.GoogleAIConnection = exports.GoogleRawConnection = exports.GoogleHostConnection = exports.GoogleConnection = void 0;\nconst env_1 = require(\"@langchain/core/utils/env\");\nconst base_1 = require(\"@langchain/core/callbacks/base\");\nconst index_js_1 = require(\"./utils/index.cjs\");\nconst anthropic_js_1 = require(\"./utils/anthropic.cjs\");\nclass GoogleConnection {\n    constructor(caller, client, streaming) {\n        Object.defineProperty(this, \"caller\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"client\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"streaming\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.caller = caller;\n        this.client = client;\n        this.streaming = streaming ?? false;\n    }\n    async _clientInfoHeaders() {\n        const { userAgent, clientLibraryVersion } = await this._getClientInfo();\n        return {\n            \"User-Agent\": userAgent,\n            \"Client-Info\": clientLibraryVersion,\n        };\n    }\n    async _getClientInfo() {\n        const env = await (0, env_1.getRuntimeEnvironment)();\n        const langchain = env?.library ?? \"langchain-js\";\n        // TODO: Add an API for getting the current LangChain version\n        const langchainVersion = \"0\";\n        const moduleName = await this._moduleName();\n        let clientLibraryVersion = `${langchain}/${langchainVersion}`;\n        if (moduleName && moduleName.length) {\n            clientLibraryVersion = `${clientLibraryVersion}-${moduleName}`;\n        }\n        return {\n            userAgent: clientLibraryVersion,\n            clientLibraryVersion: `${langchainVersion}-${moduleName}`,\n        };\n    }\n    async _moduleName() {\n        return this.constructor.name;\n    }\n    async additionalHeaders() {\n        return {};\n    }\n    async _buildOpts(data, _options, requestHeaders = {}) {\n        const url = await this.buildUrl();\n        const method = this.buildMethod();\n        const infoHeaders = (await this._clientInfoHeaders()) ?? {};\n        const additionalHeaders = (await this.additionalHeaders()) ?? {};\n        const headers = {\n            ...infoHeaders,\n            ...additionalHeaders,\n            ...requestHeaders,\n        };\n        const opts = {\n            url,\n            method,\n            headers,\n        };\n        if (data && method === \"POST\") {\n            opts.data = data;\n        }\n        if (this.streaming) {\n            opts.responseType = \"stream\";\n        }\n        else {\n            opts.responseType = \"json\";\n        }\n        return opts;\n    }\n    async _request(data, options, requestHeaders = {}) {\n        const opts = await this._buildOpts(data, options, requestHeaders);\n        const callResponse = await this.caller.callWithOptions({ signal: options?.signal }, async () => this.client.request(opts));\n        const response = callResponse; // Done for typecast safety, I guess\n        return response;\n    }\n}\nexports.GoogleConnection = GoogleConnection;\nclass GoogleHostConnection extends GoogleConnection {\n    constructor(fields, caller, client, streaming) {\n        super(caller, client, streaming);\n        // This does not default to a value intentionally.\n        // Use the \"platform\" getter if you need this.\n        Object.defineProperty(this, \"platformType\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"_endpoint\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"_location\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"apiVersion\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"v1\"\n        });\n        this.caller = caller;\n        this.platformType = fields?.platformType;\n        this._endpoint = fields?.endpoint;\n        this._location = fields?.location;\n        this.apiVersion = fields?.apiVersion ?? this.apiVersion;\n        this.client = client;\n    }\n    get platform() {\n        return this.platformType ?? this.computedPlatformType;\n    }\n    get computedPlatformType() {\n        return \"gcp\";\n    }\n    get location() {\n        return this._location ?? this.computedLocation;\n    }\n    get computedLocation() {\n        return \"us-central1\";\n    }\n    get endpoint() {\n        return this._endpoint ?? this.computedEndpoint;\n    }\n    get computedEndpoint() {\n        return `${this.location}-aiplatform.googleapis.com`;\n    }\n    buildMethod() {\n        return \"POST\";\n    }\n}\nexports.GoogleHostConnection = GoogleHostConnection;\nclass GoogleRawConnection extends GoogleHostConnection {\n    async _buildOpts(data, _options, requestHeaders = {}) {\n        const opts = await super._buildOpts(data, _options, requestHeaders);\n        opts.responseType = \"blob\";\n        return opts;\n    }\n}\nexports.GoogleRawConnection = GoogleRawConnection;\nclass GoogleAIConnection extends GoogleHostConnection {\n    constructor(fields, caller, client, streaming) {\n        super(fields, caller, client, streaming);\n        Object.defineProperty(this, \"model\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"modelName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"client\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"_apiName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"apiConfig\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.client = client;\n        this.modelName = fields?.model ?? fields?.modelName ?? this.model;\n        this.model = this.modelName;\n        this._apiName = fields?.apiName;\n        this.apiConfig = {\n            safetyHandler: fields?.safetyHandler,\n            ...fields?.apiConfig,\n        };\n    }\n    get modelFamily() {\n        return (0, index_js_1.modelToFamily)(this.model);\n    }\n    get modelPublisher() {\n        return (0, index_js_1.modelToPublisher)(this.model);\n    }\n    get computedAPIName() {\n        // At least at the moment, model publishers and APIs map the same\n        return this.modelPublisher;\n    }\n    get apiName() {\n        return this._apiName ?? this.computedAPIName;\n    }\n    get api() {\n        switch (this.apiName) {\n            case \"google\":\n                return (0, index_js_1.getGeminiAPI)(this.apiConfig);\n            case \"anthropic\":\n                return (0, anthropic_js_1.getAnthropicAPI)(this.apiConfig);\n            default:\n                throw new Error(`Unknown API: ${this.apiName}`);\n        }\n    }\n    get computedPlatformType() {\n        if (this.client.clientType === \"apiKey\") {\n            return \"gai\";\n        }\n        else {\n            return \"gcp\";\n        }\n    }\n    get computedLocation() {\n        switch (this.apiName) {\n            case \"google\":\n                return super.computedLocation;\n            case \"anthropic\":\n                return \"us-east5\";\n            default:\n                throw new Error(`Unknown apiName: ${this.apiName}. Can't get location.`);\n        }\n    }\n    async buildUrlGenerativeLanguage() {\n        const method = await this.buildUrlMethod();\n        const url = `https://generativelanguage.googleapis.com/${this.apiVersion}/models/${this.model}:${method}`;\n        return url;\n    }\n    async buildUrlVertex() {\n        const projectId = await this.client.getProjectId();\n        const method = await this.buildUrlMethod();\n        const publisher = this.modelPublisher;\n        const url = `https://${this.endpoint}/${this.apiVersion}/projects/${projectId}/locations/${this.location}/publishers/${publisher}/models/${this.model}:${method}`;\n        return url;\n    }\n    async buildUrl() {\n        switch (this.platform) {\n            case \"gai\":\n                return this.buildUrlGenerativeLanguage();\n            default:\n                return this.buildUrlVertex();\n        }\n    }\n    async request(input, parameters, options, runManager) {\n        const moduleName = this.constructor.name;\n        const streamingParameters = {\n            ...parameters,\n            streaming: this.streaming,\n        };\n        const data = await this.formatData(input, streamingParameters);\n        await runManager?.handleCustomEvent(`google-request-${moduleName}`, {\n            data,\n            parameters: streamingParameters,\n            options,\n            connection: {\n                ...this,\n                url: await this.buildUrl(),\n                urlMethod: await this.buildUrlMethod(),\n                modelFamily: this.modelFamily,\n                modelPublisher: this.modelPublisher,\n                computedPlatformType: this.computedPlatformType,\n            },\n        });\n        const response = await this._request(data, options);\n        await runManager?.handleCustomEvent(`google-response-${moduleName}`, {\n            response,\n        });\n        return response;\n    }\n}\nexports.GoogleAIConnection = GoogleAIConnection;\nclass AbstractGoogleLLMConnection extends GoogleAIConnection {\n    async buildUrlMethodGemini() {\n        return this.streaming ? \"streamGenerateContent\" : \"generateContent\";\n    }\n    async buildUrlMethodClaude() {\n        return this.streaming ? \"streamRawPredict\" : \"rawPredict\";\n    }\n    async buildUrlMethod() {\n        switch (this.modelFamily) {\n            case \"gemini\":\n                return this.buildUrlMethodGemini();\n            case \"claude\":\n                return this.buildUrlMethodClaude();\n            default:\n                throw new Error(`Unknown model family: ${this.modelFamily}`);\n        }\n    }\n    async formatData(input, parameters) {\n        return this.api.formatData(input, parameters);\n    }\n}\nexports.AbstractGoogleLLMConnection = AbstractGoogleLLMConnection;\nclass GoogleRequestCallbackHandler extends base_1.BaseCallbackHandler {\n    customEventInfo(eventName) {\n        const names = eventName.split(\"-\");\n        return {\n            subEvent: names[1],\n            module: names[2],\n        };\n    }\n    handleCustomEvent(eventName, data, runId, tags, metadata) {\n        if (!eventName) {\n            return undefined;\n        }\n        const eventInfo = this.customEventInfo(eventName);\n        switch (eventInfo.subEvent) {\n            case \"request\":\n                return this.handleCustomRequestEvent(eventName, eventInfo, data, runId, tags, metadata);\n            case \"response\":\n                return this.handleCustomResponseEvent(eventName, eventInfo, data, runId, tags, metadata);\n            case \"chunk\":\n                return this.handleCustomChunkEvent(eventName, eventInfo, data, runId, tags, metadata);\n            default:\n                console.error(`Unexpected eventInfo for ${eventName} ${JSON.stringify(eventInfo, null, 1)}`);\n        }\n    }\n}\nexports.GoogleRequestCallbackHandler = GoogleRequestCallbackHandler;\nclass GoogleRequestLogger extends GoogleRequestCallbackHandler {\n    constructor() {\n        super(...arguments);\n        Object.defineProperty(this, \"name\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"GoogleRequestLogger\"\n        });\n    }\n    log(eventName, data, tags) {\n        const tagStr = tags ? `[${tags}]` : \"[]\";\n        console.log(`${eventName} ${tagStr} ${JSON.stringify(data, null, 1)}`);\n    }\n    handleCustomRequestEvent(eventName, _eventInfo, data, _runId, tags, _metadata) {\n        this.log(eventName, data, tags);\n    }\n    handleCustomResponseEvent(eventName, _eventInfo, data, _runId, tags, _metadata) {\n        this.log(eventName, data, tags);\n    }\n    handleCustomChunkEvent(eventName, _eventInfo, data, _runId, tags, _metadata) {\n        this.log(eventName, data, tags);\n    }\n}\nexports.GoogleRequestLogger = GoogleRequestLogger;\nclass GoogleRequestRecorder extends GoogleRequestCallbackHandler {\n    constructor() {\n        super(...arguments);\n        Object.defineProperty(this, \"name\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"GoogleRequestRecorder\"\n        });\n        Object.defineProperty(this, \"request\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: {}\n        });\n        Object.defineProperty(this, \"response\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: {}\n        });\n        Object.defineProperty(this, \"chunk\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: []\n        });\n    }\n    handleCustomRequestEvent(_eventName, _eventInfo, data, _runId, _tags, _metadata) {\n        this.request = data;\n    }\n    handleCustomResponseEvent(_eventName, _eventInfo, data, _runId, _tags, _metadata) {\n        this.response = data;\n    }\n    handleCustomChunkEvent(_eventName, _eventInfo, data, _runId, _tags, _metadata) {\n        this.chunk.push(data);\n    }\n}\nexports.GoogleRequestRecorder = GoogleRequestRecorder;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,qBAAqB,GAAG,QAAQ,mBAAmB,GAAG,QAAQ,4BAA4B,GAAG,QAAQ,2BAA2B,GAAG,QAAQ,kBAAkB,GAAG,QAAQ,mBAAmB,GAAG,QAAQ,oBAAoB,GAAG,QAAQ,gBAAgB,GAAG,KAAK;AACrQ,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;IACF,YAAY,MAAM,EAAE,MAAM,EAAE,SAAS,CAAE;QACnC,OAAO,cAAc,CAAC,IAAI,EAAE,UAAU;YAClC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;QACA,OAAO,cAAc,CAAC,IAAI,EAAE,UAAU;YAClC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;QACA,OAAO,cAAc,CAAC,IAAI,EAAE,aAAa;YACrC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;QACA,IAAI,CAAC,MAAM,GAAG;QACd,IAAI,CAAC,MAAM,GAAG;QACd,IAAI,CAAC,SAAS,GAAG,aAAa;IAClC;IACA,MAAM,qBAAqB;QACvB,MAAM,EAAE,SAAS,EAAE,oBAAoB,EAAE,GAAG,MAAM,IAAI,CAAC,cAAc;QACrE,OAAO;YACH,cAAc;YACd,eAAe;QACnB;IACJ;IACA,MAAM,iBAAiB;QACnB,MAAM,MAAM,MAAM,CAAC,GAAG,MAAM,qBAAqB;QACjD,MAAM,YAAY,KAAK,WAAW;QAClC,6DAA6D;QAC7D,MAAM,mBAAmB;QACzB,MAAM,aAAa,MAAM,IAAI,CAAC,WAAW;QACzC,IAAI,uBAAuB,GAAG,UAAU,CAAC,EAAE,kBAAkB;QAC7D,IAAI,cAAc,WAAW,MAAM,EAAE;YACjC,uBAAuB,GAAG,qBAAqB,CAAC,EAAE,YAAY;QAClE;QACA,OAAO;YACH,WAAW;YACX,sBAAsB,GAAG,iBAAiB,CAAC,EAAE,YAAY;QAC7D;IACJ;IACA,MAAM,cAAc;QAChB,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI;IAChC;IACA,MAAM,oBAAoB;QACtB,OAAO,CAAC;IACZ;IACA,MAAM,WAAW,IAAI,EAAE,QAAQ,EAAE,iBAAiB,CAAC,CAAC,EAAE;QAClD,MAAM,MAAM,MAAM,IAAI,CAAC,QAAQ;QAC/B,MAAM,SAAS,IAAI,CAAC,WAAW;QAC/B,MAAM,cAAc,AAAC,MAAM,IAAI,CAAC,kBAAkB,MAAO,CAAC;QAC1D,MAAM,oBAAoB,AAAC,MAAM,IAAI,CAAC,iBAAiB,MAAO,CAAC;QAC/D,MAAM,UAAU;YACZ,GAAG,WAAW;YACd,GAAG,iBAAiB;YACpB,GAAG,cAAc;QACrB;QACA,MAAM,OAAO;YACT;YACA;YACA;QACJ;QACA,IAAI,QAAQ,WAAW,QAAQ;YAC3B,KAAK,IAAI,GAAG;QAChB;QACA,IAAI,IAAI,CAAC,SAAS,EAAE;YAChB,KAAK,YAAY,GAAG;QACxB,OACK;YACD,KAAK,YAAY,GAAG;QACxB;QACA,OAAO;IACX;IACA,MAAM,SAAS,IAAI,EAAE,OAAO,EAAE,iBAAiB,CAAC,CAAC,EAAE;QAC/C,MAAM,OAAO,MAAM,IAAI,CAAC,UAAU,CAAC,MAAM,SAAS;QAClD,MAAM,eAAe,MAAM,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC;YAAE,QAAQ,SAAS;QAAO,GAAG,UAAY,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;QACpH,MAAM,WAAW,cAAc,oCAAoC;QACnE,OAAO;IACX;AACJ;AACA,QAAQ,gBAAgB,GAAG;AAC3B,MAAM,6BAA6B;IAC/B,YAAY,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,SAAS,CAAE;QAC3C,KAAK,CAAC,QAAQ,QAAQ;QACtB,kDAAkD;QAClD,8CAA8C;QAC9C,OAAO,cAAc,CAAC,IAAI,EAAE,gBAAgB;YACxC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;QACA,OAAO,cAAc,CAAC,IAAI,EAAE,aAAa;YACrC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;QACA,OAAO,cAAc,CAAC,IAAI,EAAE,aAAa;YACrC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;QACA,OAAO,cAAc,CAAC,IAAI,EAAE,cAAc;YACtC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO;QACX;QACA,IAAI,CAAC,MAAM,GAAG;QACd,IAAI,CAAC,YAAY,GAAG,QAAQ;QAC5B,IAAI,CAAC,SAAS,GAAG,QAAQ;QACzB,IAAI,CAAC,SAAS,GAAG,QAAQ;QACzB,IAAI,CAAC,UAAU,GAAG,QAAQ,cAAc,IAAI,CAAC,UAAU;QACvD,IAAI,CAAC,MAAM,GAAG;IAClB;IACA,IAAI,WAAW;QACX,OAAO,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,oBAAoB;IACzD;IACA,IAAI,uBAAuB;QACvB,OAAO;IACX;IACA,IAAI,WAAW;QACX,OAAO,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,gBAAgB;IAClD;IACA,IAAI,mBAAmB;QACnB,OAAO;IACX;IACA,IAAI,WAAW;QACX,OAAO,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,gBAAgB;IAClD;IACA,IAAI,mBAAmB;QACnB,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,0BAA0B,CAAC;IACvD;IACA,cAAc;QACV,OAAO;IACX;AACJ;AACA,QAAQ,oBAAoB,GAAG;AAC/B,MAAM,4BAA4B;IAC9B,MAAM,WAAW,IAAI,EAAE,QAAQ,EAAE,iBAAiB,CAAC,CAAC,EAAE;QAClD,MAAM,OAAO,MAAM,KAAK,CAAC,WAAW,MAAM,UAAU;QACpD,KAAK,YAAY,GAAG;QACpB,OAAO;IACX;AACJ;AACA,QAAQ,mBAAmB,GAAG;AAC9B,MAAM,2BAA2B;IAC7B,YAAY,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,SAAS,CAAE;QAC3C,KAAK,CAAC,QAAQ,QAAQ,QAAQ;QAC9B,OAAO,cAAc,CAAC,IAAI,EAAE,SAAS;YACjC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;QACA,OAAO,cAAc,CAAC,IAAI,EAAE,aAAa;YACrC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;QACA,OAAO,cAAc,CAAC,IAAI,EAAE,UAAU;YAClC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;QACA,OAAO,cAAc,CAAC,IAAI,EAAE,YAAY;YACpC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;QACA,OAAO,cAAc,CAAC,IAAI,EAAE,aAAa;YACrC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;QACA,IAAI,CAAC,MAAM,GAAG;QACd,IAAI,CAAC,SAAS,GAAG,QAAQ,SAAS,QAAQ,aAAa,IAAI,CAAC,KAAK;QACjE,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,SAAS;QAC3B,IAAI,CAAC,QAAQ,GAAG,QAAQ;QACxB,IAAI,CAAC,SAAS,GAAG;YACb,eAAe,QAAQ;YACvB,GAAG,QAAQ,SAAS;QACxB;IACJ;IACA,IAAI,cAAc;QACd,OAAO,CAAC,GAAG,WAAW,aAAa,EAAE,IAAI,CAAC,KAAK;IACnD;IACA,IAAI,iBAAiB;QACjB,OAAO,CAAC,GAAG,WAAW,gBAAgB,EAAE,IAAI,CAAC,KAAK;IACtD;IACA,IAAI,kBAAkB;QAClB,iEAAiE;QACjE,OAAO,IAAI,CAAC,cAAc;IAC9B;IACA,IAAI,UAAU;QACV,OAAO,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,eAAe;IAChD;IACA,IAAI,MAAM;QACN,OAAQ,IAAI,CAAC,OAAO;YAChB,KAAK;gBACD,OAAO,CAAC,GAAG,WAAW,YAAY,EAAE,IAAI,CAAC,SAAS;YACtD,KAAK;gBACD,OAAO,CAAC,GAAG,eAAe,eAAe,EAAE,IAAI,CAAC,SAAS;YAC7D;gBACI,MAAM,IAAI,MAAM,CAAC,aAAa,EAAE,IAAI,CAAC,OAAO,EAAE;QACtD;IACJ;IACA,IAAI,uBAAuB;QACvB,IAAI,IAAI,CAAC,MAAM,CAAC,UAAU,KAAK,UAAU;YACrC,OAAO;QACX,OACK;YACD,OAAO;QACX;IACJ;IACA,IAAI,mBAAmB;QACnB,OAAQ,IAAI,CAAC,OAAO;YAChB,KAAK;gBACD,OAAO,KAAK,CAAC;YACjB,KAAK;gBACD,OAAO;YACX;gBACI,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,IAAI,CAAC,OAAO,CAAC,qBAAqB,CAAC;QAC/E;IACJ;IACA,MAAM,6BAA6B;QAC/B,MAAM,SAAS,MAAM,IAAI,CAAC,cAAc;QACxC,MAAM,MAAM,CAAC,0CAA0C,EAAE,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,QAAQ;QACzG,OAAO;IACX;IACA,MAAM,iBAAiB;QACnB,MAAM,YAAY,MAAM,IAAI,CAAC,MAAM,CAAC,YAAY;QAChD,MAAM,SAAS,MAAM,IAAI,CAAC,cAAc;QACxC,MAAM,YAAY,IAAI,CAAC,cAAc;QACrC,MAAM,MAAM,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,UAAU,WAAW,EAAE,IAAI,CAAC,QAAQ,CAAC,YAAY,EAAE,UAAU,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,QAAQ;QACjK,OAAO;IACX;IACA,MAAM,WAAW;QACb,OAAQ,IAAI,CAAC,QAAQ;YACjB,KAAK;gBACD,OAAO,IAAI,CAAC,0BAA0B;YAC1C;gBACI,OAAO,IAAI,CAAC,cAAc;QAClC;IACJ;IACA,MAAM,QAAQ,KAAK,EAAE,UAAU,EAAE,OAAO,EAAE,UAAU,EAAE;QAClD,MAAM,aAAa,IAAI,CAAC,WAAW,CAAC,IAAI;QACxC,MAAM,sBAAsB;YACxB,GAAG,UAAU;YACb,WAAW,IAAI,CAAC,SAAS;QAC7B;QACA,MAAM,OAAO,MAAM,IAAI,CAAC,UAAU,CAAC,OAAO;QAC1C,MAAM,YAAY,kBAAkB,CAAC,eAAe,EAAE,YAAY,EAAE;YAChE;YACA,YAAY;YACZ;YACA,YAAY;gBACR,GAAG,IAAI;gBACP,KAAK,MAAM,IAAI,CAAC,QAAQ;gBACxB,WAAW,MAAM,IAAI,CAAC,cAAc;gBACpC,aAAa,IAAI,CAAC,WAAW;gBAC7B,gBAAgB,IAAI,CAAC,cAAc;gBACnC,sBAAsB,IAAI,CAAC,oBAAoB;YACnD;QACJ;QACA,MAAM,WAAW,MAAM,IAAI,CAAC,QAAQ,CAAC,MAAM;QAC3C,MAAM,YAAY,kBAAkB,CAAC,gBAAgB,EAAE,YAAY,EAAE;YACjE;QACJ;QACA,OAAO;IACX;AACJ;AACA,QAAQ,kBAAkB,GAAG;AAC7B,MAAM,oCAAoC;IACtC,MAAM,uBAAuB;QACzB,OAAO,IAAI,CAAC,SAAS,GAAG,0BAA0B;IACtD;IACA,MAAM,uBAAuB;QACzB,OAAO,IAAI,CAAC,SAAS,GAAG,qBAAqB;IACjD;IACA,MAAM,iBAAiB;QACnB,OAAQ,IAAI,CAAC,WAAW;YACpB,KAAK;gBACD,OAAO,IAAI,CAAC,oBAAoB;YACpC,KAAK;gBACD,OAAO,IAAI,CAAC,oBAAoB;YACpC;gBACI,MAAM,IAAI,MAAM,CAAC,sBAAsB,EAAE,IAAI,CAAC,WAAW,EAAE;QACnE;IACJ;IACA,MAAM,WAAW,KAAK,EAAE,UAAU,EAAE;QAChC,OAAO,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,OAAO;IACtC;AACJ;AACA,QAAQ,2BAA2B,GAAG;AACtC,MAAM,qCAAqC,OAAO,mBAAmB;IACjE,gBAAgB,SAAS,EAAE;QACvB,MAAM,QAAQ,UAAU,KAAK,CAAC;QAC9B,OAAO;YACH,UAAU,KAAK,CAAC,EAAE;YAClB,QAAQ,KAAK,CAAC,EAAE;QACpB;IACJ;IACA,kBAAkB,SAAS,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,QAAQ,EAAE;QACtD,IAAI,CAAC,WAAW;YACZ,OAAO;QACX;QACA,MAAM,YAAY,IAAI,CAAC,eAAe,CAAC;QACvC,OAAQ,UAAU,QAAQ;YACtB,KAAK;gBACD,OAAO,IAAI,CAAC,wBAAwB,CAAC,WAAW,WAAW,MAAM,OAAO,MAAM;YAClF,KAAK;gBACD,OAAO,IAAI,CAAC,yBAAyB,CAAC,WAAW,WAAW,MAAM,OAAO,MAAM;YACnF,KAAK;gBACD,OAAO,IAAI,CAAC,sBAAsB,CAAC,WAAW,WAAW,MAAM,OAAO,MAAM;YAChF;gBACI,QAAQ,KAAK,CAAC,CAAC,yBAAyB,EAAE,UAAU,CAAC,EAAE,KAAK,SAAS,CAAC,WAAW,MAAM,IAAI;QACnG;IACJ;AACJ;AACA,QAAQ,4BAA4B,GAAG;AACvC,MAAM,4BAA4B;IAC9B,aAAc;QACV,KAAK,IAAI;QACT,OAAO,cAAc,CAAC,IAAI,EAAE,QAAQ;YAChC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO;QACX;IACJ;IACA,IAAI,SAAS,EAAE,IAAI,EAAE,IAAI,EAAE;QACvB,MAAM,SAAS,OAAO,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,GAAG;QACpC,QAAQ,GAAG,CAAC,GAAG,UAAU,CAAC,EAAE,OAAO,CAAC,EAAE,KAAK,SAAS,CAAC,MAAM,MAAM,IAAI;IACzE;IACA,yBAAyB,SAAS,EAAE,UAAU,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE;QAC3E,IAAI,CAAC,GAAG,CAAC,WAAW,MAAM;IAC9B;IACA,0BAA0B,SAAS,EAAE,UAAU,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE;QAC5E,IAAI,CAAC,GAAG,CAAC,WAAW,MAAM;IAC9B;IACA,uBAAuB,SAAS,EAAE,UAAU,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE;QACzE,IAAI,CAAC,GAAG,CAAC,WAAW,MAAM;IAC9B;AACJ;AACA,QAAQ,mBAAmB,GAAG;AAC9B,MAAM,8BAA8B;IAChC,aAAc;QACV,KAAK,IAAI;QACT,OAAO,cAAc,CAAC,IAAI,EAAE,QAAQ;YAChC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO;QACX;QACA,OAAO,cAAc,CAAC,IAAI,EAAE,WAAW;YACnC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,CAAC;QACZ;QACA,OAAO,cAAc,CAAC,IAAI,EAAE,YAAY;YACpC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,CAAC;QACZ;QACA,OAAO,cAAc,CAAC,IAAI,EAAE,SAAS;YACjC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,EAAE;QACb;IACJ;IACA,yBAAyB,UAAU,EAAE,UAAU,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE;QAC7E,IAAI,CAAC,OAAO,GAAG;IACnB;IACA,0BAA0B,UAAU,EAAE,UAAU,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE;QAC9E,IAAI,CAAC,QAAQ,GAAG;IACpB;IACA,uBAAuB,UAAU,EAAE,UAAU,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE;QAC3E,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;IACpB;AACJ;AACA,QAAQ,qBAAqB,GAAG","ignoreList":[0]}},
    {"offset": {"line": 2829, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/auth.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ensureAuthOptionScopes = exports.aiPlatformScope = exports.ApiKeyGoogleAuth = exports.GoogleAbstractedFetchClient = void 0;\nconst stream_js_1 = require(\"./utils/stream.cjs\");\nclass GoogleAbstractedFetchClient {\n    async _buildData(res, opts) {\n        switch (opts.responseType) {\n            case \"json\":\n                return res.json();\n            case \"stream\":\n                return new stream_js_1.ReadableJsonStream(res.body);\n            default:\n                return res.blob();\n        }\n    }\n    async _request(url, opts, additionalHeaders) {\n        if (url == null)\n            throw new Error(\"Missing URL\");\n        const fetchOptions = {\n            method: opts.method,\n            headers: {\n                \"Content-Type\": \"application/json\",\n                ...(opts.headers ?? {}),\n                ...(additionalHeaders ?? {}),\n            },\n        };\n        if (opts.data !== undefined) {\n            if (typeof opts.data === \"string\") {\n                fetchOptions.body = opts.data;\n            }\n            else {\n                fetchOptions.body = JSON.stringify(opts.data);\n            }\n        }\n        const res = await fetch(url, fetchOptions);\n        if (!res.ok) {\n            const resText = await res.text();\n            const error = new Error(`Google request failed with status code ${res.status}: ${resText}`);\n            /* eslint-disable @typescript-eslint/no-explicit-any */\n            error.response = res;\n            error.details = {\n                url,\n                opts,\n                fetchOptions,\n                result: res,\n            };\n            /* eslint-enable @typescript-eslint/no-explicit-any */\n            throw error;\n        }\n        const data = await this._buildData(res, opts);\n        return {\n            data,\n            config: {},\n            status: res.status,\n            statusText: res.statusText,\n            headers: res.headers,\n            request: { responseURL: res.url },\n        };\n    }\n}\nexports.GoogleAbstractedFetchClient = GoogleAbstractedFetchClient;\nclass ApiKeyGoogleAuth extends GoogleAbstractedFetchClient {\n    constructor(apiKey) {\n        super();\n        Object.defineProperty(this, \"apiKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.apiKey = apiKey;\n    }\n    get clientType() {\n        return \"apiKey\";\n    }\n    getProjectId() {\n        throw new Error(\"APIs that require a project ID cannot use an API key\");\n        // Perhaps we could implement this if needed:\n        // https://cloud.google.com/docs/authentication/api-keys#get-info\n    }\n    request(opts) {\n        const authHeader = {\n            \"X-Goog-Api-Key\": this.apiKey,\n        };\n        return this._request(opts.url, opts, authHeader);\n    }\n}\nexports.ApiKeyGoogleAuth = ApiKeyGoogleAuth;\nfunction aiPlatformScope(platform) {\n    switch (platform) {\n        case \"gai\":\n            return [\"https://www.googleapis.com/auth/generative-language\"];\n        default:\n            return [\"https://www.googleapis.com/auth/cloud-platform\"];\n    }\n}\nexports.aiPlatformScope = aiPlatformScope;\nfunction ensureAuthOptionScopes(authOption, scopeProperty, scopesOrPlatform) {\n    // If the property is already set, return it\n    if (authOption && Object.hasOwn(authOption, scopeProperty)) {\n        return authOption;\n    }\n    // Otherwise add it\n    const scopes = Array.isArray(scopesOrPlatform)\n        ? scopesOrPlatform\n        : aiPlatformScope(scopesOrPlatform ?? \"gcp\");\n    return {\n        [scopeProperty]: scopes,\n        ...(authOption ?? {}),\n    };\n}\nexports.ensureAuthOptionScopes = ensureAuthOptionScopes;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 2946, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/chat_models.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ChatGoogleBase = exports.ChatConnection = void 0;\nconst env_1 = require(\"@langchain/core/utils/env\");\nconst chat_models_1 = require(\"@langchain/core/language_models/chat_models\");\nconst outputs_1 = require(\"@langchain/core/outputs\");\nconst messages_1 = require(\"@langchain/core/messages\");\nconst runnables_1 = require(\"@langchain/core/runnables\");\nconst openai_tools_1 = require(\"@langchain/core/output_parsers/openai_tools\");\nconst stream_1 = require(\"@langchain/core/utils/stream\");\nconst common_js_1 = require(\"./utils/common.cjs\");\nconst connection_js_1 = require(\"./connection.cjs\");\nconst gemini_js_1 = require(\"./utils/gemini.cjs\");\nconst auth_js_1 = require(\"./auth.cjs\");\nconst failed_handler_js_1 = require(\"./utils/failed_handler.cjs\");\nconst zod_to_gemini_parameters_js_1 = require(\"./utils/zod_to_gemini_parameters.cjs\");\nclass ChatConnection extends connection_js_1.AbstractGoogleLLMConnection {\n    constructor(fields, caller, client, streaming) {\n        super(fields, caller, client, streaming);\n        Object.defineProperty(this, \"convertSystemMessageToHumanContent\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.convertSystemMessageToHumanContent =\n            fields?.convertSystemMessageToHumanContent;\n    }\n    get useSystemInstruction() {\n        return typeof this.convertSystemMessageToHumanContent === \"boolean\"\n            ? !this.convertSystemMessageToHumanContent\n            : this.computeUseSystemInstruction;\n    }\n    get computeUseSystemInstruction() {\n        // This works on models from April 2024 and later\n        //   Vertex AI: gemini-1.5-pro and gemini-1.0-002 and later\n        //   AI Studio: gemini-1.5-pro-latest\n        if (this.modelFamily === \"palm\") {\n            return false;\n        }\n        else if (this.modelName === \"gemini-1.0-pro-001\") {\n            return false;\n        }\n        else if (this.modelName.startsWith(\"gemini-pro-vision\")) {\n            return false;\n        }\n        else if (this.modelName.startsWith(\"gemini-1.0-pro-vision\")) {\n            return false;\n        }\n        else if (this.modelName === \"gemini-pro\" && this.platform === \"gai\") {\n            // on AI Studio gemini-pro is still pointing at gemini-1.0-pro-001\n            return false;\n        }\n        return true;\n    }\n    computeGoogleSearchToolAdjustmentFromModel() {\n        if (this.modelName.startsWith(\"gemini-1.0\")) {\n            return \"googleSearchRetrieval\";\n        }\n        else if (this.modelName.startsWith(\"gemini-1.5\")) {\n            return \"googleSearchRetrieval\";\n        }\n        else {\n            return \"googleSearch\";\n        }\n    }\n    computeGoogleSearchToolAdjustment(apiConfig) {\n        const adj = apiConfig.googleSearchToolAdjustment;\n        if (adj === undefined || adj === true) {\n            return this.computeGoogleSearchToolAdjustmentFromModel();\n        }\n        else {\n            return adj;\n        }\n    }\n    buildGeminiAPI() {\n        const apiConfig = this.apiConfig ?? {};\n        const googleSearchToolAdjustment = this.computeGoogleSearchToolAdjustment(apiConfig);\n        const geminiConfig = {\n            useSystemInstruction: this.useSystemInstruction,\n            googleSearchToolAdjustment,\n            ...apiConfig,\n        };\n        return (0, gemini_js_1.getGeminiAPI)(geminiConfig);\n    }\n    get api() {\n        switch (this.apiName) {\n            case \"google\":\n                return this.buildGeminiAPI();\n            default:\n                return super.api;\n        }\n    }\n}\nexports.ChatConnection = ChatConnection;\n/**\n * Integration with a Google chat model.\n */\nclass ChatGoogleBase extends chat_models_1.BaseChatModel {\n    // Used for tracing, replace with the same name as your class\n    static lc_name() {\n        return \"ChatGoogle\";\n    }\n    get lc_secrets() {\n        return {\n            authOptions: \"GOOGLE_AUTH_OPTIONS\",\n        };\n    }\n    constructor(fields) {\n        super((0, failed_handler_js_1.ensureParams)(fields));\n        Object.defineProperty(this, \"lc_serializable\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: true\n        });\n        // Set based on modelName\n        Object.defineProperty(this, \"model\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"modelName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"gemini-pro\"\n        });\n        Object.defineProperty(this, \"temperature\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 0.7\n        });\n        Object.defineProperty(this, \"maxOutputTokens\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 1024\n        });\n        Object.defineProperty(this, \"topP\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 0.8\n        });\n        Object.defineProperty(this, \"topK\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 40\n        });\n        Object.defineProperty(this, \"presencePenalty\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"frequencyPenalty\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"stopSequences\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: []\n        });\n        Object.defineProperty(this, \"logprobs\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"topLogprobs\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 0\n        });\n        Object.defineProperty(this, \"safetySettings\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: []\n        });\n        // May intentionally be undefined, meaning to compute this.\n        Object.defineProperty(this, \"convertSystemMessageToHumanContent\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"safetyHandler\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"streamUsage\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: true\n        });\n        Object.defineProperty(this, \"streaming\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"connection\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"streamedConnection\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        (0, common_js_1.copyAndValidateModelParamsInto)(fields, this);\n        this.safetyHandler =\n            fields?.safetyHandler ?? new gemini_js_1.DefaultGeminiSafetyHandler();\n        this.streamUsage = fields?.streamUsage ?? this.streamUsage;\n        const client = this.buildClient(fields);\n        this.buildConnection(fields ?? {}, client);\n    }\n    getLsParams(options) {\n        const params = this.invocationParams(options);\n        return {\n            ls_provider: \"google_vertexai\",\n            ls_model_name: this.model,\n            ls_model_type: \"chat\",\n            ls_temperature: params.temperature ?? undefined,\n            ls_max_tokens: params.maxOutputTokens ?? undefined,\n            ls_stop: options.stop,\n        };\n    }\n    buildApiKeyClient(apiKey) {\n        return new auth_js_1.ApiKeyGoogleAuth(apiKey);\n    }\n    buildApiKey(fields) {\n        if (fields?.platformType !== \"gcp\") {\n            return fields?.apiKey ?? (0, env_1.getEnvironmentVariable)(\"GOOGLE_API_KEY\");\n        }\n        else {\n            // GCP doesn't support API Keys\n            return undefined;\n        }\n    }\n    buildClient(fields) {\n        const apiKey = this.buildApiKey(fields);\n        if (apiKey) {\n            return this.buildApiKeyClient(apiKey);\n        }\n        else {\n            return this.buildAbstractedClient(fields);\n        }\n    }\n    buildConnection(fields, client) {\n        this.connection = new ChatConnection({ ...fields, ...this }, this.caller, client, false);\n        this.streamedConnection = new ChatConnection({ ...fields, ...this }, this.caller, client, true);\n    }\n    get platform() {\n        return this.connection.platform;\n    }\n    bindTools(tools, kwargs) {\n        return this.bind({ tools: (0, common_js_1.convertToGeminiTools)(tools), ...kwargs });\n    }\n    // Replace\n    _llmType() {\n        return \"chat_integration\";\n    }\n    /**\n     * Get the parameters used to invoke the model\n     */\n    invocationParams(options) {\n        return (0, common_js_1.copyAIModelParams)(this, options);\n    }\n    async _generate(messages, options, runManager) {\n        const parameters = this.invocationParams(options);\n        if (this.streaming) {\n            const stream = this._streamResponseChunks(messages, options, runManager);\n            let finalChunk = null;\n            for await (const chunk of stream) {\n                finalChunk = !finalChunk ? chunk : (0, stream_1.concat)(finalChunk, chunk);\n            }\n            if (!finalChunk) {\n                throw new Error(\"No chunks were returned from the stream.\");\n            }\n            return {\n                generations: [finalChunk],\n            };\n        }\n        const response = await this.connection.request(messages, parameters, options, runManager);\n        const ret = this.connection.api.responseToChatResult(response);\n        const chunk = ret?.generations?.[0];\n        if (chunk) {\n            await runManager?.handleLLMNewToken(chunk.text || \"\");\n        }\n        return ret;\n    }\n    async *_streamResponseChunks(_messages, options, runManager) {\n        // Make the call as a streaming request\n        const parameters = this.invocationParams(options);\n        const response = await this.streamedConnection.request(_messages, parameters, options, runManager);\n        // Get the streaming parser of the response\n        const stream = response.data;\n        let usageMetadata;\n        // Loop until the end of the stream\n        // During the loop, yield each time we get a chunk from the streaming parser\n        // that is either available or added to the queue\n        while (!stream.streamDone) {\n            const output = await stream.nextChunk();\n            await runManager?.handleCustomEvent(`google-chunk-${this.constructor.name}`, {\n                output,\n            });\n            if (output &&\n                output.usageMetadata &&\n                this.streamUsage !== false &&\n                options.streamUsage !== false) {\n                usageMetadata = {\n                    input_tokens: output.usageMetadata.promptTokenCount,\n                    output_tokens: output.usageMetadata.candidatesTokenCount,\n                    total_tokens: output.usageMetadata.totalTokenCount,\n                };\n            }\n            const chunk = output !== null\n                ? this.connection.api.responseToChatGeneration({ data: output })\n                : new outputs_1.ChatGenerationChunk({\n                    text: \"\",\n                    generationInfo: { finishReason: \"stop\" },\n                    message: new messages_1.AIMessageChunk({\n                        content: \"\",\n                        usage_metadata: usageMetadata,\n                    }),\n                });\n            if (chunk) {\n                yield chunk;\n                await runManager?.handleLLMNewToken(chunk.text ?? \"\", undefined, undefined, undefined, undefined, { chunk });\n            }\n        }\n    }\n    /** @ignore */\n    _combineLLMOutput() {\n        return [];\n    }\n    withStructuredOutput(outputSchema, config) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const schema = outputSchema;\n        const name = config?.name;\n        const method = config?.method;\n        const includeRaw = config?.includeRaw;\n        if (method === \"jsonMode\") {\n            throw new Error(`Google only supports \"functionCalling\" as a method.`);\n        }\n        let functionName = name ?? \"extract\";\n        let outputParser;\n        let tools;\n        if (isZodSchema(schema)) {\n            const jsonSchema = (0, zod_to_gemini_parameters_js_1.zodToGeminiParameters)(schema);\n            tools = [\n                {\n                    functionDeclarations: [\n                        {\n                            name: functionName,\n                            description: jsonSchema.description ?? \"A function available to call.\",\n                            parameters: jsonSchema,\n                        },\n                    ],\n                },\n            ];\n            outputParser = new openai_tools_1.JsonOutputKeyToolsParser({\n                returnSingle: true,\n                keyName: functionName,\n                zodSchema: schema,\n            });\n        }\n        else {\n            let geminiFunctionDefinition;\n            if (typeof schema.name === \"string\" &&\n                typeof schema.parameters === \"object\" &&\n                schema.parameters != null) {\n                geminiFunctionDefinition = schema;\n                functionName = schema.name;\n            }\n            else {\n                geminiFunctionDefinition = {\n                    name: functionName,\n                    description: schema.description ?? \"\",\n                    parameters: schema,\n                };\n            }\n            tools = [\n                {\n                    functionDeclarations: [geminiFunctionDefinition],\n                },\n            ];\n            outputParser = new openai_tools_1.JsonOutputKeyToolsParser({\n                returnSingle: true,\n                keyName: functionName,\n            });\n        }\n        const llm = this.bind({\n            tools,\n            tool_choice: functionName,\n        });\n        if (!includeRaw) {\n            return llm.pipe(outputParser).withConfig({\n                runName: \"ChatGoogleStructuredOutput\",\n            });\n        }\n        const parserAssign = runnables_1.RunnablePassthrough.assign({\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            parsed: (input, config) => outputParser.invoke(input.raw, config),\n        });\n        const parserNone = runnables_1.RunnablePassthrough.assign({\n            parsed: () => null,\n        });\n        const parsedWithFallback = parserAssign.withFallbacks({\n            fallbacks: [parserNone],\n        });\n        return runnables_1.RunnableSequence.from([\n            {\n                raw: llm,\n            },\n            parsedWithFallback,\n        ]).withConfig({\n            runName: \"StructuredOutputRunnable\",\n        });\n    }\n}\nexports.ChatGoogleBase = ChatGoogleBase;\nfunction isZodSchema(\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ninput) {\n    // Check for a characteristic method of Zod schemas\n    return typeof input?.parse === \"function\";\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3391, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/llms.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.GoogleBaseLLM = void 0;\nconst manager_1 = require(\"@langchain/core/callbacks/manager\");\nconst llms_1 = require(\"@langchain/core/language_models/llms\");\nconst outputs_1 = require(\"@langchain/core/outputs\");\nconst env_1 = require(\"@langchain/core/utils/env\");\nconst connection_js_1 = require(\"./connection.cjs\");\nconst common_js_1 = require(\"./utils/common.cjs\");\nconst gemini_js_1 = require(\"./utils/gemini.cjs\");\nconst auth_js_1 = require(\"./auth.cjs\");\nconst failed_handler_js_1 = require(\"./utils/failed_handler.cjs\");\nconst chat_models_js_1 = require(\"./chat_models.cjs\");\nclass GoogleLLMConnection extends connection_js_1.AbstractGoogleLLMConnection {\n    async formatContents(input, _parameters) {\n        const parts = await this.api.messageContentToParts(input);\n        const contents = [\n            {\n                role: \"user\",\n                parts,\n            },\n        ];\n        return contents;\n    }\n}\nclass ProxyChatGoogle extends chat_models_js_1.ChatGoogleBase {\n    constructor(fields) {\n        super(fields);\n    }\n    buildAbstractedClient(fields) {\n        return fields.connection.client;\n    }\n}\n/**\n * Integration with an LLM.\n */\nclass GoogleBaseLLM extends llms_1.LLM {\n    // Used for tracing, replace with the same name as your class\n    static lc_name() {\n        return \"GoogleLLM\";\n    }\n    get lc_secrets() {\n        return {\n            authOptions: \"GOOGLE_AUTH_OPTIONS\",\n        };\n    }\n    constructor(fields) {\n        super((0, failed_handler_js_1.ensureParams)(fields));\n        Object.defineProperty(this, \"originalFields\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"lc_serializable\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: true\n        });\n        Object.defineProperty(this, \"modelName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"gemini-pro\"\n        });\n        Object.defineProperty(this, \"model\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"gemini-pro\"\n        });\n        Object.defineProperty(this, \"temperature\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 0.7\n        });\n        Object.defineProperty(this, \"maxOutputTokens\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 1024\n        });\n        Object.defineProperty(this, \"topP\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 0.8\n        });\n        Object.defineProperty(this, \"topK\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 40\n        });\n        Object.defineProperty(this, \"stopSequences\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: []\n        });\n        Object.defineProperty(this, \"safetySettings\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: []\n        });\n        Object.defineProperty(this, \"safetyHandler\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"responseMimeType\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"text/plain\"\n        });\n        Object.defineProperty(this, \"connection\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"streamedConnection\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.originalFields = fields;\n        (0, common_js_1.copyAndValidateModelParamsInto)(fields, this);\n        this.safetyHandler =\n            fields?.safetyHandler ?? new gemini_js_1.DefaultGeminiSafetyHandler();\n        const client = this.buildClient(fields);\n        this.buildConnection(fields ?? {}, client);\n    }\n    buildApiKeyClient(apiKey) {\n        return new auth_js_1.ApiKeyGoogleAuth(apiKey);\n    }\n    buildApiKey(fields) {\n        return fields?.apiKey ?? (0, env_1.getEnvironmentVariable)(\"GOOGLE_API_KEY\");\n    }\n    buildClient(fields) {\n        const apiKey = this.buildApiKey(fields);\n        if (apiKey) {\n            return this.buildApiKeyClient(apiKey);\n        }\n        else {\n            return this.buildAbstractedClient(fields);\n        }\n    }\n    buildConnection(fields, client) {\n        this.connection = new GoogleLLMConnection({ ...fields, ...this }, this.caller, client, false);\n        this.streamedConnection = new GoogleLLMConnection({ ...fields, ...this }, this.caller, client, true);\n    }\n    get platform() {\n        return this.connection.platform;\n    }\n    // Replace\n    _llmType() {\n        return \"googlellm\";\n    }\n    formatPrompt(prompt) {\n        return prompt;\n    }\n    /**\n     * For some given input string and options, return a string output.\n     *\n     * Despite the fact that `invoke` is overridden below, we still need this\n     * in order to handle public APi calls to `generate()`.\n     */\n    async _call(prompt, options) {\n        const parameters = (0, common_js_1.copyAIModelParams)(this, options);\n        const result = await this.connection.request(prompt, parameters, options);\n        const ret = this.connection.api.responseToString(result);\n        return ret;\n    }\n    // Normally, you should not override this method and instead should override\n    // _streamResponseChunks. We are doing so here to allow for multimodal inputs into\n    // the LLM.\n    async *_streamIterator(input, options) {\n        // TODO: Refactor callback setup and teardown code into core\n        const prompt = llms_1.BaseLLM._convertInputToPromptValue(input);\n        const [runnableConfig, callOptions] = this._separateRunnableConfigFromCallOptions(options);\n        const callbackManager_ = await manager_1.CallbackManager.configure(runnableConfig.callbacks, this.callbacks, runnableConfig.tags, this.tags, runnableConfig.metadata, this.metadata, { verbose: this.verbose });\n        const extra = {\n            options: callOptions,\n            invocation_params: this?.invocationParams(callOptions),\n            batch_size: 1,\n        };\n        const runManagers = await callbackManager_?.handleLLMStart(this.toJSON(), [prompt.toString()], undefined, undefined, extra, undefined, undefined, runnableConfig.runName);\n        let generation = new outputs_1.GenerationChunk({\n            text: \"\",\n        });\n        const proxyChat = this.createProxyChat();\n        try {\n            for await (const chunk of proxyChat._streamIterator(input, options)) {\n                const stringValue = this.connection.api.chunkToString(chunk);\n                const generationChunk = new outputs_1.GenerationChunk({\n                    text: stringValue,\n                });\n                generation = generation.concat(generationChunk);\n                yield stringValue;\n            }\n        }\n        catch (err) {\n            await Promise.all((runManagers ?? []).map((runManager) => runManager?.handleLLMError(err)));\n            throw err;\n        }\n        await Promise.all((runManagers ?? []).map((runManager) => runManager?.handleLLMEnd({\n            generations: [[generation]],\n        })));\n    }\n    async predictMessages(messages, options, _callbacks) {\n        const { content } = messages[0];\n        const result = await this.connection.request(content, {}, options);\n        const ret = this.connection.api.responseToBaseMessage(result);\n        return ret;\n    }\n    /**\n     * Internal implementation detail to allow Google LLMs to support\n     * multimodal input by delegating to the chat model implementation.\n     *\n     * TODO: Replace with something less hacky.\n     */\n    createProxyChat() {\n        return new ProxyChatGoogle({\n            ...this.originalFields,\n            connection: this.connection,\n        });\n    }\n    // TODO: Remove the need to override this - we are doing it to\n    // allow the LLM to handle multimodal types of input.\n    async invoke(input, options) {\n        const stream = await this._streamIterator(input, options);\n        let generatedOutput = \"\";\n        for await (const chunk of stream) {\n            generatedOutput += chunk;\n        }\n        return generatedOutput;\n    }\n}\nexports.GoogleBaseLLM = GoogleBaseLLM;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3650, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/embeddings.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BaseGoogleEmbeddings = void 0;\nconst embeddings_1 = require(\"@langchain/core/embeddings\");\nconst chunk_array_1 = require(\"@langchain/core/utils/chunk_array\");\nconst env_1 = require(\"@langchain/core/utils/env\");\nconst connection_js_1 = require(\"./connection.cjs\");\nconst auth_js_1 = require(\"./auth.cjs\");\nclass EmbeddingsConnection extends connection_js_1.GoogleAIConnection {\n    constructor(fields, caller, client, streaming) {\n        super(fields, caller, client, streaming);\n        Object.defineProperty(this, \"convertSystemMessageToHumanContent\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n    }\n    async buildUrlMethod() {\n        return \"predict\";\n    }\n    get modelPublisher() {\n        // All the embedding models are currently published by \"google\"\n        return \"google\";\n    }\n    async formatData(input, parameters) {\n        return {\n            instances: input,\n            parameters,\n        };\n    }\n}\n/**\n * Enables calls to Google APIs for generating\n * text embeddings.\n */\nclass BaseGoogleEmbeddings extends embeddings_1.Embeddings {\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"model\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"connection\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.model = fields.model;\n        this.connection = new EmbeddingsConnection({ ...fields, ...this }, this.caller, this.buildClient(fields), false);\n    }\n    buildApiKeyClient(apiKey) {\n        return new auth_js_1.ApiKeyGoogleAuth(apiKey);\n    }\n    buildApiKey(fields) {\n        return fields?.apiKey ?? (0, env_1.getEnvironmentVariable)(\"GOOGLE_API_KEY\");\n    }\n    buildClient(fields) {\n        const apiKey = this.buildApiKey(fields);\n        if (apiKey) {\n            return this.buildApiKeyClient(apiKey);\n        }\n        else {\n            return this.buildAbstractedClient(fields);\n        }\n    }\n    /**\n     * Takes an array of documents as input and returns a promise that\n     * resolves to a 2D array of embeddings for each document. It splits the\n     * documents into chunks and makes requests to the Google Vertex AI API to\n     * generate embeddings.\n     * @param documents An array of documents to be embedded.\n     * @returns A promise that resolves to a 2D array of embeddings for each document.\n     */\n    async embedDocuments(documents) {\n        const instanceChunks = (0, chunk_array_1.chunkArray)(documents.map((document) => ({\n            content: document,\n        })), 5); // Vertex AI accepts max 5 instances per prediction\n        const parameters = {};\n        const options = {};\n        const responses = await Promise.all(instanceChunks.map((instances) => this.connection.request(instances, parameters, options)));\n        const result = responses\n            ?.map((response) => response?.data?.predictions?.map(\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (result) => result.embeddings?.values) ?? [])\n            .flat() ?? [];\n        return result;\n    }\n    /**\n     * Takes a document as input and returns a promise that resolves to an\n     * embedding for the document. It calls the embedDocuments method with the\n     * document as the input.\n     * @param document A document to be embedded.\n     * @returns A promise that resolves to an embedding for the document.\n     */\n    async embedQuery(document) {\n        const data = await this.embedDocuments([document]);\n        return data[0];\n    }\n}\nexports.BaseGoogleEmbeddings = BaseGoogleEmbeddings;\n"],"names":[],"mappings":"AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,QAAQ,oBAAoB,GAAG,KAAK;AACpC,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM;AACN,MAAM,6BAA6B,gBAAgB,kBAAkB;IACjE,YAAY,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,SAAS,CAAE;QAC3C,KAAK,CAAC,QAAQ,QAAQ,QAAQ;QAC9B,OAAO,cAAc,CAAC,IAAI,EAAE,sCAAsC;YAC9D,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;IACJ;IACA,MAAM,iBAAiB;QACnB,OAAO;IACX;IACA,IAAI,iBAAiB;QACjB,+DAA+D;QAC/D,OAAO;IACX;IACA,MAAM,WAAW,KAAK,EAAE,UAAU,EAAE;QAChC,OAAO;YACH,WAAW;YACX;QACJ;IACJ;AACJ;AACA;;;CAGC,GACD,MAAM,6BAA6B,aAAa,UAAU;IACtD,YAAY,MAAM,CAAE;QAChB,KAAK,CAAC;QACN,OAAO,cAAc,CAAC,IAAI,EAAE,SAAS;YACjC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;QACA,OAAO,cAAc,CAAC,IAAI,EAAE,cAAc;YACtC,YAAY;YACZ,cAAc;YACd,UAAU;YACV,OAAO,KAAK;QAChB;QACA,IAAI,CAAC,KAAK,GAAG,OAAO,KAAK;QACzB,IAAI,CAAC,UAAU,GAAG,IAAI,qBAAqB;YAAE,GAAG,MAAM;YAAE,GAAG,IAAI;QAAC,GAAG,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,WAAW,CAAC,SAAS;IAC9G;IACA,kBAAkB,MAAM,EAAE;QACtB,OAAO,IAAI,UAAU,gBAAgB,CAAC;IAC1C;IACA,YAAY,MAAM,EAAE;QAChB,OAAO,QAAQ,UAAU,CAAC,GAAG,MAAM,sBAAsB,EAAE;IAC/D;IACA,YAAY,MAAM,EAAE;QAChB,MAAM,SAAS,IAAI,CAAC,WAAW,CAAC;QAChC,IAAI,QAAQ;YACR,OAAO,IAAI,CAAC,iBAAiB,CAAC;QAClC,OACK;YACD,OAAO,IAAI,CAAC,qBAAqB,CAAC;QACtC;IACJ;IACA;;;;;;;KAOC,GACD,MAAM,eAAe,SAAS,EAAE;QAC5B,MAAM,iBAAiB,CAAC,GAAG,cAAc,UAAU,EAAE,UAAU,GAAG,CAAC,CAAC,WAAa,CAAC;gBAC9E,SAAS;YACb,CAAC,IAAI,IAAI,mDAAmD;QAC5D,MAAM,aAAa,CAAC;QACpB,MAAM,UAAU,CAAC;QACjB,MAAM,YAAY,MAAM,QAAQ,GAAG,CAAC,eAAe,GAAG,CAAC,CAAC,YAAc,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,WAAW,YAAY;QACrH,MAAM,SAAS,WACT,IAAI,CAAC,WAAa,UAAU,MAAM,aAAa,IACrD,8DAA8D;YAC9D,CAAC,SAAW,OAAO,UAAU,EAAE,WAAW,EAAE,EACvC,UAAU,EAAE;QACjB,OAAO;IACX;IACA;;;;;;KAMC,GACD,MAAM,WAAW,QAAQ,EAAE;QACvB,MAAM,OAAO,MAAM,IAAI,CAAC,cAAc,CAAC;YAAC;SAAS;QACjD,OAAO,IAAI,CAAC,EAAE;IAClB;AACJ;AACA,QAAQ,oBAAoB,GAAG","ignoreList":[0]}},
    {"offset": {"line": 3757, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/output_parsers.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MarkdownGoogleSearchOutputParser = exports.SimpleGoogleSearchOutputParser = exports.BaseGoogleSearchOutputParser = void 0;\nconst output_parsers_1 = require(\"@langchain/core/output_parsers\");\nclass BaseGoogleSearchOutputParser extends output_parsers_1.BaseLLMOutputParser {\n    constructor() {\n        super(...arguments);\n        Object.defineProperty(this, \"lc_namespace\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: [\"google_common\", \"output_parsers\"]\n        });\n    }\n    generationToGroundingInfo(generation) {\n        if (\"message\" in generation) {\n            const responseMetadata = generation?.message?.response_metadata;\n            const metadata = responseMetadata?.groundingMetadata;\n            const supports = responseMetadata?.groundingSupport ?? metadata?.groundingSupports ?? [];\n            if (metadata) {\n                return {\n                    metadata,\n                    supports,\n                };\n            }\n        }\n        return undefined;\n    }\n    generationsToGroundingInfo(generations) {\n        for (const generation of generations) {\n            const info = this.generationToGroundingInfo(generation);\n            if (info !== undefined) {\n                return info;\n            }\n        }\n        return undefined;\n    }\n    generationToString(generation) {\n        if (\"message\" in generation) {\n            const content = generation?.message?.content;\n            if (typeof content === \"string\") {\n                return content;\n            }\n            else {\n                return content\n                    .map((c) => {\n                    if (c?.type === \"text\") {\n                        return c?.text ?? \"\";\n                    }\n                    else {\n                        return \"\";\n                    }\n                })\n                    .reduce((previousValue, currentValue) => `${previousValue}${currentValue}`);\n            }\n        }\n        return generation.text;\n    }\n    generationsToString(generations) {\n        return generations\n            .map((generation) => this.generationToString(generation))\n            .reduce((previousValue, currentValue) => `${previousValue}${currentValue}`);\n    }\n    annotateSegment(text, grounding, support, index) {\n        const start = support.segment.startIndex ?? 0;\n        const end = support.segment.endIndex;\n        const textBefore = text.substring(0, start);\n        const textSegment = text.substring(start, end);\n        const textAfter = text.substring(end);\n        const textPrefix = this.segmentPrefix(grounding, support, index) ?? \"\";\n        const textSuffix = this.segmentSuffix(grounding, support, index) ?? \"\";\n        return `${textBefore}${textPrefix}${textSegment}${textSuffix}${textAfter}`;\n    }\n    annotateTextSegments(text, grounding) {\n        // Go through each support info in reverse, since the segment info\n        // is sorted, and we won't need to adjust string indexes this way.\n        let ret = text;\n        for (let co = grounding.supports.length - 1; co >= 0; co -= 1) {\n            const support = grounding.supports[co];\n            ret = this.annotateSegment(ret, grounding, support, co);\n        }\n        return ret;\n    }\n    /**\n     * Google requires us to\n     * \"Display the Search Suggestion exactly as provided without any modifications\"\n     * So this will typically be called from the textSuffix() method to get\n     * a string that renders HTML.\n     * See https://ai.google.dev/gemini-api/docs/grounding/search-suggestions\n     * @param grounding\n     */\n    searchSuggestion(grounding) {\n        return grounding?.metadata?.searchEntryPoint?.renderedContent ?? \"\";\n    }\n    annotateText(text, grounding) {\n        const prefix = this.textPrefix(text, grounding) ?? \"\";\n        const suffix = this.textSuffix(text, grounding) ?? \"\";\n        const body = this.annotateTextSegments(text, grounding);\n        return `${prefix}${body}${suffix}`;\n    }\n    async parseResult(generations, _callbacks) {\n        const text = this.generationsToString(generations);\n        const grounding = this.generationsToGroundingInfo(generations);\n        if (!grounding) {\n            return text;\n        }\n        return this.annotateText(text, grounding);\n    }\n}\nexports.BaseGoogleSearchOutputParser = BaseGoogleSearchOutputParser;\nclass SimpleGoogleSearchOutputParser extends BaseGoogleSearchOutputParser {\n    segmentPrefix(_grounding, _support, _index) {\n        return undefined;\n    }\n    segmentSuffix(_grounding, support, _index) {\n        const indices = support.groundingChunkIndices.map((i) => i + 1);\n        return ` [${indices.join(\", \")}]`;\n    }\n    textPrefix(_text, _grounding) {\n        return \"Google Says:\\n\";\n    }\n    chunkToString(chunk, index) {\n        const info = chunk.retrievedContext ?? chunk.web;\n        return `${index + 1}. ${info.title} - ${info.uri}`;\n    }\n    textSuffix(_text, grounding) {\n        let ret = \"\\n\";\n        const chunks = grounding?.metadata?.groundingChunks ?? [];\n        chunks.forEach((chunk, index) => {\n            ret = `${ret}${this.chunkToString(chunk, index)}\\n`;\n        });\n        return ret;\n    }\n}\nexports.SimpleGoogleSearchOutputParser = SimpleGoogleSearchOutputParser;\nclass MarkdownGoogleSearchOutputParser extends BaseGoogleSearchOutputParser {\n    segmentPrefix(_grounding, _support, _index) {\n        return undefined;\n    }\n    chunkLink(grounding, index) {\n        const chunk = grounding.metadata.groundingChunks[index];\n        const url = chunk.retrievedContext?.uri ?? chunk.web?.uri;\n        const num = index + 1;\n        return `[[${num}](${url})]`;\n    }\n    segmentSuffix(grounding, support, _index) {\n        let ret = \"\";\n        support.groundingChunkIndices.forEach((chunkIndex) => {\n            const link = this.chunkLink(grounding, chunkIndex);\n            ret = `${ret}${link}`;\n        });\n        return ret;\n    }\n    textPrefix(_text, _grounding) {\n        return undefined;\n    }\n    chunkSuffixLink(chunk, index) {\n        const num = index + 1;\n        const info = chunk.retrievedContext ?? chunk.web;\n        const url = info.uri;\n        const site = info.title;\n        return `${num}. [${site}](${url})`;\n    }\n    textSuffix(_text, grounding) {\n        let ret = \"\\n**Search Sources**\\n\";\n        const chunks = grounding.metadata.groundingChunks;\n        chunks.forEach((chunk, index) => {\n            ret = `${ret}${this.chunkSuffixLink(chunk, index)}\\n`;\n        });\n        const search = this.searchSuggestion(grounding);\n        ret = `${ret}\\n${search}`;\n        return ret;\n    }\n}\nexports.MarkdownGoogleSearchOutputParser = MarkdownGoogleSearchOutputParser;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3933, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/index.cjs"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./chat_models.cjs\"), exports);\n__exportStar(require(\"./llms.cjs\"), exports);\n__exportStar(require(\"./embeddings.cjs\"), exports);\n__exportStar(require(\"./output_parsers.cjs\"), exports);\n__exportStar(require(\"./auth.cjs\"), exports);\n__exportStar(require(\"./connection.cjs\"), exports);\n__exportStar(require(\"./types.cjs\"), exports);\n__exportStar(require(\"./utils/stream.cjs\"), exports);\n__exportStar(require(\"./utils/common.cjs\"), exports);\n__exportStar(require(\"./utils/zod_to_gemini_parameters.cjs\"), exports);\n__exportStar(require(\"./utils/safety.cjs\"), exports);\n"],"names":[],"mappings":"AACA,IAAI,kBAAkB,4DAAS,yDAAK,eAAe,IAAK,CAAC,OAAO,MAAM,GAAI,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;IAC1F,IAAI,OAAO,WAAW,KAAK;IAC3B,IAAI,OAAO,OAAO,wBAAwB,CAAC,GAAG;IAC9C,IAAI,CAAC,QAAQ,CAAC,SAAS,OAAO,CAAC,EAAE,UAAU,GAAG,KAAK,QAAQ,IAAI,KAAK,YAAY,GAAG;QACjF,OAAO;YAAE,YAAY;YAAM,KAAK;gBAAa,OAAO,CAAC,CAAC,EAAE;YAAE;QAAE;IAC9D;IACA,OAAO,cAAc,CAAC,GAAG,IAAI;AACjC,IAAM,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE;IACtB,IAAI,OAAO,WAAW,KAAK;IAC3B,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,EAAE;AAChB,CAAE;AACF,IAAI,eAAe,4DAAS,yDAAK,YAAY,IAAK,SAAS,CAAC,EAAE,QAAO;IACjE,IAAK,IAAI,KAAK,EAAG,IAAI,MAAM,aAAa,CAAC,OAAO,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,UAAS,IAAI,gBAAgB,UAAS,GAAG;AAC3H;AACA,OAAO,cAAc,CAAC,SAAS,cAAc;IAAE,OAAO;AAAK;AAC3D,uIAA2C;AAC3C,gIAAoC;AACpC,sIAA0C;AAC1C,0IAA8C;AAC9C,gIAAoC;AACpC,sIAA0C;AAC1C,iIAAqC;AACrC,wIAA4C;AAC5C,wIAA4C;AAC5C,0JAA8D;AAC9D,wIAA4C","ignoreList":[0]}},
    {"offset": {"line": 3969, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/index.cjs"],"sourcesContent":["module.exports = require('./dist/index.cjs');"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0]}},
    {"offset": {"line": 3974, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/experimental/utils/media_core.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MediaManager = exports.DataBlobStore = exports.SimpleWebBlobStore = exports.ReadThroughBlobStore = exports.BackedBlobStore = exports.BlobStore = exports.MediaBlob = void 0;\nconst uuid_1 = require(\"uuid\"); // FIXME - it is importing the wrong uuid, so v6 and v7 aren't implemented\nconst stores_1 = require(\"@langchain/core/stores\");\nconst serializable_1 = require(\"@langchain/core/load/serializable\");\nfunction bytesToString(dataArray) {\n    // Need to handle the array in smaller chunks to deal with stack size limits\n    let ret = \"\";\n    const chunkSize = 102400;\n    for (let i = 0; i < dataArray.length; i += chunkSize) {\n        const chunk = dataArray.subarray(i, i + chunkSize);\n        ret += String.fromCharCode(...chunk);\n    }\n    return ret;\n}\n/**\n * Represents a chunk of data that can be identified by the path where the\n * data is (or will be) located, along with optional metadata about the data.\n */\nclass MediaBlob extends serializable_1.Serializable {\n    constructor(params) {\n        super(params);\n        Object.defineProperty(this, \"lc_serializable\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: true\n        });\n        Object.defineProperty(this, \"lc_namespace\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: [\n                \"langchain\",\n                \"google_common\",\n                \"experimental\",\n                \"utils\",\n                \"media_core\",\n            ]\n        });\n        Object.defineProperty(this, \"data\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: {\n                value: \"\",\n                type: \"text/plain\",\n            }\n        });\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        Object.defineProperty(this, \"metadata\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"path\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.data = params.data ?? this.data;\n        this.metadata = params.metadata;\n        this.path = params.path;\n    }\n    get size() {\n        return this.asBytes.length;\n    }\n    get dataType() {\n        return this.data?.type ?? \"\";\n    }\n    get encoding() {\n        const charsetEquals = this.dataType.indexOf(\"charset=\");\n        return charsetEquals === -1\n            ? \"utf-8\"\n            : this.dataType.substring(charsetEquals + 8);\n    }\n    get mimetype() {\n        const semicolon = this.dataType.indexOf(\";\");\n        return semicolon === -1\n            ? this.dataType\n            : this.dataType.substring(0, semicolon);\n    }\n    get asBytes() {\n        if (!this.data) {\n            return Uint8Array.from([]);\n        }\n        const binString = atob(this.data?.value);\n        const ret = new Uint8Array(binString.length);\n        for (let co = 0; co < binString.length; co += 1) {\n            ret[co] = binString.charCodeAt(co);\n        }\n        return ret;\n    }\n    async asString() {\n        return bytesToString(this.asBytes);\n    }\n    async asBase64() {\n        return this.data?.value ?? \"\";\n    }\n    async asDataUrl() {\n        return `data:${this.mimetype};base64,${await this.asBase64()}`;\n    }\n    async asUri() {\n        return this.path ?? (await this.asDataUrl());\n    }\n    async encode() {\n        const dataUrl = await this.asDataUrl();\n        const comma = dataUrl.indexOf(\",\");\n        const encoded = dataUrl.substring(comma + 1);\n        const encoding = dataUrl.indexOf(\"base64\") > -1 ? \"base64\" : \"8bit\";\n        return {\n            encoded,\n            encoding,\n        };\n    }\n    static fromDataUrl(url) {\n        if (!url.startsWith(\"data:\")) {\n            throw new Error(\"Not a data: URL\");\n        }\n        const colon = url.indexOf(\":\");\n        const semicolon = url.indexOf(\";\");\n        const mimeType = url.substring(colon + 1, semicolon);\n        const comma = url.indexOf(\",\");\n        const base64Data = url.substring(comma + 1);\n        const data = {\n            type: mimeType,\n            value: base64Data,\n        };\n        return new MediaBlob({\n            data,\n            path: url,\n        });\n    }\n    static async fromBlob(blob, other) {\n        const valueBuffer = await blob.arrayBuffer();\n        const valueArray = new Uint8Array(valueBuffer);\n        const valueStr = bytesToString(valueArray);\n        const value = btoa(valueStr);\n        return new MediaBlob({\n            ...other,\n            data: {\n                value,\n                type: blob.type,\n            },\n        });\n    }\n}\nexports.MediaBlob = MediaBlob;\n/**\n * A specialized Store that is designed to handle MediaBlobs and use the\n * key that is included in the blob to determine exactly how it is stored.\n *\n * The full details of a MediaBlob may be changed when it is stored.\n * For example, it may get additional or different Metadata. This should be\n * what is returned when the store() method is called.\n *\n * Although BlobStore extends BaseStore, not all of the methods from\n * BaseStore may be implemented (or even possible). Those that are not\n * implemented should be documented and throw an Error if called.\n */\nclass BlobStore extends stores_1.BaseStore {\n    constructor(opts) {\n        super(opts);\n        Object.defineProperty(this, \"lc_namespace\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: [\"langchain\", \"google-common\"]\n        }); // FIXME - What should this be? And why?\n        Object.defineProperty(this, \"defaultStoreOptions\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"defaultFetchOptions\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.defaultStoreOptions = opts?.defaultStoreOptions ?? {};\n        this.defaultFetchOptions = opts?.defaultFetchOptions ?? {};\n    }\n    async _realKey(key) {\n        return typeof key === \"string\" ? key : await key.asUri();\n    }\n    /**\n     * Is the path supported by this BlobStore?\n     *\n     * Although this is async, this is expected to be a relatively fast operation\n     * (ie - you shouldn't make network calls).\n     *\n     * @param path The path to check\n     * @param opts Any options (if needed) that may be used to determine if it is valid\n     * @return If the path is supported\n     */\n    hasValidPath(path, opts) {\n        const prefix = opts?.pathPrefix ?? \"\";\n        const isPrefixed = typeof path !== \"undefined\" && path.startsWith(prefix);\n        return Promise.resolve(isPrefixed);\n    }\n    _blobPathSuffix(blob) {\n        // Get the path currently set and make sure we treat it as a string\n        const blobPath = `${blob.path}`;\n        // Advance past the first set of /\n        let pathStart = blobPath.indexOf(\"/\") + 1;\n        while (blobPath.charAt(pathStart) === \"/\") {\n            pathStart += 1;\n        }\n        // We will use the rest as the path for a replacement\n        return blobPath.substring(pathStart);\n    }\n    async _newBlob(oldBlob, newPath) {\n        const oldPath = oldBlob.path;\n        const metadata = oldBlob?.metadata ?? {};\n        metadata.langchainOldPath = oldPath;\n        const newBlob = new MediaBlob({\n            ...oldBlob,\n            metadata,\n        });\n        if (newPath) {\n            newBlob.path = newPath;\n        }\n        else if (newBlob.path) {\n            delete newBlob.path;\n        }\n        return newBlob;\n    }\n    async _validBlobPrefixPath(blob, opts) {\n        const prefix = opts?.pathPrefix ?? \"\";\n        const suffix = this._blobPathSuffix(blob);\n        const newPath = `${prefix}${suffix}`;\n        return this._newBlob(blob, newPath);\n    }\n    _validBlobPrefixUuidFunction(name) {\n        switch (name) {\n            case \"prefixUuid1\":\n                return (0, uuid_1.v1)();\n            case \"prefixUuid4\":\n                return (0, uuid_1.v4)();\n            // case \"prefixUuid6\": return v6();\n            // case \"prefixUuid7\": return v7();\n            default:\n                throw new Error(`Unknown uuid function: ${name}`);\n        }\n    }\n    async _validBlobPrefixUuid(blob, opts) {\n        const prefix = opts?.pathPrefix ?? \"\";\n        const suffix = this._validBlobPrefixUuidFunction(opts?.actionIfInvalid ?? \"prefixUuid4\");\n        const newPath = `${prefix}${suffix}`;\n        return this._newBlob(blob, newPath);\n    }\n    async _validBlobRemovePath(blob, _opts) {\n        return this._newBlob(blob, undefined);\n    }\n    /**\n     * Based on the blob and options, return a blob that has a valid path\n     * that can be saved.\n     * @param blob\n     * @param opts\n     */\n    async _validStoreBlob(blob, opts) {\n        if (await this.hasValidPath(blob.path, opts)) {\n            return blob;\n        }\n        switch (opts?.actionIfInvalid) {\n            case \"ignore\":\n                return blob;\n            case \"prefixPath\":\n                return this._validBlobPrefixPath(blob, opts);\n            case \"prefixUuid1\":\n            case \"prefixUuid4\":\n            case \"prefixUuid6\":\n            case \"prefixUuid7\":\n                return this._validBlobPrefixUuid(blob, opts);\n            case \"removePath\":\n                return this._validBlobRemovePath(blob, opts);\n            default:\n                return undefined;\n        }\n    }\n    async store(blob, opts = {}) {\n        const allOpts = {\n            ...this.defaultStoreOptions,\n            ...opts,\n        };\n        const validBlob = await this._validStoreBlob(blob, allOpts);\n        if (typeof validBlob !== \"undefined\") {\n            const validKey = await validBlob.asUri();\n            await this.mset([[validKey, validBlob]]);\n            const savedKey = await validBlob.asUri();\n            return await this.fetch(savedKey);\n        }\n        return undefined;\n    }\n    async _missingFetchBlobEmpty(path, _opts) {\n        return new MediaBlob({ path });\n    }\n    async _missingFetchBlob(path, opts) {\n        switch (opts?.actionIfBlobMissing) {\n            case \"emptyBlob\":\n                return this._missingFetchBlobEmpty(path, opts);\n            default:\n                return undefined;\n        }\n    }\n    async fetch(key, opts = {}) {\n        const allOpts = {\n            ...this.defaultFetchOptions,\n            ...opts,\n        };\n        const realKey = await this._realKey(key);\n        const ret = await this.mget([realKey]);\n        return ret?.[0] ?? (await this._missingFetchBlob(realKey, allOpts));\n    }\n}\nexports.BlobStore = BlobStore;\nclass BackedBlobStore extends BlobStore {\n    constructor(opts) {\n        super(opts);\n        Object.defineProperty(this, \"backingStore\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.backingStore = opts.backingStore;\n    }\n    mdelete(keys) {\n        return this.backingStore.mdelete(keys);\n    }\n    mget(keys) {\n        return this.backingStore.mget(keys);\n    }\n    mset(keyValuePairs) {\n        return this.backingStore.mset(keyValuePairs);\n    }\n    yieldKeys(prefix) {\n        return this.backingStore.yieldKeys(prefix);\n    }\n}\nexports.BackedBlobStore = BackedBlobStore;\nclass ReadThroughBlobStore extends BlobStore {\n    constructor(opts) {\n        super(opts);\n        Object.defineProperty(this, \"baseStore\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"backingStore\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.baseStore = opts.baseStore;\n        this.backingStore = opts.backingStore;\n    }\n    async store(blob, opts = {}) {\n        const originalUri = await blob.asUri();\n        const newBlob = await this.backingStore.store(blob, opts);\n        if (newBlob) {\n            await this.baseStore.mset([[originalUri, newBlob]]);\n        }\n        return newBlob;\n    }\n    mdelete(keys) {\n        return this.baseStore.mdelete(keys);\n    }\n    mget(keys) {\n        return this.baseStore.mget(keys);\n    }\n    mset(_keyValuePairs) {\n        throw new Error(\"Do not call ReadThroughBlobStore.mset directly\");\n    }\n    yieldKeys(prefix) {\n        return this.baseStore.yieldKeys(prefix);\n    }\n}\nexports.ReadThroughBlobStore = ReadThroughBlobStore;\nclass SimpleWebBlobStore extends BlobStore {\n    _notImplementedException() {\n        throw new Error(\"Not implemented for SimpleWebBlobStore\");\n    }\n    async hasValidPath(path, _opts) {\n        return ((await super.hasValidPath(path, { pathPrefix: \"https://\" })) ||\n            (await super.hasValidPath(path, { pathPrefix: \"http://\" })));\n    }\n    async _fetch(url) {\n        const ret = new MediaBlob({\n            path: url,\n        });\n        const metadata = {};\n        const fetchOptions = {\n            method: \"GET\",\n        };\n        const res = await fetch(url, fetchOptions);\n        metadata.status = res.status;\n        const headers = {};\n        for (const [key, value] of res.headers.entries()) {\n            headers[key] = value;\n        }\n        metadata.headers = headers;\n        metadata.ok = res.ok;\n        if (res.ok) {\n            const resMediaBlob = await MediaBlob.fromBlob(await res.blob());\n            ret.data = resMediaBlob.data;\n        }\n        ret.metadata = metadata;\n        return ret;\n    }\n    async mget(keys) {\n        const blobMap = keys.map(this._fetch);\n        return await Promise.all(blobMap);\n    }\n    async mdelete(_keys) {\n        this._notImplementedException();\n    }\n    async mset(_keyValuePairs) {\n        this._notImplementedException();\n    }\n    async *yieldKeys(_prefix) {\n        this._notImplementedException();\n        yield \"\";\n    }\n}\nexports.SimpleWebBlobStore = SimpleWebBlobStore;\n/**\n * A blob \"store\" that works with data: URLs that will turn the URL into\n * a blob.\n */\nclass DataBlobStore extends BlobStore {\n    _notImplementedException() {\n        throw new Error(\"Not implemented for DataBlobStore\");\n    }\n    hasValidPath(path, _opts) {\n        return super.hasValidPath(path, { pathPrefix: \"data:\" });\n    }\n    _fetch(url) {\n        return MediaBlob.fromDataUrl(url);\n    }\n    async mget(keys) {\n        const blobMap = keys.map(this._fetch);\n        return blobMap;\n    }\n    async mdelete(_keys) {\n        this._notImplementedException();\n    }\n    async mset(_keyValuePairs) {\n        this._notImplementedException();\n    }\n    async *yieldKeys(_prefix) {\n        this._notImplementedException();\n        yield \"\";\n    }\n}\nexports.DataBlobStore = DataBlobStore;\n/**\n * Responsible for converting a URI (typically a web URL) into a MediaBlob.\n * Allows for aliasing / caching of the requested URI and what it resolves to.\n * This MediaBlob is expected to be usable to provide to an LLM, either\n * through the Base64 of the media or through a canonical URI that the LLM\n * supports.\n */\nclass MediaManager {\n    constructor(config) {\n        Object.defineProperty(this, \"store\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"resolvers\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.store = config.store;\n        this.resolvers = config.resolvers;\n    }\n    defaultResolvers() {\n        return [new DataBlobStore({}), new SimpleWebBlobStore({})];\n    }\n    async _isInvalid(blob) {\n        return typeof blob === \"undefined\";\n    }\n    /**\n     * Given the public URI, load what is at this URI and save it\n     * in the store.\n     * @param uri The URI to resolve using the resolver\n     * @return A canonical MediaBlob for this URI\n     */\n    async _resolveAndSave(uri) {\n        let resolvedBlob;\n        const resolvers = this.resolvers || this.defaultResolvers();\n        for (let co = 0; co < resolvers.length; co += 1) {\n            const resolver = resolvers[co];\n            if (await resolver.hasValidPath(uri)) {\n                resolvedBlob = await resolver.fetch(uri);\n            }\n        }\n        if (resolvedBlob) {\n            return await this.store.store(resolvedBlob);\n        }\n        else {\n            return new MediaBlob({});\n        }\n    }\n    async getMediaBlob(uri) {\n        const aliasBlob = await this.store.fetch(uri);\n        const ret = (await this._isInvalid(aliasBlob))\n            ? await this._resolveAndSave(uri)\n            : aliasBlob;\n        return ret;\n    }\n}\nexports.MediaManager = MediaManager;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 4513, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/dist/experimental/media.cjs"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BlobStoreAIStudioFileBase = exports.AIStudioFileDownloadConnection = exports.AIStudioFileUploadConnection = exports.AIStudioMediaBlob = exports.BlobStoreGoogleCloudStorageBase = exports.GoogleCloudStorageRawConnection = exports.GoogleCloudStorageDownloadConnection = exports.GoogleCloudStorageUploadConnection = exports.GoogleCloudStorageUri = exports.BlobStoreGoogle = exports.GoogleDownloadRawConnection = exports.GoogleDownloadConnection = exports.GoogleMultipartUploadConnection = void 0;\nconst async_caller_1 = require(\"@langchain/core/utils/async_caller\");\nconst env_1 = require(\"@langchain/core/utils/env\");\nconst media_core_js_1 = require(\"./utils/media_core.cjs\");\nconst connection_js_1 = require(\"../connection.cjs\");\nconst auth_js_1 = require(\"../auth.cjs\");\nclass GoogleMultipartUploadConnection extends connection_js_1.GoogleHostConnection {\n    constructor(fields, caller, client) {\n        super(fields, caller, client);\n    }\n    async _body(separator, data, metadata) {\n        const contentType = data.mimetype;\n        const { encoded, encoding } = await data.encode();\n        const body = [\n            `--${separator}`,\n            \"Content-Type: application/json; charset=UTF-8\",\n            \"\",\n            JSON.stringify(metadata),\n            \"\",\n            `--${separator}`,\n            `Content-Type: ${contentType}`,\n            `Content-Transfer-Encoding: ${encoding}`,\n            \"\",\n            encoded,\n            `--${separator}--`,\n        ];\n        return body.join(\"\\n\");\n    }\n    async request(data, metadata, options) {\n        const separator = `separator-${Date.now()}`;\n        const body = await this._body(separator, data, metadata);\n        const requestHeaders = {\n            \"Content-Type\": `multipart/related; boundary=${separator}`,\n            \"X-Goog-Upload-Protocol\": \"multipart\",\n        };\n        const response = this._request(body, options, requestHeaders);\n        return response;\n    }\n}\nexports.GoogleMultipartUploadConnection = GoogleMultipartUploadConnection;\nclass GoogleDownloadConnection extends connection_js_1.GoogleHostConnection {\n    async request(options) {\n        return this._request(undefined, options);\n    }\n}\nexports.GoogleDownloadConnection = GoogleDownloadConnection;\nclass GoogleDownloadRawConnection extends connection_js_1.GoogleRawConnection {\n    buildMethod() {\n        return \"GET\";\n    }\n    async request(options) {\n        return this._request(undefined, options);\n    }\n}\nexports.GoogleDownloadRawConnection = GoogleDownloadRawConnection;\nclass BlobStoreGoogle extends media_core_js_1.BlobStore {\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"caller\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"client\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.caller = new async_caller_1.AsyncCaller(fields ?? {});\n        this.client = this.buildClient(fields);\n    }\n    async _set(keyValuePair) {\n        const [, blob] = keyValuePair;\n        const setMetadata = this.buildSetMetadata(keyValuePair);\n        const metadata = setMetadata;\n        const options = {};\n        const connection = this.buildSetConnection(keyValuePair);\n        const response = await connection.request(blob, metadata, options);\n        return response;\n    }\n    async mset(keyValuePairs) {\n        const ret = keyValuePairs.map((keyValue) => this._set(keyValue));\n        await Promise.all(ret);\n    }\n    async _getMetadata(key) {\n        const connection = this.buildGetMetadataConnection(key);\n        const options = {};\n        const response = await connection.request(options);\n        return response.data;\n    }\n    async _getData(key) {\n        const connection = this.buildGetDataConnection(key);\n        const options = {};\n        const response = await connection.request(options);\n        return response.data;\n    }\n    _getMimetypeFromMetadata(metadata) {\n        return metadata.contentType;\n    }\n    async _get(key) {\n        const metadata = await this._getMetadata(key);\n        const data = await this._getData(key);\n        if (data && metadata) {\n            const ret = await media_core_js_1.MediaBlob.fromBlob(data, { metadata, path: key });\n            return ret;\n        }\n        else {\n            return undefined;\n        }\n    }\n    async mget(keys) {\n        const ret = keys.map((key) => this._get(key));\n        return await Promise.all(ret);\n    }\n    async _del(key) {\n        const connection = this.buildDeleteConnection(key);\n        const options = {};\n        await connection.request(options);\n    }\n    async mdelete(keys) {\n        const ret = keys.map((key) => this._del(key));\n        await Promise.all(ret);\n    }\n    // eslint-disable-next-line require-yield\n    async *yieldKeys(_prefix) {\n        // TODO: Implement. Most have an implementation that uses nextToken.\n        throw new Error(\"yieldKeys is not implemented\");\n    }\n}\nexports.BlobStoreGoogle = BlobStoreGoogle;\nclass GoogleCloudStorageUri {\n    constructor(uri) {\n        Object.defineProperty(this, \"bucket\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"path\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        const bucketAndPath = GoogleCloudStorageUri.uriToBucketAndPath(uri);\n        this.bucket = bucketAndPath.bucket;\n        this.path = bucketAndPath.path;\n    }\n    get uri() {\n        return `gs://${this.bucket}/${this.path}`;\n    }\n    get isValid() {\n        return (typeof this.bucket !== \"undefined\" && typeof this.path !== \"undefined\");\n    }\n    static uriToBucketAndPath(uri) {\n        const match = this.uriRegexp.exec(uri);\n        if (!match) {\n            throw new Error(`Invalid gs:// URI: ${uri}`);\n        }\n        return {\n            bucket: match[1],\n            path: match[2],\n        };\n    }\n    static isValidUri(uri) {\n        return this.uriRegexp.test(uri);\n    }\n}\nexports.GoogleCloudStorageUri = GoogleCloudStorageUri;\nObject.defineProperty(GoogleCloudStorageUri, \"uriRegexp\", {\n    enumerable: true,\n    configurable: true,\n    writable: true,\n    value: /gs:\\/\\/([a-z0-9][a-z0-9._-]+[a-z0-9])\\/(.*)/\n});\nclass GoogleCloudStorageUploadConnection extends GoogleMultipartUploadConnection {\n    constructor(fields, caller, client) {\n        super(fields, caller, client);\n        Object.defineProperty(this, \"uri\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.uri = new GoogleCloudStorageUri(fields.uri);\n    }\n    async buildUrl() {\n        return `https://storage.googleapis.com/upload/storage/${this.apiVersion}/b/${this.uri.bucket}/o?uploadType=multipart`;\n    }\n}\nexports.GoogleCloudStorageUploadConnection = GoogleCloudStorageUploadConnection;\nclass GoogleCloudStorageDownloadConnection extends GoogleDownloadConnection {\n    constructor(fields, caller, client) {\n        super(fields, caller, client);\n        Object.defineProperty(this, \"uri\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"method\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"alt\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.uri = new GoogleCloudStorageUri(fields.uri);\n        this.method = fields.method;\n        this.alt = fields.alt;\n    }\n    buildMethod() {\n        return this.method;\n    }\n    async buildUrl() {\n        const path = encodeURIComponent(this.uri.path);\n        const ret = `https://storage.googleapis.com/storage/${this.apiVersion}/b/${this.uri.bucket}/o/${path}`;\n        return this.alt ? `${ret}?alt=${this.alt}` : ret;\n    }\n}\nexports.GoogleCloudStorageDownloadConnection = GoogleCloudStorageDownloadConnection;\nclass GoogleCloudStorageRawConnection extends GoogleDownloadRawConnection {\n    constructor(fields, caller, client) {\n        super(fields, caller, client);\n        Object.defineProperty(this, \"uri\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.uri = new GoogleCloudStorageUri(fields.uri);\n    }\n    async buildUrl() {\n        const path = encodeURIComponent(this.uri.path);\n        const ret = `https://storage.googleapis.com/storage/${this.apiVersion}/b/${this.uri.bucket}/o/${path}?alt=media`;\n        return ret;\n    }\n}\nexports.GoogleCloudStorageRawConnection = GoogleCloudStorageRawConnection;\nclass BlobStoreGoogleCloudStorageBase extends BlobStoreGoogle {\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"params\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.params = fields;\n        this.defaultStoreOptions = {\n            ...this.defaultStoreOptions,\n            pathPrefix: fields.uriPrefix.uri,\n        };\n    }\n    buildSetConnection([key, _blob]) {\n        const params = {\n            ...this.params,\n            uri: key,\n        };\n        return new GoogleCloudStorageUploadConnection(params, this.caller, this.client);\n    }\n    buildSetMetadata([key, blob]) {\n        const uri = new GoogleCloudStorageUri(key);\n        const ret = {\n            name: uri.path,\n            metadata: blob.metadata,\n            contentType: blob.mimetype,\n        };\n        return ret;\n    }\n    buildGetMetadataConnection(key) {\n        const params = {\n            uri: key,\n            method: \"GET\",\n            alt: undefined,\n        };\n        return new GoogleCloudStorageDownloadConnection(params, this.caller, this.client);\n    }\n    buildGetDataConnection(key) {\n        const params = {\n            uri: key,\n        };\n        return new GoogleCloudStorageRawConnection(params, this.caller, this.client);\n    }\n    buildDeleteConnection(key) {\n        const params = {\n            uri: key,\n            method: \"DELETE\",\n            alt: undefined,\n        };\n        return new GoogleCloudStorageDownloadConnection(params, this.caller, this.client);\n    }\n}\nexports.BlobStoreGoogleCloudStorageBase = BlobStoreGoogleCloudStorageBase;\nclass AIStudioMediaBlob extends media_core_js_1.MediaBlob {\n    _valueAsDate(value) {\n        if (!value) {\n            return new Date(0);\n        }\n        return new Date(value);\n    }\n    _metadataFieldAsDate(field) {\n        return this._valueAsDate(this.metadata?.[field]);\n    }\n    get createDate() {\n        return this._metadataFieldAsDate(\"createTime\");\n    }\n    get updateDate() {\n        return this._metadataFieldAsDate(\"updateTime\");\n    }\n    get expirationDate() {\n        return this._metadataFieldAsDate(\"expirationTime\");\n    }\n    get isExpired() {\n        const now = new Date().toISOString();\n        const exp = this.metadata?.expirationTime ?? now;\n        return exp <= now;\n    }\n}\nexports.AIStudioMediaBlob = AIStudioMediaBlob;\nclass AIStudioFileUploadConnection extends GoogleMultipartUploadConnection {\n    constructor() {\n        super(...arguments);\n        Object.defineProperty(this, \"apiVersion\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"v1beta\"\n        });\n    }\n    async buildUrl() {\n        return `https://generativelanguage.googleapis.com/upload/${this.apiVersion}/files`;\n    }\n}\nexports.AIStudioFileUploadConnection = AIStudioFileUploadConnection;\nclass AIStudioFileDownloadConnection extends GoogleDownloadConnection {\n    constructor(fields, caller, client) {\n        super(fields, caller, client);\n        Object.defineProperty(this, \"method\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"name\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"apiVersion\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"v1beta\"\n        });\n        this.method = fields.method;\n        this.name = fields.name;\n    }\n    buildMethod() {\n        return this.method;\n    }\n    async buildUrl() {\n        return `https://generativelanguage.googleapis.com/${this.apiVersion}/files/${this.name}`;\n    }\n}\nexports.AIStudioFileDownloadConnection = AIStudioFileDownloadConnection;\nclass BlobStoreAIStudioFileBase extends BlobStoreGoogle {\n    constructor(fields) {\n        const params = {\n            defaultStoreOptions: {\n                pathPrefix: \"https://generativelanguage.googleapis.com/v1beta/files/\",\n                actionIfInvalid: \"removePath\",\n            },\n            ...fields,\n        };\n        super(params);\n        Object.defineProperty(this, \"params\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"retryTime\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 1000\n        });\n        this.params = params;\n        this.retryTime = params?.retryTime ?? this.retryTime ?? 1000;\n    }\n    _pathToName(path) {\n        return path.split(\"/\").pop() ?? path;\n    }\n    buildApiKeyClient(apiKey) {\n        return new auth_js_1.ApiKeyGoogleAuth(apiKey);\n    }\n    buildApiKey(fields) {\n        return fields?.apiKey ?? (0, env_1.getEnvironmentVariable)(\"GOOGLE_API_KEY\");\n    }\n    buildClient(fields) {\n        const apiKey = this.buildApiKey(fields);\n        if (apiKey) {\n            return this.buildApiKeyClient(apiKey);\n        }\n        else {\n            // TODO: Test that you can use OAuth to access\n            return this.buildAbstractedClient(fields);\n        }\n    }\n    async _regetMetadata(key) {\n        // Sleep for some time period\n        // eslint-disable-next-line no-promise-executor-return\n        await new Promise((resolve) => setTimeout(resolve, this.retryTime));\n        // Fetch the latest metadata\n        return this._getMetadata(key);\n    }\n    async _set([key, blob]) {\n        const response = (await super._set([\n            key,\n            blob,\n        ]));\n        let file = response.data?.file ?? { state: \"FAILED\" };\n        while (file.state === \"PROCESSING\" && file.uri && this.retryTime > 0) {\n            file = await this._regetMetadata(file.uri);\n        }\n        // The response should contain the name (and valid URI), so we need to\n        // update the blob with this. We can't return a new blob, since mset()\n        // doesn't return anything.\n        /* eslint-disable no-param-reassign */\n        blob.path = file.uri;\n        blob.metadata = {\n            ...blob.metadata,\n            ...file,\n        };\n        /* eslint-enable no-param-reassign */\n        return response;\n    }\n    buildSetConnection([_key, _blob]) {\n        return new AIStudioFileUploadConnection(this.params, this.caller, this.client);\n    }\n    buildSetMetadata([_key, _blob]) {\n        return {};\n    }\n    buildGetMetadataConnection(key) {\n        const params = {\n            ...this.params,\n            method: \"GET\",\n            name: this._pathToName(key),\n        };\n        return new AIStudioFileDownloadConnection(params, this.caller, this.client);\n    }\n    buildGetDataConnection(_key) {\n        throw new Error(\"AI Studio File API does not provide data\");\n    }\n    async _get(key) {\n        const metadata = await this._getMetadata(key);\n        if (metadata) {\n            const contentType = metadata?.mimeType ?? \"application/octet-stream\";\n            // TODO - Get the actual data (and other metadata) from an optional backing store\n            const data = {\n                value: \"\",\n                type: contentType,\n            };\n            return new media_core_js_1.MediaBlob({\n                path: key,\n                data,\n                metadata,\n            });\n        }\n        else {\n            return undefined;\n        }\n    }\n    buildDeleteConnection(key) {\n        const params = {\n            ...this.params,\n            method: \"DELETE\",\n            name: this._pathToName(key),\n        };\n        return new AIStudioFileDownloadConnection(params, this.caller, this.client);\n    }\n}\nexports.BlobStoreAIStudioFileBase = BlobStoreAIStudioFileBase;\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 5011, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/node_modules/%40langchain/google-common/experimental/media.cjs"],"sourcesContent":["module.exports = require('../dist/experimental/media.cjs');"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0]}}]
}