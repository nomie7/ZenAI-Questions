{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/External/dev/Projects/Work%20Projects/RAG/new_rag/questions/src/lib/parsers/gemini-parser.ts"],"sourcesContent":["import { GoogleGenerativeAI } from \"@google/generative-ai\";\nimport { pdf } from \"pdf-to-img\";\nimport type { DocumentParser, ParsedDocument, ParsedPage } from \"./index\";\n\n/**\n * Gemini Flash parser for advanced document understanding\n *\n * Good for: Scanned PDFs, complex layouts, handwritten notes, tables\n * Uses vision capabilities to extract text from page images\n */\nexport class GeminiParser implements DocumentParser {\n  private genAI: GoogleGenerativeAI;\n  private model;\n\n  constructor() {\n    const apiKey = process.env.GOOGLE_API_KEY;\n    if (!apiKey) {\n      throw new Error(\"GOOGLE_API_KEY is required for Gemini parser\");\n    }\n\n    this.genAI = new GoogleGenerativeAI(apiKey);\n    // Use Gemini 1.5 Flash for fast, cost-effective processing\n    this.model = this.genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\n  }\n\n  async parse(file: Buffer, filename: string): Promise<ParsedDocument> {\n    const ext = filename.toLowerCase().split(\".\").pop();\n\n    if (ext !== \"pdf\") {\n      throw new Error(`Unsupported file type: ${ext}. Only PDF is supported.`);\n    }\n\n    const pages: ParsedPage[] = [];\n\n    try {\n      // Convert PDF pages to images\n      const document = await pdf(file, {\n        scale: 2.0, // Higher quality for better OCR\n      });\n\n      let pageNumber = 0;\n      for await (const imageBuffer of document) {\n        pageNumber++;\n\n        // Extract text using Gemini Vision\n        const text = await this.extractTextFromImage(\n          Buffer.from(imageBuffer),\n          pageNumber\n        );\n\n        pages.push({\n          pageNumber,\n          text,\n          imageBuffer: Buffer.from(imageBuffer),\n        });\n\n        // Small delay to avoid rate limiting\n        if (pageNumber > 1) {\n          await new Promise((resolve) => setTimeout(resolve, 200));\n        }\n      }\n\n      return {\n        pages,\n        metadata: {\n          pageCount: pages.length,\n          parserUsed: \"gemini\",\n        },\n      };\n    } catch (error) {\n      console.error(\"Error parsing PDF with Gemini:\", error);\n      throw new Error(\n        `Failed to parse PDF with Gemini: ${(error as Error).message}`\n      );\n    }\n  }\n\n  /**\n   * Extract text from a page image using Gemini Vision\n   */\n  private async extractTextFromImage(\n    imageBuffer: Buffer,\n    pageNumber: number\n  ): Promise<string> {\n    try {\n      const base64Image = imageBuffer.toString(\"base64\");\n\n      const result = await this.model.generateContent([\n        {\n          inlineData: {\n            mimeType: \"image/png\",\n            data: base64Image,\n          },\n        },\n        {\n          text: `Extract all text content from this document page (page ${pageNumber}).\n\nInstructions:\n- Extract ALL visible text, maintaining the reading order\n- Preserve paragraph structure with blank lines between sections\n- For tables, format as plain text with alignment\n- Include headers, footers, and any captions\n- If there are bullet points or numbered lists, preserve the formatting\n- Do not add any commentary, just return the extracted text\n- If there is no text visible, return \"[No text content on this page]\"`,\n        },\n      ]);\n\n      const response = await result.response;\n      const text = response.text();\n\n      return text.trim() || `[No text content on page ${pageNumber}]`;\n    } catch (error) {\n      console.error(`Error extracting text from page ${pageNumber}:`, error);\n      return `[Error extracting text from page ${pageNumber}]`;\n    }\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AASO,MAAM;IACH,MAA0B;IAC1B,MAAM;IAEd,aAAc;QACZ,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QACzC,IAAI,CAAC,QAAQ;YACX,MAAM,IAAI,MAAM;QAClB;QAEA,IAAI,CAAC,KAAK,GAAG,IAAI,sLAAkB,CAAC;QACpC,2DAA2D;QAC3D,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC;YAAE,OAAO;QAAmB;IACzE;IAEA,MAAM,MAAM,IAAY,EAAE,QAAgB,EAA2B;QACnE,MAAM,MAAM,SAAS,WAAW,GAAG,KAAK,CAAC,KAAK,GAAG;QAEjD,IAAI,QAAQ,OAAO;YACjB,MAAM,IAAI,MAAM,CAAC,uBAAuB,EAAE,IAAI,wBAAwB,CAAC;QACzE;QAEA,MAAM,QAAsB,EAAE;QAE9B,IAAI;YACF,8BAA8B;YAC9B,MAAM,WAAW,MAAM,IAAA,uIAAG,EAAC,MAAM;gBAC/B,OAAO;YACT;YAEA,IAAI,aAAa;YACjB,WAAW,MAAM,eAAe,SAAU;gBACxC;gBAEA,mCAAmC;gBACnC,MAAM,OAAO,MAAM,IAAI,CAAC,oBAAoB,CAC1C,OAAO,IAAI,CAAC,cACZ;gBAGF,MAAM,IAAI,CAAC;oBACT;oBACA;oBACA,aAAa,OAAO,IAAI,CAAC;gBAC3B;gBAEA,qCAAqC;gBACrC,IAAI,aAAa,GAAG;oBAClB,MAAM,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS;gBACrD;YACF;YAEA,OAAO;gBACL;gBACA,UAAU;oBACR,WAAW,MAAM,MAAM;oBACvB,YAAY;gBACd;YACF;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kCAAkC;YAChD,MAAM,IAAI,MACR,CAAC,iCAAiC,EAAE,AAAC,MAAgB,OAAO,EAAE;QAElE;IACF;IAEA;;GAEC,GACD,MAAc,qBACZ,WAAmB,EACnB,UAAkB,EACD;QACjB,IAAI;YACF,MAAM,cAAc,YAAY,QAAQ,CAAC;YAEzC,MAAM,SAAS,MAAM,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC;gBAC9C;oBACE,YAAY;wBACV,UAAU;wBACV,MAAM;oBACR;gBACF;gBACA;oBACE,MAAM,CAAC,uDAAuD,EAAE,WAAW;;;;;;;;;sEASf,CAAC;gBAC/D;aACD;YAED,MAAM,WAAW,MAAM,OAAO,QAAQ;YACtC,MAAM,OAAO,SAAS,IAAI;YAE1B,OAAO,KAAK,IAAI,MAAM,CAAC,yBAAyB,EAAE,WAAW,CAAC,CAAC;QACjE,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,CAAC,gCAAgC,EAAE,WAAW,CAAC,CAAC,EAAE;YAChE,OAAO,CAAC,iCAAiC,EAAE,WAAW,CAAC,CAAC;QAC1D;IACF;AACF"}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@google/generative-ai/dist/index.mjs","sources":[],"sourcesContent":[],"names":[],"mappings":""}}]
}